---
phase: 37-jobs-campaigns-ux-fixes
plan: 03
type: execute
wave: 2
depends_on: ["37-01"]
files_modified:
  - components/campaigns/campaign-card.tsx
  - components/campaigns/campaign-list.tsx
  - components/campaigns/campaign-form.tsx
  - components/campaigns/preset-picker.tsx
  - app/(dashboard)/campaigns/page.tsx
  - app/(dashboard)/campaigns/[id]/page.tsx
  - app/(dashboard)/campaigns/[id]/edit/page.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking anywhere on a campaign card navigates to the campaign detail page"
    - "Clicking the status toggle or dropdown menu on a campaign card does NOT trigger navigation (stopPropagation works)"
    - "Campaign editor opens in a right-side Sheet panel from the campaign list — no full-page navigation"
    - "The back link on campaign detail and edit pages has a normal-sized hit area (inline-flex, w-fit)"
    - "The Standard campaign preset card appears visually centered in the preset picker grid"
    - "Campaign form's onSuccess callback is called instead of router.push when used inside a Sheet"
  artifacts:
    - path: "components/campaigns/campaign-card.tsx"
      provides: "Fully clickable card with stopPropagation on Switch and DropdownMenu"
    - path: "components/campaigns/campaign-list.tsx"
      provides: "Campaign list with Sheet-based campaign edit panel"
    - path: "components/campaigns/campaign-form.tsx"
      provides: "Campaign form with optional onSuccess callback"
    - path: "components/campaigns/preset-picker.tsx"
      provides: "Centered preset grid"
    - path: "app/(dashboard)/campaigns/[id]/page.tsx"
      provides: "Campaign detail with inline-flex back link"
    - path: "app/(dashboard)/campaigns/[id]/edit/page.tsx"
      provides: "Campaign edit with inline-flex back link"
  key_links:
    - from: "components/campaigns/campaign-card.tsx"
      to: "app/(dashboard)/campaigns/[id]/page.tsx"
      via: "useRouter().push on card click"
      pattern: "router\\.push.*campaigns/"
    - from: "components/campaigns/campaign-list.tsx"
      to: "components/campaigns/campaign-form.tsx"
      via: "Sheet containing CampaignForm with onSuccess"
      pattern: "onSuccess="
    - from: "components/campaigns/campaign-form.tsx"
      to: "lib/actions/campaign.ts"
      via: "updateCampaign called on submit, then onSuccess callback"
      pattern: "onSuccess\\(\\)"
---

<objective>
Make campaign cards fully clickable (JC-05), open campaign editor as a side panel (JC-04), fix the back button hit area (JC-06), and center the Standard preset (JC-07).

Purpose: The campaigns page needs polish — cards should be clickable targets (not just the name text), editing should stay in context (panel, not full-page navigation), back buttons should have appropriate hit areas, and presets should be centered.

Output: Fully interactive campaign cards, Sheet-based edit panel, fixed back buttons, centered preset grid.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-jobs-campaigns-ux-fixes/37-RESEARCH.md
@.planning/phases/37-jobs-campaigns-ux-fixes/37-01-SUMMARY.md

Key files:
@components/campaigns/campaign-card.tsx
@components/campaigns/campaign-list.tsx
@components/campaigns/campaign-form.tsx
@components/campaigns/preset-picker.tsx
@app/(dashboard)/campaigns/page.tsx
@app/(dashboard)/campaigns/[id]/page.tsx
@app/(dashboard)/campaigns/[id]/edit/page.tsx
@lib/data/campaign.ts (getCampaign function)
@lib/data/message-template.ts (getAvailableTemplates function)
@components/ui/sheet.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Campaign card full-click, back button fix, and preset centering (JC-05, JC-06, JC-07)</name>
  <files>components/campaigns/campaign-card.tsx, components/campaigns/preset-picker.tsx, app/(dashboard)/campaigns/[id]/page.tsx, app/(dashboard)/campaigns/[id]/edit/page.tsx</files>
  <action>
  **Part A: Make campaign card fully clickable (JC-05)**

  In `components/campaigns/campaign-card.tsx`:

  1. Add `useRouter` import from `next/navigation`
  2. Add `const router = useRouter()` inside the component
  3. Add an `onEdit` optional prop to `CampaignCardProps`: `onEdit?: (campaignId: string) => void`
  4. Change the outer `<div>` to include an `onClick` handler and cursor:
     ```tsx
     <div
       className="rounded-lg border bg-card p-4 hover:shadow-sm transition-shadow cursor-pointer"
       onClick={() => router.push(`/campaigns/${campaign.id}`)}
     >
     ```
  5. Remove the `<Link>` wrapper from the campaign name. Change from:
     ```tsx
     <Link href={`/campaigns/${campaign.id}`} className="font-medium hover:underline truncate">
       {campaign.name}
     </Link>
     ```
     To:
     ```tsx
     <span className="font-medium truncate">{campaign.name}</span>
     ```
     Remove the `Link` import if no longer used.

  6. Wrap the Switch + DropdownMenu controls div with `onClick` stopPropagation:
     ```tsx
     <div
       className="flex items-center gap-3 shrink-0"
       onClick={(e) => e.stopPropagation()}
     >
     ```
     This is the existing `<div className="flex items-center gap-3 shrink-0">` at line 103. Just add `onClick={(e) => e.stopPropagation()}` to it.

  7. In the DropdownMenu "Edit" item, change from `<Link>` navigation to calling `onEdit`:
     ```tsx
     <DropdownMenuItem onClick={() => onEdit?.(campaign.id)}>
       <PencilSimple className="mr-2 h-4 w-4" />
       Edit
     </DropdownMenuItem>
     ```
     If `onEdit` is not provided, fall back to router navigation:
     ```tsx
     <DropdownMenuItem onClick={() => onEdit ? onEdit(campaign.id) : router.push(`/campaigns/${campaign.id}/edit`)}>
     ```
     Remove the `asChild` from the Edit DropdownMenuItem and remove its `<Link>` child.

  **Part B: Fix back button hit area (JC-06)**

  In `app/(dashboard)/campaigns/[id]/page.tsx` (line 53-56):
  Change the back link className from:
  ```
  "text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 mb-2"
  ```
  To:
  ```
  "inline-flex items-center gap-1 mb-2 text-sm text-muted-foreground hover:text-foreground w-fit"
  ```

  In `app/(dashboard)/campaigns/[id]/edit/page.tsx` (line 39-42):
  Change the back link className from:
  ```
  "text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 mb-4"
  ```
  To:
  ```
  "inline-flex items-center gap-1 mb-4 text-sm text-muted-foreground hover:text-foreground w-fit"
  ```

  The key changes are: `flex` → `inline-flex` and adding `w-fit`. This constrains the link's hit area to its content.

  **Part C: Center Standard preset (JC-07)**

  In `components/campaigns/preset-picker.tsx`:

  The issue is the grid container in the empty state context. The grid itself is correct for 3 items, but when wrapped in a `text-center` parent (from `campaigns/page.tsx` line 43), the grid items aren't centered because CSS Grid doesn't respond to `text-align`.

  Fix: Add `max-w-3xl mx-auto` to the grid wrapper to center it within its parent when the grid has fewer items or when the container is wider:
  ```tsx
  <div className={cn(
    'grid gap-4 max-w-3xl mx-auto',
    compact ? 'grid-cols-1 md:grid-cols-3' : 'grid-cols-1 lg:grid-cols-3'
  )}>
  ```

  This centers the grid itself within the parent container. With 3 columns and a max-width, the grid content will be visually centered. The `max-w-3xl` (48rem = 768px) is wide enough for 3 cards with gaps but prevents the grid from stretching too wide in large viewports.

  Also, ensure the preset order is deterministic. In `presetsWithMeta`, sort to ensure Conservative, Standard, Aggressive order (left to right):
  ```typescript
  const ORDER = ['conservative', 'standard', 'aggressive']
  const presetsWithMeta = presets
    .map(preset => {
      const meta = CAMPAIGN_PRESETS.find(p => preset.name.toLowerCase().includes(p.id))
      return { ...preset, meta }
    })
    .sort((a, b) => {
      const aIdx = ORDER.indexOf(a.meta?.id || '')
      const bIdx = ORDER.indexOf(b.meta?.id || '')
      return (aIdx === -1 ? 99 : aIdx) - (bIdx === -1 ? 99 : bIdx)
    })
  ```
  This guarantees Standard is always in the middle column.
  </action>
  <verify>
  - `pnpm typecheck` passes
  - `pnpm lint` passes
  - In `campaign-card.tsx`: outer div has `onClick={() => router.push(...)}`, controls div has `onClick={(e) => e.stopPropagation()}`
  - In both campaign detail/edit pages: back link uses `inline-flex` and `w-fit`
  - In `preset-picker.tsx`: grid has `max-w-3xl mx-auto` and presets are sorted in deterministic order
  </verify>
  <done>Campaign cards are fully clickable with proper stopPropagation. Back links have constrained hit areas. Preset grid is centered with deterministic ordering.</done>
</task>

<task type="auto">
  <name>Task 2: Campaign edit as side panel with Sheet (JC-04)</name>
  <files>components/campaigns/campaign-form.tsx, components/campaigns/campaign-list.tsx, app/(dashboard)/campaigns/page.tsx</files>
  <action>
  **Step 1: Add `onSuccess` callback to CampaignForm**

  In `components/campaigns/campaign-form.tsx`:

  1. Add `onSuccess?: () => void` to `CampaignFormProps` interface:
     ```typescript
     interface CampaignFormProps {
       campaign?: CampaignWithTouches
       templates: MessageTemplate[]
       onSuccess?: () => void
     }
     ```

  2. In the `onSubmit` function, after the success toast (line 84), check for callback:
     ```typescript
     toast.success(isEditing ? 'Campaign updated' : 'Campaign created')
     if (onSuccess) {
       onSuccess()
     } else {
       router.push('/campaigns')
     }
     ```

  3. In the Cancel button (line 235), also call onSuccess if available (to close the sheet):
     ```typescript
     <Button type="button" variant="outline" onClick={() => onSuccess ? onSuccess() : router.back()}>
       Cancel
     </Button>
     ```

  **Step 2: Add edit Sheet state to CampaignList**

  In `components/campaigns/campaign-list.tsx`:

  1. Import Sheet components and campaign-form dependencies:
     ```typescript
     import { useState, useEffect } from 'react'
     import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from '@/components/ui/sheet'
     import { CampaignForm } from './campaign-form'
     import type { MessageTemplate } from '@/lib/types/database'
     ```

  2. Add `templates` prop to `CampaignListProps`:
     ```typescript
     interface CampaignListProps {
       campaigns: CampaignWithTouches[]
       templates: MessageTemplate[]
     }
     ```

  3. Add Sheet state management:
     ```typescript
     export function CampaignList({ campaigns, templates }: CampaignListProps) {
       const [editingCampaignId, setEditingCampaignId] = useState<string | null>(null)

       const editingCampaign = editingCampaignId
         ? campaigns.find(c => c.id === editingCampaignId) || null
         : null
     ```

  4. Pass `onEdit` to each `CampaignCard`:
     ```typescript
     <CampaignCard
       campaign={campaign}
       onEdit={(id) => setEditingCampaignId(id)}
     />
     ```

  5. Add the Sheet at the bottom of the component:
     ```tsx
     {/* Edit Campaign Sheet */}
     <Sheet open={!!editingCampaign} onOpenChange={(open) => !open && setEditingCampaignId(null)}>
       <SheetContent className="overflow-y-auto sm:max-w-xl">
         <SheetHeader>
           <SheetTitle>Edit Campaign</SheetTitle>
           <SheetDescription>
             Update your campaign settings and touch sequence
           </SheetDescription>
         </SheetHeader>
         {editingCampaign && (
           <div className="mt-6">
             <CampaignForm
               campaign={editingCampaign}
               templates={templates}
               onSuccess={() => setEditingCampaignId(null)}
             />
           </div>
         )}
       </SheetContent>
     </Sheet>
     ```

     Use `sm:max-w-xl` (576px) for the Sheet width — enough for the touch sequence editor's 3-column grid.

  **Step 3: Pass templates to CampaignList from the campaigns page**

  In `app/(dashboard)/campaigns/page.tsx`:

  1. Import `getAvailableTemplates` from `@/lib/data/message-template`
  2. Add it to the `Promise.all`:
     ```typescript
     const [campaigns, presets, templates] = await Promise.all([
       getCampaigns({ includePresets: false }),
       getCampaignPresets(),
       getAvailableTemplates(),
     ])
     ```
  3. Pass `templates` to `CampaignList`:
     ```tsx
     <CampaignList campaigns={campaigns} templates={templates} />
     ```

  **Step 4: Keep the full-page edit route working**

  Do NOT remove `app/(dashboard)/campaigns/[id]/edit/page.tsx`. It serves as:
  - Deep link target (bookmarks, shared URLs)
  - Fallback for complex editing scenarios
  - The route still works independently with its own data fetching

  The CampaignForm already handles both contexts (Sheet with onSuccess vs full-page with router.push).
  </action>
  <verify>
  - `pnpm typecheck` passes
  - `pnpm lint` passes
  - `CampaignForm` has `onSuccess?: () => void` prop
  - `CampaignList` manages `editingCampaignId` state and renders a Sheet with CampaignForm
  - `campaigns/page.tsx` fetches templates and passes them to CampaignList
  - The full-page edit route (`/campaigns/[id]/edit`) still exists and works independently
  </verify>
  <done>Campaign editing opens as a right-side Sheet panel from the campaign list. The form's onSuccess callback closes the sheet. Full-page edit route preserved for deep links. Templates are loaded once at the page level and shared with the edit sheet.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with zero errors
2. `pnpm lint` passes with zero errors
3. Campaign card outer div has `onClick` with `router.push`, controls div has `e.stopPropagation()`
4. CampaignForm has `onSuccess` prop that controls navigation behavior
5. CampaignList manages Sheet state and renders CampaignForm inside it
6. Back links on campaign detail/edit use `inline-flex w-fit`
7. PresetPicker grid has `max-w-3xl mx-auto` and deterministic sort order
8. Full-page edit route still exists and functions independently
</verification>

<success_criteria>
- Clicking a campaign card body navigates to detail; clicking Switch or menu does NOT navigate
- "Edit" from dropdown opens a Sheet panel with the campaign form pre-filled
- Saving in the Sheet persists changes and closes the panel
- Back links on campaign detail/edit pages have normal-sized (content-width) hit areas
- Preset cards are centered with Standard in the middle
- All existing functionality (status toggle, duplicate, delete) still works
- Typecheck and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/37-jobs-campaigns-ux-fixes/37-03-SUMMARY.md`
</output>
