---
phase: 28-onboarding-redesign
plan: 05
type: execute
wave: 3
depends_on: ["28-03", "28-04"]
files_modified:
  - components/onboarding/steps/business-basics-step.tsx
  - components/onboarding/steps/review-destination-step.tsx
  - components/onboarding/steps/services-offered-step.tsx
  - components/onboarding/steps/software-used-step.tsx
  - components/onboarding/onboarding-steps.tsx
autonomous: true

must_haves:
  truths:
    - "Step 1 saves business name, phone, and Google review link via saveBusinessBasics action"
    - "Step 2 validates Google review link format and allows test-open in new tab"
    - "Step 3 multi-select from 8 service types, saves with timing defaults"
    - "Step 4 shows software options (ServiceTitan/Jobber/Housecall Pro/None), is skippable"
  artifacts:
    - path: "components/onboarding/steps/business-basics-step.tsx"
      provides: "Step 1 form: business name, phone, Google review link"
      exports: ["BusinessBasicsStep"]
    - path: "components/onboarding/steps/review-destination-step.tsx"
      provides: "Step 2 form: Google review link validation and preview"
      exports: ["ReviewDestinationStep"]
    - path: "components/onboarding/steps/services-offered-step.tsx"
      provides: "Step 3 form: service type multi-select checkboxes with timing display"
      exports: ["ServicesOfferedStep"]
    - path: "components/onboarding/steps/software-used-step.tsx"
      provides: "Step 4 form: software selection radio group"
      exports: ["SoftwareUsedStep"]
  key_links:
    - from: "components/onboarding/steps/business-basics-step.tsx"
      to: "lib/actions/onboarding.ts"
      via: "saveBusinessBasics server action call"
      pattern: "saveBusinessBasics"
    - from: "components/onboarding/steps/services-offered-step.tsx"
      to: "lib/actions/onboarding.ts"
      via: "saveServicesOffered server action call"
      pattern: "saveServicesOffered"
    - from: "components/onboarding/onboarding-steps.tsx"
      to: "components/onboarding/steps/business-basics-step.tsx"
      via: "case 1 renders BusinessBasicsStep"
      pattern: "BusinessBasicsStep"
---

<objective>
Build step components 1-4 (Business Basics, Review Destination, Services Offered, Software Used) and wire them into the step router.

Purpose: Steps 1-4 collect core business information needed for campaign and messaging configuration. Step 1 and 3 are required, Steps 2 and 4 are skippable.

Output: Four complete step components integrated into the onboarding wizard.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@components/onboarding/onboarding-steps.tsx
@components/onboarding/onboarding-wizard.tsx
@lib/actions/onboarding.ts
@lib/validations/onboarding.ts
@lib/validations/job.ts
@.planning/phases/28-onboarding-redesign/28-03-SUMMARY.md
@.planning/phases/28-onboarding-redesign/28-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create step components 1-4</name>
  <files>components/onboarding/steps/business-basics-step.tsx, components/onboarding/steps/review-destination-step.tsx, components/onboarding/steps/services-offered-step.tsx, components/onboarding/steps/software-used-step.tsx</files>
  <action>
Create 4 new step components. Each is a 'use client' component following the existing onboarding step pattern (useState, useTransition, form submit, server action call).

**components/onboarding/steps/business-basics-step.tsx** (REPLACE existing business-step.tsx content):
- `'use client'` directive
- Props: `{ onComplete: () => void, defaultValues?: { name?: string, phone?: string, google_review_link?: string } }`
- Three input fields: Business Name (required, autoFocus), Phone Number (optional, type="tel", placeholder "(555) 123-4567"), Google Review Link (optional, type="url", placeholder "https://g.page/r/...")
- Submit calls `saveBusinessBasics({ name, phone, googleReviewLink })` from `@/lib/actions/onboarding`
- Validation: name required (min 1 char), phone optional, googleReviewLink optional
- Error display per field
- Single "Continue" button, disabled while pending
- Heading: "Let's get your business set up" / "This info appears in your review request messages."
- Use Input, Button, Label from @/components/ui

**components/onboarding/steps/review-destination-step.tsx** (NEW file):
- Props: `{ onComplete: () => void, onGoBack: () => void, defaultLink?: string }`
- One input field: Google Review Link (pre-filled from step 1 if provided)
- URL validation: `new URL(link)` + must include 'google' in the URL
- "Test your link" button that opens the link in a new tab: `window.open(link, '_blank')`
- Show a success indicator after user clicks test: green checkmark + "Link opens correctly"
- Submit calls `saveReviewDestination({ googleReviewLink })` from `@/lib/actions/onboarding`
- Button row: "Back" (outline, calls onGoBack) and "Continue" (primary)
- "Skip for now" text link below buttons
- Heading: "Verify your Google review link" / "Make sure the link opens your Google review page."

**components/onboarding/steps/services-offered-step.tsx** (NEW file):
- Props: `{ onComplete: () => void, onGoBack: () => void, defaultEnabled?: string[] }`
- Import SERVICE_TYPES, SERVICE_TYPE_LABELS, DEFAULT_TIMING_HOURS from `@/lib/validations/job`
- 2-column grid of checkboxes (4x2 on desktop, 1 column on mobile)
- Each checkbox shows: service type label + timing info (e.g., "HVAC -- Review request: 24h after job")
- Use Checkbox from @radix-ui/react-checkbox (already imported in project)
- Minimum 1 selection required (validate before submit)
- Submit calls `saveServicesOffered({ serviceTypes: selected })` from `@/lib/actions/onboarding`
- Button row: "Back" (outline) and "Continue" (primary, disabled if none selected)
- Error message: "Select at least one service type"
- Heading: "What services does your business offer?" / "We'll use this to set up smart follow-up timing."

**components/onboarding/steps/software-used-step.tsx** (NEW file):
- Props: `{ onComplete: () => void, onGoBack: () => void, defaultValue?: string }`
- Import SOFTWARE_OPTIONS from `@/lib/validations/onboarding`
- Radio-style card selection (not native radio buttons):
  - ServiceTitan (icon or description: "Enterprise field service management")
  - Jobber (description: "Small-to-mid field service scheduling")
  - Housecall Pro (description: "Home service business management")
  - None / Other (description: "I use something else or no software")
- Click a card to select, highlighted with border-primary
- Submit calls `saveSoftwareUsed({ softwareUsed: selected })` from `@/lib/actions/onboarding`
- Button row: "Back" (outline) and "Continue" (primary)
- "Skip for now" text link below buttons
- Heading: "What software do you use to manage jobs?" / "This helps us plan future integrations. Optional -- skip if unsure."
- Info banner: "This is for our roadmap planning only. No integration will be set up now."
  </action>
  <verify>Run `pnpm typecheck` -- all 4 step component files compile without errors.</verify>
  <done>Four step components created: BusinessBasicsStep (name/phone/link), ReviewDestinationStep (link verify), ServicesOfferedStep (multi-select), SoftwareUsedStep (radio cards).</done>
</task>

<task type="auto">
  <name>Task 2: Wire step components into step router</name>
  <files>components/onboarding/onboarding-steps.tsx</files>
  <action>
Update `onboarding-steps.tsx` to import and render the real step components for cases 1-4, replacing placeholder steps and the inline BusinessNameStep / GoogleReviewLinkStep.

Add imports at top:
```typescript
import { BusinessBasicsStep } from './steps/business-basics-step'
import { ReviewDestinationStep } from './steps/review-destination-step'
import { ServicesOfferedStep } from './steps/services-offered-step'
import { SoftwareUsedStep } from './steps/software-used-step'
```

Update switch cases 1-4:
```typescript
case 1:
  return (
    <BusinessBasicsStep
      onComplete={onGoToNext}
      defaultValues={{
        name: business?.name || '',
        phone: business?.phone || '',
        google_review_link: business?.google_review_link || '',
      }}
    />
  )
case 2:
  return (
    <ReviewDestinationStep
      onComplete={onGoToNext}
      onGoBack={onGoBack}
      defaultLink={business?.google_review_link || ''}
    />
  )
case 3:
  return (
    <ServicesOfferedStep
      onComplete={onGoToNext}
      onGoBack={onGoBack}
      defaultEnabled={business?.service_types_enabled || []}
    />
  )
case 4:
  return (
    <SoftwareUsedStep
      onComplete={onGoToNext}
      onGoBack={onGoBack}
      defaultValue={business?.software_used || ''}
    />
  )
```

Remove the inline BusinessNameStep and GoogleReviewLinkStep functions that were previously defined in this file (they're replaced by the new imported components).

Keep the PlaceholderStep component for cases 5-7 (will be replaced in Plan 06).

Remove unused imports that were only needed by the old inline steps (updateBusiness, saveReviewLink from business.ts).
  </action>
  <verify>Run `pnpm typecheck` and `pnpm lint` -- no errors. Navigate through steps 1-4 in browser.</verify>
  <done>Steps 1-4 render real step components with forms, validation, and server action calls. Old inline step components removed.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Step 1 shows business name, phone, and Google review link inputs
4. Step 2 shows link verification with "Test your link" button
5. Step 3 shows 8 service type checkboxes with timing info
6. Step 4 shows 4 software option cards
7. All steps have proper Back/Continue navigation
8. Steps 2 and 4 have "Skip for now" option
</verification>

<success_criteria>
- Step 1 saves business name, phone, Google review link via saveBusinessBasics
- Step 2 validates URL, allows test-open, saves via saveReviewDestination
- Step 3 requires minimum 1 selection, shows timing defaults, saves via saveServicesOffered
- Step 4 shows software options, is skippable, saves via saveSoftwareUsed
- All 4 steps wired into step router replacing inline components
- `pnpm typecheck` passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/28-onboarding-redesign/28-05-SUMMARY.md`
</output>
