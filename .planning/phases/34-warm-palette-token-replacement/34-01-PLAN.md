---
phase: 34-warm-palette-token-replacement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - tailwind.config.ts
  - components/history/status-badge.tsx
  - components/ui/button.tsx
  - components/ui/select.tsx
  - components/ui/dropdown-menu.tsx
  - components/ui/dialog.tsx
  - components/jobs/customer-autocomplete.tsx
  - components/ai/preview-diff.tsx
autonomous: true

must_haves:
  truths:
    - "Light mode uses warm cream background (36 20% 96%), warm near-black foreground (24 10% 10%), soft blue primary (213 60% 42%), and amber accent (38 92% 50%)"
    - "Dark mode uses independently calibrated warm values with H=24 backgrounds at 8% saturation, not lightness-inverted light mode"
    - "New semantic tokens --highlight, --highlight-foreground, --surface, --surface-foreground exist in both globals.css and tailwind.config.ts"
    - "Status badges use Tailwind token classes (bg-status-*-bg text-status-*-text) instead of inline style with hardcoded hex values"
    - "UI primitive focus/hover states use bg-muted instead of bg-accent to prevent amber wash on interactive elements"
    - "Customer autocomplete dropdown uses bg-muted for hover/active states, not bg-accent"
    - "AI preview-diff highlight spans use bg-highlight text-highlight-foreground instead of bg-primary/15 text-primary"
    - "Primary button text passes WCAG AA contrast (4.5:1) on the new primary color"
  artifacts:
    - path: "app/globals.css"
      provides: "Complete warm palette CSS custom properties for light and dark mode"
      contains: "--highlight"
    - path: "tailwind.config.ts"
      provides: "highlight and surface token mappings"
      contains: "highlight"
    - path: "components/history/status-badge.tsx"
      provides: "Token-based status badge component"
      contains: "bg-status-pending-bg"
    - path: "components/ui/button.tsx"
      provides: "Muted hover states for outline and ghost variants"
      contains: "hover:bg-muted"
    - path: "components/jobs/customer-autocomplete.tsx"
      provides: "Muted hover/active states for autocomplete dropdown"
      contains: "bg-muted"
    - path: "components/ai/preview-diff.tsx"
      provides: "Highlight token usage for diff-added spans"
      contains: "bg-highlight"
  key_links:
    - from: "app/globals.css"
      to: "tailwind.config.ts"
      via: "CSS variable names match Tailwind config keys"
      pattern: "--highlight.*highlight"
    - from: "components/history/status-badge.tsx"
      to: "tailwind.config.ts status entries"
      via: "Tailwind class names resolve to CSS variables"
      pattern: "bg-status-pending-bg"
    - from: "components/ui/button.tsx"
      to: "app/globals.css --muted"
      via: "hover:bg-muted resolves to warm muted color"
      pattern: "hover:bg-muted"
---

<objective>
Replace all CSS custom property values in globals.css with the warm amber/gold palette, add four new semantic tokens (highlight, surface) to both globals.css and tailwind.config.ts, migrate status-badge.tsx from hardcoded inline hex styles to Tailwind token classes, and update UI primitive components to use bg-muted instead of bg-accent for interactive focus/hover states.

Purpose: This is the core palette swap that transforms AvisLoop from cold neutral gray to a warm cream/amber design system. Every component that uses CSS tokens gets the warm palette automatically. The status badge and UI primitive changes prevent visual breakage from the accent token changing from blue to amber.

Output: Warm palette rendering across the entire app, with independently calibrated dark mode, WCAG AA contrast on all interactive text, and status badges that remain visually distinct on the warm background.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-warm-palette-token-replacement/34-RESEARCH.md
@app/globals.css
@tailwind.config.ts
@components/history/status-badge.tsx
@components/ui/button.tsx
@components/ui/select.tsx
@components/ui/dropdown-menu.tsx
@components/ui/dialog.tsx
@components/jobs/customer-autocomplete.tsx
@components/ai/preview-diff.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace CSS custom property values in globals.css and add new tokens to tailwind.config.ts</name>
  <files>
    app/globals.css
    tailwind.config.ts
  </files>
  <action>
    **globals.css — Replace the entire `:root` block with these exact values:**

    ```css
    :root {
      --background: 36 20% 96%;
      --foreground: 24 10% 10%;
      --card: 36 15% 99%;
      --card-foreground: 24 10% 10%;
      --popover: 36 15% 99%;
      --popover-foreground: 24 10% 10%;
      --primary: 213 60% 42%;
      --primary-foreground: 0 0% 98%;
      --secondary: 36 15% 92%;
      --secondary-foreground: 24 10% 10%;
      --muted: 36 10% 94%;
      --muted-foreground: 30 6% 40%;
      --accent: 38 92% 50%;
      --accent-foreground: 24 10% 10%;
      --accent-lime: 75 85% 55%;
      --accent-coral: 0 85% 65%;
      --destructive: 0 84% 60%;
      --destructive-foreground: 0 0% 98%;
      --border: 36 12% 87%;
      --input: 36 12% 87%;
      --ring: 213 60% 42%;
      --highlight: 38 85% 90%;
      --highlight-foreground: 24 10% 10%;
      --surface: 36 12% 97%;
      --surface-foreground: 24 10% 10%;
      --chart-1: 12 76% 61%;
      --chart-2: 173 58% 39%;
      --chart-3: 197 37% 24%;
      --chart-4: 280 50% 55%;
      --chart-5: 340 65% 55%;
      --status-pending-bg: 220 14% 90%;
      --status-pending-text: 220 43% 11%;
      --status-delivered-bg: 194 38% 87%;
      --status-delivered-text: 189 57% 40%;
      --status-clicked-bg: 43 92% 82%;
      --status-clicked-text: 30 100% 27%;
      --status-failed-bg: 0 100% 89%;
      --status-failed-text: 358 100% 38%;
      --status-reviewed-bg: 138 68% 86%;
      --status-reviewed-text: 149 100% 25%;
      --radius: 0.5rem;
    }
    ```

    Key changes from current values:
    - background: `0 0% 97.6%` -> `36 20% 96%` (warm cream)
    - foreground: `0 0% 9%` -> `24 10% 10%` (warm near-black)
    - card: `0 0% 100%` -> `36 15% 99%` (warm near-white)
    - primary: `224 75% 43%` -> `213 60% 42%` (soft blue, slightly desaturated)
    - secondary: `0 0% 92%` -> `36 15% 92%` (warm gray)
    - muted: `0 0% 97%` -> `36 10% 94%` (warm muted)
    - muted-foreground: `0 0% 45%` -> `30 6% 40%` (5.21:1 AA on warm bg)
    - accent: `224 75% 43%` -> `38 92% 50%` (amber — DECORATIVE ONLY)
    - border/input: `0 0% 89%` -> `36 12% 87%` (warm-tinted border)
    - ring: `224 75% 43%` -> `213 60% 42%` (matches new primary)
    - chart-4: `43 74% 66%` -> `280 50% 55%` (purple — distinct on warm)
    - chart-5: `27 87% 67%` -> `340 65% 55%` (rose — distinct on warm)
    - All status-*-bg values darkened by 5-6 L points for warm bg distinguishability
    - clicked-bg hue shifted: `54 96% 88%` -> `43 92% 82%` (warmer, darker)
    - 4 NEW tokens added: highlight, highlight-foreground, surface, surface-foreground

    **globals.css — Replace the entire `.dark` block with these exact values:**

    ```css
    .dark {
      --background: 24 8% 10%;
      --foreground: 36 15% 96%;
      --card: 24 8% 13%;
      --card-foreground: 36 15% 96%;
      --popover: 24 8% 13%;
      --popover-foreground: 36 15% 96%;
      --primary: 213 60% 58%;
      --primary-foreground: 24 8% 10%;
      --secondary: 24 6% 16%;
      --secondary-foreground: 36 15% 96%;
      --muted: 24 6% 16%;
      --muted-foreground: 30 8% 62%;
      --accent: 38 85% 52%;
      --accent-foreground: 24 8% 10%;
      --accent-lime: 75 85% 50%;
      --accent-coral: 0 85% 60%;
      --destructive: 0 84% 60%;
      --destructive-foreground: 36 15% 96%;
      --border: 24 6% 20%;
      --input: 24 6% 20%;
      --ring: 213 60% 58%;
      --highlight: 38 85% 30%;
      --highlight-foreground: 36 15% 96%;
      --surface: 24 8% 15%;
      --surface-foreground: 36 15% 96%;
      --chart-1: 220 70% 50%;
      --chart-2: 160 60% 45%;
      --chart-3: 30 80% 55%;
      --chart-4: 280 65% 60%;
      --chart-5: 340 75% 55%;
      --status-pending-bg: 220 14% 20%;
      --status-pending-text: 220 14% 80%;
      --status-delivered-bg: 189 30% 20%;
      --status-delivered-text: 189 57% 55%;
      --status-clicked-bg: 40 40% 20%;
      --status-clicked-text: 30 80% 50%;
      --status-failed-bg: 0 40% 20%;
      --status-failed-text: 358 80% 55%;
      --status-reviewed-bg: 149 30% 20%;
      --status-reviewed-text: 149 80% 45%;
    }
    ```

    Key dark mode decisions:
    - Backgrounds use H=24 (warm brown-black), NOT H=0 (pure gray)
    - Saturation 6-8% (subtle warmth that becomes perceptible at 13-16% L)
    - Primary at 58% L uses DARK text foreground (24 8% 10%) — contrast is 5.13:1 (AA PASS) vs white's 3.36:1 (FAIL)
    - Foreground uses H=36 S=15% (warm white), not pure white
    - destructive-foreground uses warm near-white (36 15% 96%) not pure white
    - 4 NEW dark mode tokens added: highlight, highlight-foreground, surface, surface-foreground
    - Dark mode status tokens unchanged from current (they already work)

    **tailwind.config.ts — Add two new token entries in the `colors` section:**

    After the existing `accent` entry (around line 37-40), add:

    ```ts
    highlight: {
      DEFAULT: "hsl(var(--highlight))",
      foreground: "hsl(var(--highlight-foreground))",
    },
    surface: {
      DEFAULT: "hsl(var(--surface))",
      foreground: "hsl(var(--surface-foreground))",
    },
    ```

    Place these between the `accent` block and the `lime` block. This follows the existing shadcn/ui convention of `DEFAULT` + `foreground` pairs.

    **DO NOT** modify any other parts of tailwind.config.ts. Leave the existing color entries, borderRadius, keyframes, and animation sections unchanged.
  </action>
  <verify>
    Run `pnpm typecheck` — must pass with zero errors.
    Run `grep -c "highlight" app/globals.css` — should return 4 (two light, two dark).
    Run `grep -c "surface" app/globals.css` — should return 4 (two light, two dark).
    Run `grep "highlight" tailwind.config.ts` — should show the new token mapping entries.
    Run `grep "38 92% 50%" app/globals.css` — should match the new accent value in :root.
    Run `grep "24 8% 10%" app/globals.css` — should match the dark mode background.
  </verify>
  <done>
    globals.css contains the complete warm palette for both light and dark mode with all 4 new semantic tokens. tailwind.config.ts maps highlight and surface tokens to Tailwind utilities. Typecheck passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate status-badge.tsx from inline hex styles to Tailwind token classes</name>
  <files>
    components/history/status-badge.tsx
  </files>
  <action>
    Rewrite the `statusConfig` object and Badge rendering in `components/history/status-badge.tsx` to use Tailwind token classes instead of inline `style` props with hardcoded hex values.

    **Replace the entire `statusConfig` record:**

    Remove the `bg: string` and `text: string` fields. Replace with a single `className: string` field that uses the status token classes from tailwind.config.ts. Add a border to each status for warm-background distinguishability (research finding: badge BGs at 86-90% L blend into 96% L warm background without borders).

    ```tsx
    const statusConfig: Record<SendStatus, {
      label: string
      className: string
      Icon: typeof CircleNotch
    }> = {
      pending: {
        label: 'Pending',
        className: 'bg-status-pending-bg text-status-pending-text border border-status-pending-text/20',
        Icon: CircleNotch
      },
      delivered: {
        label: 'Delivered',
        className: 'bg-status-delivered-bg text-status-delivered-text border border-status-delivered-text/20',
        Icon: CheckCircle
      },
      clicked: {
        label: 'Clicked',
        className: 'bg-status-clicked-bg text-status-clicked-text border border-status-clicked-text/20',
        Icon: Cursor
      },
      failed: {
        label: 'Failed',
        className: 'bg-status-failed-bg text-status-failed-text border border-status-failed-text/20',
        Icon: WarningCircle
      },
      reviewed: {
        label: 'Reviewed',
        className: 'bg-status-reviewed-bg text-status-reviewed-text border border-status-reviewed-text/20',
        Icon: Star
      },
      scheduled: {
        label: 'Scheduled',
        className: 'bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300 border border-purple-200 dark:border-purple-800',
        Icon: CheckCircle
      }
    }
    ```

    Note: `scheduled` has no CSS token — use Tailwind color-scale classes for now (documented for Phase 35 tokenization).

    **Update the Badge JSX rendering:**

    Remove the `style` prop entirely. Change `border-0` to allow borders. Apply the className from config:

    ```tsx
    return (
      <Badge
        className={cn(
          config.className,
          'inline-flex items-center gap-1.5 px-2.5 py-0.5 text-xs font-semibold rounded-full',
          className
        )}
      >
        <Icon
          className={normalizedStatus === 'pending' ? 'h-3.5 w-3.5 animate-spin' : 'h-3.5 w-3.5'}
          weight="bold"
        />
        {config.label}
      </Badge>
    )
    ```

    Critical changes:
    - `style={{ backgroundColor: config.bg, color: config.text }}` is REMOVED
    - `border-0` is REMOVED from the className string (borders are now added per-status)
    - The config.className is placed FIRST in cn() so it takes precedence
    - The Badge component's default border styling is overridden by the per-status border class
  </action>
  <verify>
    Run `pnpm typecheck` — must pass.
    Run `pnpm lint` — must pass.
    Run `grep "style=" components/history/status-badge.tsx` — should return zero hits (no inline styles).
    Run `grep "border-0" components/history/status-badge.tsx` — should return zero hits.
    Run `grep "bg-status-" components/history/status-badge.tsx` — should return 5 hits (one per tokenized status).
    Run `grep "#" components/history/status-badge.tsx` — should return zero hits (no hex colors).
  </verify>
  <done>
    StatusBadge component uses Tailwind token classes for all 5 primary statuses. No inline styles remain. Each badge has a border for warm-background distinguishability. Scheduled status uses Tailwind color-scale classes (documented for Phase 35 tokenization).
  </done>
</task>

<task type="auto">
  <name>Task 3: Update UI primitive and component focus/hover states from bg-accent to bg-muted, and migrate preview-diff to highlight token</name>
  <files>
    components/ui/button.tsx
    components/ui/select.tsx
    components/ui/dropdown-menu.tsx
    components/ui/dialog.tsx
    components/jobs/customer-autocomplete.tsx
    components/ai/preview-diff.tsx
  </files>
  <action>
    Since `--accent` changed from blue to amber, all interactive focus/hover states using `bg-accent` will turn amber. This creates a visual disconnect from the blue primary color on interactive elements. Replace `bg-accent` with `bg-muted` (or `bg-secondary` for button outline) on interactive state classes in these 4 UI primitive files.

    **components/ui/button.tsx — Update outline and ghost variants:**

    The outline variant currently has:
    ```
    "border bg-background hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50"
    ```

    Replace with:
    ```
    "border bg-background hover:bg-secondary hover:text-secondary-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50"
    ```

    The ghost variant currently has:
    ```
    "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50"
    ```

    Replace with:
    ```
    "hover:bg-muted hover:text-foreground dark:hover:bg-muted/50"
    ```

    Rationale: Outline buttons get `bg-secondary` (slightly more prominent hover) while ghost buttons get `bg-muted` (subtler hover). Both remain neutral gray-family colors instead of amber.

    **components/ui/select.tsx — Update SelectItem focus state (line 121):**

    Change:
    ```
    "focus:bg-accent focus:text-accent-foreground"
    ```

    To:
    ```
    "focus:bg-muted focus:text-foreground"
    ```

    **components/ui/dropdown-menu.tsx — Update 4 focus/open state locations:**

    Line 30 (DropdownMenuSubTrigger):
    Change `focus:bg-accent data-[state=open]:bg-accent` to `focus:bg-muted data-[state=open]:bg-muted`

    Line 87 (DropdownMenuItem):
    Change `focus:bg-accent focus:text-accent-foreground` to `focus:bg-muted focus:text-foreground`

    Line 103 (DropdownMenuCheckboxItem):
    Change `focus:bg-accent focus:text-accent-foreground` to `focus:bg-muted focus:text-foreground`

    Line 127 (DropdownMenuRadioItem):
    Change `focus:bg-accent focus:text-accent-foreground` to `focus:bg-muted focus:text-foreground`

    **components/ui/dialog.tsx — Update dialog close button open state:**

    Find the DialogPrimitive.Close element with:
    ```
    data-[state=open]:bg-accent data-[state=open]:text-muted-foreground
    ```

    Change to:
    ```
    data-[state=open]:bg-muted data-[state=open]:text-muted-foreground
    ```

    **components/jobs/customer-autocomplete.tsx — Update 3 bg-accent usages:**

    Line 153: Change `hover:bg-accent` to `hover:bg-muted`
    Line 154: Change `'bg-accent'` to `'bg-muted'`
    Line 167: Change `hover:bg-accent` to `hover:bg-muted`

    These are the autocomplete dropdown items for customer selection in the Add Job sheet. Without this change, hovering over customer suggestions will flash amber.

    **components/ai/preview-diff.tsx — Migrate to highlight token (line 128):**

    Change:
    ```
    className="bg-primary/15 text-primary rounded px-0.5 dark:bg-primary/25"
    ```

    To:
    ```
    className="bg-highlight text-highlight-foreground rounded px-0.5"
    ```

    This is the diff-added span highlight in the AI personalization preview. The research document explicitly identifies this as the primary use case for the `--highlight` token created in Task 1. The old `bg-primary/15` would remain cold-blue-tinted; the new `bg-highlight` uses the warm amber-tinted highlight defined in globals.css (`38 85% 90%` light, `38 85% 30%` dark). The `dark:bg-primary/25` override is no longer needed because the highlight token has its own dark mode value.

    **Do NOT change any other classes in these files.** Only replace the accent-based interactive state classes and the preview-diff highlight class identified above.
  </action>
  <verify>
    Run `pnpm typecheck` — must pass.
    Run `pnpm lint` — must pass.
    Run `grep "bg-accent" components/ui/button.tsx` — should return zero hits.
    Run `grep "bg-accent" components/ui/select.tsx` — should return zero hits.
    Run `grep "bg-accent" components/ui/dropdown-menu.tsx` — should return zero hits.
    Run `grep "bg-accent" components/ui/dialog.tsx` — should return zero hits.
    Run `grep "bg-accent" components/jobs/customer-autocomplete.tsx` — should return zero hits.
    Run `grep "bg-muted" components/ui/button.tsx` — should return at least 1 hit (ghost variant).
    Run `grep "bg-secondary" components/ui/button.tsx` — should return at least 1 hit (outline variant).
    Run `grep "bg-muted" components/jobs/customer-autocomplete.tsx` — should return at least 3 hits.
    Run `grep "bg-highlight" components/ai/preview-diff.tsx` — should return 1 hit.
    Run `grep "bg-primary/15" components/ai/preview-diff.tsx` — should return zero hits.
  </verify>
  <done>
    All 4 UI primitive files plus customer-autocomplete.tsx use bg-muted or bg-secondary for interactive hover/focus states instead of bg-accent. preview-diff.tsx uses bg-highlight text-highlight-foreground instead of bg-primary/15 text-primary. The amber accent token is now purely decorative and will not appear on dropdown items, select items, button hovers, dialog states, autocomplete suggestions, or diff highlights.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with zero errors
2. `pnpm lint` passes with zero errors
3. `grep "bg-accent" components/ui/button.tsx components/ui/select.tsx components/ui/dropdown-menu.tsx components/ui/dialog.tsx components/jobs/customer-autocomplete.tsx` returns zero hits
4. `grep "style=" components/history/status-badge.tsx` returns zero hits (no inline styles)
5. `grep -c "highlight" app/globals.css` returns 4 (light + dark mode pairs)
6. `grep -c "surface" app/globals.css` returns 4 (light + dark mode pairs)
7. `grep "38 92% 50%" app/globals.css` matches amber accent in :root
8. `grep "24 8% 10%" app/globals.css` matches warm dark background in .dark
9. `grep "213 60% 42%" app/globals.css` matches soft blue primary in :root
10. `grep "bg-highlight" components/ai/preview-diff.tsx` returns 1 hit
11. `grep "bg-primary/15" components/ai/preview-diff.tsx` returns zero hits
</verification>

<success_criteria>
- globals.css contains complete warm palette for both light and dark mode
- 4 new semantic tokens (highlight, highlight-foreground, surface, surface-foreground) defined in both globals.css and tailwind.config.ts
- Status badges use Tailwind token classes with borders for warm-bg distinguishability
- UI primitive and component interactive states use bg-muted/bg-secondary instead of bg-accent (including customer-autocomplete dropdown)
- AI preview-diff highlight spans use bg-highlight token instead of bg-primary/15
- chart-4 and chart-5 updated to purple and rose (distinct on warm background)
- All muted-foreground text passes WCAG AA (4.5:1) on both background and card
- Typecheck and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/34-warm-palette-token-replacement/34-01-SUMMARY.md`
</output>
