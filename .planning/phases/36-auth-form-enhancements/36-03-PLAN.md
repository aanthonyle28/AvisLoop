---
phase: 36-auth-form-enhancements
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Clicking Continue with Google opens the Google consent screen"
    - "After granting consent, user is redirected back to the app with an authenticated session"
    - "If Google OAuth is not configured, the specific misconfiguration is identified and documented"
  artifacts: []
  key_links:
    - from: "components/auth/google-oauth-button.tsx"
      to: "lib/actions/auth.ts signInWithGoogle"
      via: "server action call"
      pattern: "signInWithGoogle"
    - from: "lib/actions/auth.ts"
      to: "Supabase dashboard Google provider config"
      via: "supabase.auth.signInWithOAuth"
      pattern: "signInWithOAuth.*google"
---

<objective>
Verify that Google OAuth sign-in works end-to-end. The code is already implemented (google-oauth-button.tsx, signInWithGoogle server action, /auth/callback route). This plan verifies the Supabase dashboard configuration and tests the flow. If it fails, diagnose and document the specific issue.

Purpose: AUTH-03 (Google OAuth fix) ensures the existing OAuth code actually works. The most likely failure is Supabase dashboard misconfiguration, not code bugs.
Output: Verified working OAuth flow, or a documented diagnosis of what needs to be configured in the Supabase dashboard.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-auth-form-enhancements/36-RESEARCH.md
@components/auth/google-oauth-button.tsx
@lib/actions/auth.ts
@app/auth/callback/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify OAuth code paths and environment configuration</name>
  <files></files>
  <action>
This is a verification-only task. Do not modify any files.

1. **Check environment variable exists:**
   - Verify `NEXT_PUBLIC_SITE_URL` is set in `.env.local` (do NOT log its value — just confirm it exists and starts with `http`)
   - If missing, note it as a finding

2. **Check code is correct (read-only verification):**
   - Read `components/auth/google-oauth-button.tsx` — verify it calls `signInWithGoogle()` and navigates to `result.url`
   - Read `lib/actions/auth.ts` — verify `signInWithGoogle` calls `supabase.auth.signInWithOAuth({ provider: 'google' })` with `redirectTo` using `NEXT_PUBLIC_SITE_URL`
   - Read `app/auth/callback/route.ts` — verify it calls `exchangeCodeForSession(code)` and redirects to `/dashboard`
   - Read `app/auth/login/page.tsx` or equivalent — verify `GoogleOAuthButton` is rendered on the login page
   - Read `app/auth/sign-up/page.tsx` or equivalent — verify `GoogleOAuthButton` is rendered on the signup page

3. **Check for common issues:**
   - Verify `NEXT_PUBLIC_SITE_URL` does NOT have a trailing slash (would cause redirect URL mismatch)
   - Verify the callback route is at `app/auth/callback/route.ts` (not `app/api/auth/callback/route.ts`)

4. **Document findings** in the summary. Expected outcome: code is correct, OAuth depends on Supabase dashboard configuration (Google provider enabled, redirect URLs allowlisted, Google Cloud Console client ID + secret).
  </action>
  <verify>
All three code files (google-oauth-button.tsx, auth.ts signInWithGoogle, auth/callback/route.ts) are verified correct. NEXT_PUBLIC_SITE_URL exists in .env.local.
  </verify>
  <done>OAuth code paths verified as correct. Environment variable confirmed present. Any missing configuration items documented.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Verified that the Google OAuth code implementation is complete and correct. The three files (GoogleOAuthButton, signInWithGoogle server action, /auth/callback route handler) form a complete PKCE OAuth flow. The task above confirms the code is wired correctly.</what-built>
  <how-to-verify>
**Google OAuth requires Supabase dashboard configuration that Claude cannot perform. Please verify:**

1. **Supabase Dashboard check:**
   - Go to Supabase Dashboard -> Authentication -> Providers -> Google
   - Confirm Google provider is **enabled**
   - Confirm **Client ID** and **Client Secret** are filled in (from Google Cloud Console)

2. **Redirect URL check:**
   - Go to Supabase Dashboard -> Authentication -> URL Configuration -> Redirect URLs
   - Confirm these URLs are in the allowlist:
     - `http://localhost:3000/auth/callback` (for local dev)
     - Your production URL `/auth/callback` (if deployed)

3. **Google Cloud Console check:**
   - Go to Google Cloud Console -> APIs & Services -> Credentials
   - Confirm the OAuth 2.0 Client ID exists
   - Under "Authorized redirect URIs", confirm the Supabase callback URL is listed (format: `https://<your-project>.supabase.co/auth/v1/callback`)

4. **Test the flow (if configured):**
   - Run `pnpm dev`
   - Navigate to http://localhost:3000/auth/login
   - Click "Continue with Google"
   - Expected: Google consent screen appears
   - Grant access
   - Expected: Redirected to /dashboard with authenticated session

**If Google provider is NOT configured in Supabase:** That's OK. Document it as "Google OAuth code is complete but Supabase dashboard configuration is pending" in the summary. This is a production deployment task, not a code bug.
  </how-to-verify>
  <resume-signal>Type "verified" if OAuth works, "not-configured" if Supabase dashboard needs setup, or describe specific issues found</resume-signal>
</task>

</tasks>

<verification>
- OAuth code verified as correct (no code changes needed)
- Supabase dashboard configuration status documented
- If working: full flow tested (login -> Google consent -> callback -> dashboard)
- If not configured: specific missing configuration items documented for production deployment
</verification>

<success_criteria>
1. OAuth code implementation confirmed correct (all three files verified)
2. NEXT_PUBLIC_SITE_URL environment variable confirmed present
3. Supabase dashboard configuration status known (either working or specific gaps documented)
4. No code changes needed (this was verification only)
</success_criteria>

<output>
After completion, create `.planning/phases/36-auth-form-enhancements/36-03-SUMMARY.md`
</output>
