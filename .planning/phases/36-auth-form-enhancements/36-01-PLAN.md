---
phase: 36-auth-form-enhancements
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/ui/input.tsx
  - components/ui/password-input.tsx
  - components/login-form.tsx
  - components/sign-up-form.tsx
  - components/update-password-form.tsx
autonomous: true

must_haves:
  truths:
    - "Password fields on login, signup, and update-password forms show a clickable eye icon that toggles between hidden and visible text"
    - "Pressing Tab from a password field skips the eye toggle and moves to the next form element"
    - "Email and password fields display red borders and inline error text when server validation fails"
  artifacts:
    - path: "components/ui/password-input.tsx"
      provides: "Reusable PasswordInput wrapper with show/hide toggle"
      min_lines: 25
    - path: "components/ui/input.tsx"
      provides: "aria-invalid border and ring styling on the base Input component"
      contains: "aria-invalid:border-destructive"
  key_links:
    - from: "components/login-form.tsx"
      to: "components/ui/password-input.tsx"
      via: "import { PasswordInput }"
      pattern: "import.*PasswordInput.*password-input"
    - from: "components/sign-up-form.tsx"
      to: "components/ui/password-input.tsx"
      via: "import { PasswordInput }"
      pattern: "import.*PasswordInput.*password-input"
    - from: "components/update-password-form.tsx"
      to: "components/ui/password-input.tsx"
      via: "import { PasswordInput }"
      pattern: "import.*PasswordInput.*password-input"
---

<objective>
Create the PasswordInput component with show/hide eye toggle, add aria-invalid styling to the base Input, and replace all password `<Input type="password">` with `<PasswordInput>` across login, signup, and update-password forms. Add `noValidate` to forms and wire `aria-invalid` + `aria-describedby` on inputs with server-side errors.

Purpose: AUTH-01 (password visibility toggle) and AUTH-04 (inline validation indicators) are foundational UX improvements that make auth forms feel polished and accessible.
Output: A new `PasswordInput` component used by all three auth forms, with consistent error styling.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-auth-form-enhancements/36-RESEARCH.md
@components/ui/input.tsx
@components/ui/button.tsx
@components/login-form.tsx
@components/sign-up-form.tsx
@components/update-password-form.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PasswordInput component and add aria-invalid to Input</name>
  <files>components/ui/password-input.tsx, components/ui/input.tsx</files>
  <action>
1. **Create `components/ui/password-input.tsx`** (new file):
   - `'use client'` directive at top
   - Import `Eye`, `EyeSlash` from `@phosphor-icons/react`
   - Import `Input` from `@/components/ui/input`
   - Import `cn` from `@/lib/utils`
   - Component: `PasswordInput` using `React.forwardRef<HTMLInputElement, PasswordInputProps>`
   - `PasswordInputProps` extends `Omit<React.ComponentProps<'input'>, 'type'>` (caller cannot override type)
   - Internal state: `const [show, setShow] = React.useState(false)`
   - Render a `<div className="relative">` wrapper containing:
     - `<Input type={show ? 'text' : 'password'} className={cn('pr-10', className)} ref={ref} {...props} />`
     - `<button type="button" tabIndex={-1} aria-label={show ? 'Hide password' : 'Show password'} onClick={() => setShow(v => !v)} className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground focus:outline-none">`
       - Inside: `{show ? <EyeSlash size={16} weight="regular" aria-hidden /> : <Eye size={16} weight="regular" aria-hidden />}`
   - Set `PasswordInput.displayName = 'PasswordInput'`
   - Export: `export { PasswordInput }`

2. **Update `components/ui/input.tsx`**:
   - Add `aria-invalid:border-destructive aria-invalid:ring-destructive/20` to the className string in the `cn()` call, after the existing `focus-visible:ring-ring` classes
   - This makes any Input with `aria-invalid={true}` show a red border + red ring — matching `button.tsx` pattern
  </action>
  <verify>
Run `pnpm typecheck` — no errors. Verify `password-input.tsx` exports `PasswordInput`. Verify `input.tsx` contains `aria-invalid:border-destructive`.
  </verify>
  <done>PasswordInput component exists with Eye/EyeSlash toggle, tabIndex={-1}, type="button". Input component has aria-invalid red border styling.</done>
</task>

<task type="auto">
  <name>Task 2: Replace Input with PasswordInput in all three auth forms + add noValidate and aria-invalid wiring</name>
  <files>components/login-form.tsx, components/sign-up-form.tsx, components/update-password-form.tsx</files>
  <action>
**In all three files**, add `import { PasswordInput } from '@/components/ui/password-input'` and remove `Input` from imports if it's no longer used (sign-up-form and login-form still use `Input` for email/name fields — keep the import there; update-password-form uses only password fields so `Input` import may become unused — check and remove if so).

**login-form.tsx:**
- Add `noValidate` attribute to the `<form>` element: `<form action={formAction} noValidate className="space-y-4">`
- Replace the password `<Input id="login-password" name="password" type="password" required />` with:
  ```
  <PasswordInput
    id="login-password"
    name="password"
    required
    autoComplete="current-password"
    aria-invalid={!!state?.fieldErrors?.password}
    aria-describedby={state?.fieldErrors?.password ? 'login-password-error' : undefined}
  />
  ```
- Add `id="login-password-error"` and `role="alert"` to the existing password error `<p>` tag
- Add `aria-invalid={!!state?.fieldErrors?.email}` and `aria-describedby={state?.fieldErrors?.email ? 'login-email-error' : undefined}` to the email Input
- Add `id="login-email-error"` and `role="alert"` to the existing email error `<p>` tag

**sign-up-form.tsx:**
- Add `noValidate` attribute to the `<form>` element
- Replace the password `<Input id="signup-password" name="password" type="password" required />` with:
  ```
  <PasswordInput
    id="signup-password"
    name="password"
    required
    autoComplete="new-password"
    aria-invalid={!!state?.fieldErrors?.password}
    aria-describedby={state?.fieldErrors?.password ? 'signup-password-error' : undefined}
  />
  ```
- Add `id="signup-password-error"` and `role="alert"` to the existing password error `<p>` tag
- Add `aria-invalid` and `aria-describedby` to the email Input (same pattern: `signup-email-error`)
- Add `id="signup-email-error"` and `role="alert"` to the existing email error `<p>` tag

**update-password-form.tsx:**
- Add `noValidate` attribute to the `<form>` element
- Replace BOTH password `<Input>` elements with `<PasswordInput>`:
  - First: `<PasswordInput id="password" name="password" placeholder="New password" required autoComplete="new-password" aria-invalid={!!state?.fieldErrors?.password} aria-describedby={state?.fieldErrors?.password ? 'password-error' : undefined} />`
  - Second: `<PasswordInput id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required autoComplete="off" aria-invalid={!!state?.fieldErrors?.confirmPassword} aria-describedby={state?.fieldErrors?.confirmPassword ? 'confirmPassword-error' : undefined} />`
- Add `id="password-error"` and `role="alert"` to the password error `<p>`
- Add `id="confirmPassword-error"` and `role="alert"` to the confirmPassword error `<p>`
- Remove `Input` from imports if it's no longer used (check if any non-password Input remains — it should not, since this form only has password fields)

**Important:** Keep the `Input` import in `login-form.tsx` and `sign-up-form.tsx` because those forms still use `<Input>` for email and full name fields.
  </action>
  <verify>
Run `pnpm typecheck && pnpm lint` — no errors. Grep for `type="password"` in the three form files — should return zero hits (all replaced by PasswordInput). Verify all three forms have `noValidate` on `<form>`.
  </verify>
  <done>All three auth forms use PasswordInput for password fields with eye toggle. Forms use noValidate to suppress browser popups. All error-able inputs have aria-invalid and aria-describedby wired to their error messages.</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- `pnpm lint` passes
- `grep -rn "type=\"password\"" components/login-form.tsx components/sign-up-form.tsx components/update-password-form.tsx` returns zero results
- `grep -rn "PasswordInput" components/login-form.tsx components/sign-up-form.tsx components/update-password-form.tsx` returns at least one hit per file
- `grep -rn "noValidate" components/login-form.tsx components/sign-up-form.tsx components/update-password-form.tsx` returns one hit per file
- `grep -rn "aria-invalid:border-destructive" components/ui/input.tsx` returns one hit
- `grep -rn "tabIndex={-1}" components/ui/password-input.tsx` returns one hit
</verification>

<success_criteria>
1. PasswordInput component exists at components/ui/password-input.tsx with Eye/EyeSlash toggle, tabIndex={-1}, type="button"
2. Input component has aria-invalid red border styling
3. Login, signup, and update-password forms all use PasswordInput instead of Input for password fields
4. All three forms have noValidate on the form element
5. Error-displaying inputs have aria-invalid and aria-describedby correctly wired
6. Typecheck and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/36-auth-form-enhancements/36-01-SUMMARY.md`
</output>
