---
phase: 36-auth-form-enhancements
plan: 02
type: execute
wave: 2
depends_on: ["36-01"]
files_modified:
  - components/ui/password-strength.tsx
  - components/sign-up-form.tsx
  - components/update-password-form.tsx
  - lib/validations/auth.ts
autonomous: true

must_haves:
  truths:
    - "Signup form shows a live 4-item checklist beneath the password field that updates as the user types"
    - "Update-password form shows the same live checklist beneath the new password field"
    - "Checklist is hidden when the password field is empty and appears on first keystroke"
    - "Server-side validation rejects passwords missing uppercase, number, or special character"
  artifacts:
    - path: "components/ui/password-strength.tsx"
      provides: "PasswordStrengthChecklist component with 4 requirement checks"
      min_lines: 20
    - path: "lib/validations/auth.ts"
      provides: "Zod regex rules for uppercase, number, special char on signUpSchema and updatePasswordSchema"
      contains: "regex"
  key_links:
    - from: "components/sign-up-form.tsx"
      to: "components/ui/password-strength.tsx"
      via: "import { PasswordStrengthChecklist }"
      pattern: "import.*PasswordStrengthChecklist.*password-strength"
    - from: "components/update-password-form.tsx"
      to: "components/ui/password-strength.tsx"
      via: "import { PasswordStrengthChecklist }"
      pattern: "import.*PasswordStrengthChecklist.*password-strength"
    - from: "components/sign-up-form.tsx"
      to: "react"
      via: "useState for passwordValue"
      pattern: "useState.*passwordValue|passwordValue.*useState"
---

<objective>
Create the PasswordStrengthChecklist component, wire it into signup and update-password forms with controlled password state, and add strength regex rules to the Zod schemas so server validation matches the displayed checklist.

Purpose: AUTH-02 (password requirements checklist) gives users live feedback while typing, reducing failed submissions and improving password quality. Schema updates ensure server-side validation matches client-side display.
Output: A new PasswordStrengthChecklist component visible on signup and update-password forms, with matching Zod schema rules.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-auth-form-enhancements/36-RESEARCH.md
@.planning/phases/36-auth-form-enhancements/36-01-SUMMARY.md
@components/sign-up-form.tsx
@components/update-password-form.tsx
@lib/validations/auth.ts
@app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PasswordStrengthChecklist component and update Zod schemas</name>
  <files>components/ui/password-strength.tsx, lib/validations/auth.ts</files>
  <action>
1. **Create `components/ui/password-strength.tsx`** (new file):
   - `'use client'` directive at top
   - Import `CheckCircle`, `XCircle` from `@phosphor-icons/react`
   - Import `cn` from `@/lib/utils`
   - Define a `Requirement` type: `{ label: string; met: boolean }`
   - Create a `getRequirements(password: string): Requirement[]` function that returns 4 items:
     1. `{ label: 'At least 8 characters', met: password.length >= 8 }`
     2. `{ label: 'One uppercase letter', met: /[A-Z]/.test(password) }`
     3. `{ label: 'One number', met: /[0-9]/.test(password) }`
     4. `{ label: 'One special character', met: /[^A-Za-z0-9]/.test(password) }`
   - Export `PasswordStrengthChecklist` component accepting `{ password: string }`:
     - Call `getRequirements(password)`
     - If `!password` (empty string), return `null` (hide until user starts typing)
     - Render a `<ul className="mt-2 space-y-1" aria-live="polite" aria-label="Password requirements">`
     - Each `<li>` has `className="flex items-center gap-2 text-xs"`:
       - Met: `<CheckCircle size={14} weight="fill" className="text-success shrink-0" aria-hidden />` + `<span className="text-success-foreground">{label}</span>`
       - Not met: `<XCircle size={14} weight="regular" className="text-muted-foreground shrink-0" aria-hidden />` + `<span className="text-muted-foreground">{label}</span>`
   - Also export `getRequirements` for potential reuse

2. **Update `lib/validations/auth.ts`**:
   - In `signUpSchema`, add three `.regex()` refinements to the `password` field AFTER the existing `.min(8)` and `.max(72)`:
     - `.regex(/[A-Z]/, 'Password must contain at least one uppercase letter')`
     - `.regex(/[0-9]/, 'Password must contain at least one number')`
     - `.regex(/[^A-Za-z0-9]/, 'Password must contain at least one special character')`
   - In `updatePasswordSchema`, add the same three `.regex()` refinements to the `password` field AFTER `.min(8)` and `.max(72)`, BEFORE the `.refine()` for password match
   - Do NOT change `signInSchema` (login doesn't enforce strength rules — you sign in with whatever password you set)
  </action>
  <verify>
Run `pnpm typecheck` — no errors. Verify `password-strength.tsx` exports both `PasswordStrengthChecklist` and `getRequirements`. Verify `auth.ts` contains three `.regex()` calls on each of `signUpSchema` and `updatePasswordSchema` password fields.
  </verify>
  <done>PasswordStrengthChecklist component exists showing 4 requirements with CheckCircle/XCircle icons. Zod schemas for signup and update-password enforce uppercase, number, and special character via regex.</done>
</task>

<task type="auto">
  <name>Task 2: Wire checklist into signup and update-password forms with controlled state</name>
  <files>components/sign-up-form.tsx, components/update-password-form.tsx</files>
  <action>
**sign-up-form.tsx:**
- Add import: `import { PasswordStrengthChecklist } from '@/components/ui/password-strength'`
- Add import: `import { useState } from 'react'` (add `useState` to the existing `useActionState` import from `react` if not already imported)
- Add state: `const [passwordValue, setPasswordValue] = useState('')`
- On the `<PasswordInput>` for password (which was added in Plan 36-01), add:
  - `value={passwordValue}`
  - `onChange={(e) => setPasswordValue(e.target.value)}`
- Directly AFTER the password error `<p>` tag (the `state?.fieldErrors?.password` block), add:
  ```
  <PasswordStrengthChecklist password={passwordValue} />
  ```
  This places the checklist inside the same `<div className="space-y-2">` that wraps the password label, input, and error.

**update-password-form.tsx:**
- Add import: `import { PasswordStrengthChecklist } from '@/components/ui/password-strength'`
- Add import: `import { useState } from 'react'` (add `useState` to the existing `useActionState` import from `react`)
- Add state: `const [passwordValue, setPasswordValue] = useState('')`
- On the FIRST `<PasswordInput>` (id="password", the new password field), add:
  - `value={passwordValue}`
  - `onChange={(e) => setPasswordValue(e.target.value)}`
- Directly AFTER the password error `<p>` tag for the first password field, add:
  ```
  <PasswordStrengthChecklist password={passwordValue} />
  ```
- Do NOT add the checklist to the confirm password field (it only shows on the primary password field)
- Do NOT add controlled state to the confirm password field (it can remain uncontrolled)

**Important notes:**
- The `PasswordInput` component from Plan 36-01 uses `React.forwardRef` and passes all props through, so `value` and `onChange` work normally
- The `name="password"` attribute is still present, so `FormData` submission continues to work
- The checklist renders `null` when `passwordValue` is empty, so it won't show on page load
  </action>
  <verify>
Run `pnpm typecheck && pnpm lint` — no errors. Verify `PasswordStrengthChecklist` is imported in both files. Verify `passwordValue` state exists in both files. Verify `onChange` handler is wired to the password input in both files.
  </verify>
  <done>Signup and update-password forms show a live 4-item checklist beneath the password field. Checklist is hidden until user starts typing. Items flip from XCircle to CheckCircle as requirements are met.</done>
</task>

</tasks>

<verification>
- `pnpm typecheck` passes
- `pnpm lint` passes
- `grep -rn "PasswordStrengthChecklist" components/sign-up-form.tsx components/update-password-form.tsx` returns at least one hit per file
- `grep -rn "passwordValue" components/sign-up-form.tsx components/update-password-form.tsx` returns at least one hit per file
- `grep -rn "regex" lib/validations/auth.ts` returns at least 6 hits (3 per schema)
- `grep -rn "PasswordStrengthChecklist" components/login-form.tsx` returns zero hits (login should NOT have checklist)
</verification>

<success_criteria>
1. PasswordStrengthChecklist component exists with 4 requirements (length, uppercase, number, special char)
2. Checklist appears on signup and update-password forms beneath the password field
3. Checklist is hidden when password field is empty
4. Checklist items update in real-time as user types (controlled state wired)
5. Zod schemas for signup and update-password enforce all 4 strength rules server-side
6. Login form does NOT have the checklist
7. Typecheck and lint pass
</success_criteria>

<output>
After completion, create `.planning/phases/36-auth-form-enhancements/36-02-SUMMARY.md`
</output>
