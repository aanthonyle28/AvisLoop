---
phase: 38-onboarding-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/onboarding/onboarding-wizard.tsx
  - components/onboarding/onboarding-steps.tsx
  - app/onboarding/page.tsx
autonomous: true

must_haves:
  truths:
    - "Onboarding wizard renders exactly 5 steps (Business Basics, Services Offered, Campaign Preset, Import Jobs, SMS Consent)"
    - "Navigating to /onboarding?step=6 or ?step=7 clamps to step 5 instead of blank screen"
    - "Existing users with stale localStorage 'onboarding-draft' data start fresh under new key without errors"
    - "Progress bar at bottom shows X/5 (not X/7)"
  artifacts:
    - path: "components/onboarding/onboarding-wizard.tsx"
      provides: "5-step STEPS array, STORAGE_KEY='onboarding-draft-v2'"
      contains: "onboarding-draft-v2"
    - path: "components/onboarding/onboarding-steps.tsx"
      provides: "5-case switch statement mapping steps to components"
      contains: "case 5"
    - path: "app/onboarding/page.tsx"
      provides: "Step URL clamp at 5"
      contains: "Math.min(Math.max(1, stepParam), 5)"
  key_links:
    - from: "app/onboarding/page.tsx"
      to: "components/onboarding/onboarding-wizard.tsx"
      via: "initialStep prop clamped to 1-5"
      pattern: "Math\\.min.*5\\)"
    - from: "components/onboarding/onboarding-wizard.tsx"
      to: "components/onboarding/onboarding-steps.tsx"
      via: "currentStep prop drives switch"
      pattern: "currentStep={currentStep}"
---

<objective>
Reduce the onboarding wizard from 7 steps to 5 by removing the Review Destination step (duplicate of google_review_link already in Business Basics) and the Software Used step. Bump the localStorage draft key to `onboarding-draft-v2` so stale 7-step drafts are abandoned cleanly.

Purpose: Shorter wizard means faster onboarding — fewer steps to complete, less friction for new users. The removed steps either duplicate existing fields (Review Destination) or collect low-value data (Software Used).

Output: Updated wizard shell, step router, and onboarding page with 5-step flow.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/38-onboarding-consolidation/38-RESEARCH.md
@components/onboarding/onboarding-wizard.tsx
@components/onboarding/onboarding-steps.tsx
@app/onboarding/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update wizard STEPS array and localStorage key</name>
  <files>components/onboarding/onboarding-wizard.tsx</files>
  <action>
  In `onboarding-wizard.tsx`, make these changes:

  1. **Change STORAGE_KEY** from `'onboarding-draft'` to `'onboarding-draft-v2'`. This is the only change needed — old drafts under `'onboarding-draft'` are simply abandoned. The Zod `draftDataSchema` validation will not find data under the new key, so returning users mid-wizard start fresh. This is safe because Step 1 already saves business data to DB on Continue.

  2. **Replace the STEPS array** (lines 22-30) with:
  ```typescript
  const STEPS: StepConfig[] = [
    { id: 1, title: 'Business Basics', skippable: false },
    { id: 2, title: 'Services Offered', skippable: false },
    { id: 3, title: 'Campaign Preset', skippable: false },
    { id: 4, title: 'Import Jobs', skippable: true },
    { id: 5, title: 'SMS Consent', skippable: false },
  ]
  ```
  This removes Review Destination (old step 2) and Software Used (old step 4). The remaining steps are renumbered sequentially 1-5.

  3. **Update the JSDoc comment** for `campaignPresets` prop from "For step 5" to "For step 3" since Campaign Preset is now step 3.

  No other changes needed — the `goToStep` bounds check uses `STEPS.length` which auto-adjusts, `OnboardingProgress` receives `totalSteps={STEPS.length}` which auto-adjusts, and `handleComplete` clears the new STORAGE_KEY.
  </action>
  <verify>Run `pnpm typecheck` — should pass with no errors. Grep for `'onboarding-draft-v2'` in the file to confirm the key change. Grep for `STEPS.length` to confirm it still drives bounds and progress.</verify>
  <done>STEPS array has exactly 5 entries (Business Basics, Services Offered, Campaign Preset, Import Jobs, SMS Consent). STORAGE_KEY is 'onboarding-draft-v2'. No reference to 'Review Destination' or 'Software Used' in the array.</done>
</task>

<task type="auto">
  <name>Task 2: Rewire step switch statement and update page clamp</name>
  <files>components/onboarding/onboarding-steps.tsx, app/onboarding/page.tsx</files>
  <action>
  **In `onboarding-steps.tsx`:**

  1. Remove the imports for `ReviewDestinationStep` and `SoftwareUsedStep`. The files themselves stay on disk (no active breakage from unused files).

  2. Replace the entire switch statement with the new 5-step mapping:
  ```typescript
  switch (currentStep) {
    case 1:
      return (
        <BusinessBasicsStep
          onComplete={onGoToNext}
          defaultValues={{
            name: business?.name || '',
            phone: business?.phone || '',
            google_review_link: business?.google_review_link || '',
          }}
        />
      )
    case 2:
      return (
        <ServicesOfferedStep
          onComplete={onGoToNext}
          onGoBack={onGoBack}
          defaultEnabled={business?.service_types_enabled || []}
        />
      )
    case 3:
      return (
        <CampaignPresetStep
          onComplete={onGoToNext}
          onGoBack={onGoBack}
          presets={campaignPresets || []}
        />
      )
    case 4:
      return (
        <CustomerImportStep
          onComplete={onGoToNext}
          onGoBack={onGoBack}
        />
      )
    case 5:
      return (
        <SMSConsentStep
          onComplete={onComplete}
          onGoBack={onGoBack}
          isSubmitting={isSubmitting}
        />
      )
    default:
      return null
  }
  ```
  Note: Only step 5 (SMS Consent, the final step) uses `onComplete` — all others use `onGoToNext`.

  3. Update the JSDoc comment at the top from "Steps 1-4: Business basics, review link, services, software / Steps 5-7: Campaign preset, customer import, SMS consent" to "Steps 1-5: Business basics, services, campaign preset, import, SMS consent".

  **In `app/onboarding/page.tsx`:**

  1. Change the step clamp from `7` to `5`:
  ```typescript
  const currentStep = Math.min(Math.max(1, stepParam), 5)
  ```

  2. Update the JSDoc comment block to list the new 5 steps:
  ```
  * Step 1: Business Basics (required)
  * Step 2: Services Offered (required)
  * Step 3: Campaign Preset (required)
  * Step 4: Import Jobs (optional/skippable)
  * Step 5: SMS Consent (required)
  ```

  3. Change the "Renders wizard shell with 7-step flow" comment to "Renders wizard shell with 5-step flow".
  </action>
  <verify>Run `pnpm typecheck` to verify no type errors. Run `pnpm lint` to confirm no unused import warnings. Grep `onboarding-steps.tsx` for `ReviewDestinationStep` and `SoftwareUsedStep` — should find zero matches. Grep `page.tsx` for `, 5)` to confirm clamp value.</verify>
  <done>Switch statement has exactly 5 cases (1-5). No imports of ReviewDestinationStep or SoftwareUsedStep. URL clamp is `Math.min(Math.max(1, stepParam), 5)`. Steps map: 1=BusinessBasics, 2=ServicesOffered, 3=CampaignPreset, 4=CustomerImport, 5=SMSConsent.</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Grep `components/onboarding/onboarding-wizard.tsx` for `onboarding-draft-v2` — exists
4. Grep `components/onboarding/onboarding-steps.tsx` for `ReviewDestinationStep` — zero matches
5. Grep `app/onboarding/page.tsx` for `, 5)` — confirms clamp
6. Count STEPS array entries in wizard = exactly 5
</verification>

<success_criteria>
- Onboarding wizard STEPS array has exactly 5 entries
- localStorage key is 'onboarding-draft-v2' (not 'onboarding-draft')
- Step switch statement routes 5 cases correctly (no Review Destination, no Software Used)
- URL clamp prevents blank screen for step=6 or step=7 bookmarks
- Build passes (typecheck + lint)
</success_criteria>

<output>
After completion, create `.planning/phases/38-onboarding-consolidation/38-01-SUMMARY.md`
</output>
