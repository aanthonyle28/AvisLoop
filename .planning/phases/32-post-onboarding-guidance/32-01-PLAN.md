---
phase: 32-post-onboarding-guidance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/migrations/20260206_add_onboarding_checklist.sql
  - lib/types/database.ts
autonomous: true

must_haves:
  truths:
    - "businesses table has onboarding_checklist JSONB column"
    - "Column default initializes all checklist items to false"
    - "Business type includes onboarding_checklist field"
  artifacts:
    - path: "supabase/migrations/20260206_add_onboarding_checklist.sql"
      provides: "Database migration for checklist column"
      contains: "onboarding_checklist"
    - path: "lib/types/database.ts"
      provides: "OnboardingChecklist type definition"
      contains: "OnboardingChecklist"
  key_links:
    - from: "lib/types/database.ts"
      to: "supabase/migrations/20260206_add_onboarding_checklist.sql"
      via: "Type matches column structure"
      pattern: "first_job_added.*campaign_setup.*job_completed.*first_review"
---

<objective>
Add database schema for tracking onboarding checklist progress. Create migration to add JSONB column to businesses table and update TypeScript types.

Purpose: Foundation for Getting Started checklist. Progress must persist in database to survive logout and work across devices.
Output: Database migration file and updated TypeScript types.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-post-onboarding-guidance/32-RESEARCH.md
@lib/types/database.ts
@supabase/migrations/20260206_add_job_scheduled_status.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create database migration for onboarding_checklist column</name>
  <files>
    supabase/migrations/20260206_add_onboarding_checklist.sql
  </files>
  <action>
Create migration file `supabase/migrations/20260206_add_onboarding_checklist.sql`:

```sql
-- Add onboarding checklist tracking to businesses table
-- Tracks milestone completion for Getting Started card on dashboard

ALTER TABLE businesses
ADD COLUMN IF NOT EXISTS onboarding_checklist JSONB NOT NULL DEFAULT '{
  "first_job_added": false,
  "campaign_setup": false,
  "job_completed": false,
  "first_review": false,
  "dismissed": false,
  "dismissed_at": null
}'::jsonb;

-- Add comment for documentation
COMMENT ON COLUMN businesses.onboarding_checklist IS 'Tracks Getting Started checklist progress. Items auto-complete based on actual data. dismissed=true hides checklist.';

-- Index for querying businesses with incomplete checklists (for analytics)
CREATE INDEX IF NOT EXISTS idx_businesses_checklist_incomplete
ON businesses ((onboarding_checklist->>'dismissed'))
WHERE onboarding_checklist->>'dismissed' = 'false';
```

Key points:
- JSONB column with structured default
- NOT NULL ensures all businesses have checklist
- `dismissed` flag allows users to hide checklist
- `dismissed_at` timestamp for analytics
- Partial index for finding active checklists
  </action>
  <verify>
    Migration file exists and contains valid SQL syntax. Run `pnpm typecheck` to ensure no TypeScript errors introduced.
  </verify>
  <done>
    Database migration created that adds onboarding_checklist JSONB column with proper defaults and indexing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add OnboardingChecklist TypeScript types</name>
  <files>
    lib/types/database.ts
  </files>
  <action>
Add OnboardingChecklist type definition to `lib/types/database.ts`.

1. Find the Business type definition in the file.

2. Add the OnboardingChecklist interface near the top of the file (with other interfaces):

```typescript
/**
 * Onboarding checklist state stored in businesses.onboarding_checklist
 * V2-aligned: tracks jobs and campaigns, NOT customers or manual sends
 */
export interface OnboardingChecklist {
  /** User has added at least one job */
  first_job_added: boolean
  /** User has at least one active campaign */
  campaign_setup: boolean
  /** User has completed (not just added) at least one job */
  job_completed: boolean
  /** Business has received at least one review */
  first_review: boolean
  /** User has dismissed the Getting Started checklist */
  dismissed: boolean
  /** Timestamp when checklist was dismissed */
  dismissed_at: string | null
}
```

3. Update the Business type to include the new field. Find:
```typescript
export interface Business {
```

Add to the interface:
```typescript
  onboarding_checklist: OnboardingChecklist | null
```

Note: Use `| null` because existing rows may have NULL until migration runs.

Important:
- Do NOT modify existing fields in Business type
- Add OnboardingChecklist interface BEFORE Business type (for reference)
- Type matches the JSONB structure in migration exactly
  </action>
  <verify>
    `pnpm typecheck` passes with no errors
  </verify>
  <done>
    OnboardingChecklist type added and Business type updated to include onboarding_checklist field
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - No type errors
2. `pnpm lint` - No lint errors
3. Migration file exists at correct path
4. Migration SQL is syntactically correct (no obvious errors)
5. OnboardingChecklist interface exported from lib/types/database.ts
6. Business type includes onboarding_checklist field
</verification>

<success_criteria>
1. Migration file created with onboarding_checklist JSONB column
2. Column has sensible defaults (all false, dismissed=false)
3. Partial index created for incomplete checklists
4. OnboardingChecklist TypeScript interface matches JSONB structure
5. Business type updated to include new field
6. Build and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/32-post-onboarding-guidance/32-01-SUMMARY.md`
</output>
