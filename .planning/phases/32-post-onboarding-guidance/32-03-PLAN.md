---
phase: 32-post-onboarding-guidance
plan: 03
type: execute
wave: 3
depends_on: ["32-02"]
files_modified:
  - lib/hooks/use-first-visit-hint.ts
  - components/onboarding/first-visit-hint.tsx
  - components/jobs/jobs-client.tsx
  - app/(dashboard)/dashboard/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard shows Getting Started checklist for new users"
    - "Checklist hidden if user has dismissed it or all items complete"
    - "Jobs page shows tooltip hint on first visit pointing at Add Job button"
    - "Tooltip hints tracked in localStorage (show once per page)"
    - "Hints are dismissible and non-blocking"
  artifacts:
    - path: "lib/hooks/use-first-visit-hint.ts"
      provides: "Hook for tracking first-visit hints in localStorage"
      exports: ["useFirstVisitHint"]
    - path: "components/onboarding/first-visit-hint.tsx"
      provides: "Tooltip hint component for first-visit guidance"
      exports: ["FirstVisitHint"]
  key_links:
    - from: "app/(dashboard)/dashboard/page.tsx"
      to: "components/onboarding/getting-started-checklist.tsx"
      via: "Component import"
      pattern: "GettingStartedChecklist"
    - from: "components/jobs/jobs-client.tsx"
      to: "components/onboarding/first-visit-hint.tsx"
      via: "Hint integration"
      pattern: "FirstVisitHint"
    - from: "components/onboarding/first-visit-hint.tsx"
      to: "lib/hooks/use-first-visit-hint.ts"
      via: "Hook usage"
      pattern: "useFirstVisitHint"
---

<objective>
Integrate the Getting Started Checklist into the dashboard and add contextual tooltip hints to the Jobs page. Create the first-visit hint hook and component for reusable hint functionality.

Purpose: Complete the post-onboarding guidance feature by wiring up the checklist and adding contextual hints.
Output: Dashboard with checklist card, Jobs page with first-visit tooltip hint.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-post-onboarding-guidance/32-RESEARCH.md
@app/(dashboard)/dashboard/page.tsx
@components/jobs/jobs-client.tsx
@lib/hooks/use-local-storage.ts
@components/ui/tooltip.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create first-visit hint hook</name>
  <files>
    lib/hooks/use-first-visit-hint.ts
  </files>
  <action>
Create `lib/hooks/use-first-visit-hint.ts`:

```typescript
"use client"

import { useCallback } from 'react'
import { useLocalStorage } from './use-local-storage'

/**
 * Hook for tracking first-visit hints
 *
 * Stores seen state in localStorage so hints only show once per page.
 * Per-device is acceptable for hints (vs database for checklist).
 *
 * @param hintId - Unique identifier for the hint (e.g., 'jobs-add-button')
 * @returns { showHint, dismissHint, resetHint }
 */
export function useFirstVisitHint(hintId: string) {
  const storageKey = `hint-${hintId}-seen`
  const [hasSeen, setHasSeen] = useLocalStorage(storageKey, false)

  const dismissHint = useCallback(() => {
    setHasSeen(true)
  }, [setHasSeen])

  const resetHint = useCallback(() => {
    setHasSeen(false)
  }, [setHasSeen])

  return {
    /** Whether to show the hint (false if user has seen it) */
    showHint: !hasSeen,
    /** Call to mark hint as seen and hide it */
    dismissHint,
    /** Call to reset hint (for testing/debugging) */
    resetHint,
  }
}
```

Key features:
- Uses existing useLocalStorage hook
- Simple boolean tracking (seen/not seen)
- Exposes showHint, dismissHint, resetHint
- Per-device storage is acceptable for hints
  </action>
  <verify>
    `pnpm typecheck` passes with no errors
  </verify>
  <done>
    useFirstVisitHint hook created with localStorage persistence
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FirstVisitHint component</name>
  <files>
    components/onboarding/first-visit-hint.tsx
  </files>
  <action>
Create `components/onboarding/first-visit-hint.tsx`:

```tsx
"use client"

import { useEffect, useState, type ReactNode } from 'react'
import { X } from '@phosphor-icons/react'
import { Button } from '@/components/ui/button'
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from '@/components/ui/tooltip'
import { useFirstVisitHint } from '@/lib/hooks/use-first-visit-hint'

interface FirstVisitHintProps {
  /** Unique identifier for this hint */
  hintId: string
  /** The element to attach the hint to */
  children: ReactNode
  /** Hint title */
  title: string
  /** Hint description */
  description: string
  /** Tooltip side positioning */
  side?: 'top' | 'right' | 'bottom' | 'left'
  /** Delay before showing hint (ms) */
  showDelay?: number
}

/**
 * First Visit Hint - Shows a tooltip hint on first visit
 *
 * Wraps a target element and shows a tooltip on first visit.
 * After user dismisses, hint won't show again (tracked in localStorage).
 *
 * Usage:
 * ```tsx
 * <FirstVisitHint
 *   hintId="jobs-add-button"
 *   title="Add your first job here"
 *   description="Log completed jobs to start collecting reviews automatically."
 *   side="bottom"
 * >
 *   <Button>Add Job</Button>
 * </FirstVisitHint>
 * ```
 */
export function FirstVisitHint({
  hintId,
  children,
  title,
  description,
  side = 'bottom',
  showDelay = 500,
}: FirstVisitHintProps) {
  const { showHint, dismissHint } = useFirstVisitHint(hintId)
  const [isVisible, setIsVisible] = useState(false)

  // Delay showing hint to let page fully render
  useEffect(() => {
    if (!showHint) return

    const timer = setTimeout(() => {
      setIsVisible(true)
    }, showDelay)

    return () => clearTimeout(timer)
  }, [showHint, showDelay])

  // If hint has been seen, just render children without tooltip
  if (!showHint) {
    return <>{children}</>
  }

  return (
    <TooltipProvider>
      <Tooltip open={isVisible} delayDuration={0}>
        <TooltipTrigger asChild>
          {children}
        </TooltipTrigger>
        <TooltipContent
          side={side}
          className="max-w-xs p-4"
          sideOffset={8}
        >
          <div className="flex items-start gap-2">
            <div className="flex-1">
              <p className="font-medium text-sm">{title}</p>
              <p className="text-xs text-muted-foreground mt-1">
                {description}
              </p>
            </div>
            <Button
              variant="ghost"
              size="icon"
              className="h-6 w-6 shrink-0 -mt-1 -mr-2"
              onClick={(e) => {
                e.preventDefault()
                e.stopPropagation()
                dismissHint()
                setIsVisible(false)
              }}
            >
              <X size={14} />
              <span className="sr-only">Dismiss hint</span>
            </Button>
          </div>
          <Button
            variant="secondary"
            size="sm"
            className="w-full mt-3"
            onClick={(e) => {
              e.preventDefault()
              e.stopPropagation()
              dismissHint()
              setIsVisible(false)
            }}
          >
            Got it
          </Button>
        </TooltipContent>
      </Tooltip>
    </TooltipProvider>
  )
}
```

Key features:
- Wraps target element with Radix Tooltip
- Shows hint only on first visit (localStorage tracking)
- Dismiss via X button or "Got it" button
- Delay before showing (default 500ms)
- Non-blocking (tooltip doesn't prevent interaction)
- Accessible (sr-only labels)
  </action>
  <verify>
    `pnpm typecheck` passes, `pnpm lint` passes
  </verify>
  <done>
    FirstVisitHint component created with tooltip positioning and dismiss functionality
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate checklist into dashboard</name>
  <files>
    app/(dashboard)/dashboard/page.tsx
  </files>
  <action>
Update `app/(dashboard)/dashboard/page.tsx` to include the Getting Started Checklist:

1. Add imports at top:
```typescript
import { getChecklistState } from '@/lib/data/checklist'
import { GettingStartedChecklist } from '@/components/onboarding/getting-started-checklist'
```

2. In the DashboardPage function, add checklist state fetch to the parallel Promise.all.

Find:
```typescript
const [kpiData, readyJobs, alerts, jobCounts] = await Promise.all([
```

Update to:
```typescript
const [kpiData, readyJobs, alerts, jobCounts, checklistState] = await Promise.all([
  getDashboardKPIs(business.id),
  getReadyToSendJobs(business.id, serviceTypeTiming),
  getAttentionAlerts(business.id),
  getJobCounts(),
  getChecklistState(business.id),
])
```

3. In the return JSX, add the checklist card at the top (after h1, before KPIWidgets).

Find:
```tsx
return (
  <div className="container mx-auto py-6 px-4 space-y-6">
    <h1 className="text-2xl font-bold">Dashboard</h1>
    <KPIWidgets data={kpiData} />
```

Update to:
```tsx
return (
  <div className="container mx-auto py-6 px-4 space-y-6">
    <h1 className="text-2xl font-bold">Dashboard</h1>

    {/* Getting Started Checklist - show for new users */}
    {!checklistState.dismissed && (
      <GettingStartedChecklist
        items={checklistState.items}
        completedCount={checklistState.completedCount}
        allComplete={checklistState.allComplete}
      />
    )}

    <KPIWidgets data={kpiData} />
```

Key points:
- Checklist added to parallel fetch for performance
- Only renders if not dismissed
- Positioned prominently at top of dashboard
- Props passed from server-computed state
  </action>
  <verify>
    `pnpm typecheck` passes, `pnpm lint` passes, `pnpm build` succeeds
  </verify>
  <done>
    Getting Started Checklist integrated into dashboard, conditionally rendered based on dismissed state
  </done>
</task>

<task type="auto">
  <name>Task 4: Add first-visit hint to Jobs page</name>
  <files>
    components/jobs/jobs-client.tsx
  </files>
  <action>
Update `components/jobs/jobs-client.tsx` to wrap the Add Job button with FirstVisitHint:

1. Add import at top:
```typescript
import { FirstVisitHint } from '@/components/onboarding/first-visit-hint'
```

2. Find the Add Job button in the header section (around line 62-65):
```tsx
<Button onClick={() => setShowAddSheet(true)}>
  <Plus className="mr-2 h-4 w-4" weight="bold" />
  Add Job
</Button>
```

3. Wrap it with FirstVisitHint:
```tsx
<FirstVisitHint
  hintId="jobs-add-button"
  title="Add your first job here"
  description="Log completed jobs to start collecting reviews automatically. This is the main action in AvisLoop."
  side="bottom"
>
  <Button onClick={() => setShowAddSheet(true)}>
    <Plus className="mr-2 h-4 w-4" weight="bold" />
    Add Job
  </Button>
</FirstVisitHint>
```

Key points:
- Hint only shows on first visit to Jobs page
- Title reinforces V2 workflow (jobs are primary)
- Description explains automation benefit
- Side="bottom" positions tooltip below button
- Non-blocking: user can still click button while tooltip is visible
  </action>
  <verify>
    `pnpm typecheck` passes, `pnpm lint` passes
  </verify>
  <done>
    FirstVisitHint added to Jobs page Add Job button with V2-aligned messaging
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` - No type errors
2. `pnpm lint` - No lint errors
3. `pnpm build` - Build succeeds
4. Dashboard page imports and renders GettingStartedChecklist
5. Checklist hidden when dismissed=true
6. Jobs page imports and renders FirstVisitHint around Add Job button
7. Hint shows on first visit, not on subsequent visits
8. V2-aligned messaging in hint and checklist
</verification>

<success_criteria>
1. Dashboard shows Getting Started checklist for new users
2. Checklist hidden if dismissed=true in database
3. Checklist fetched in parallel with other dashboard data
4. Jobs page shows tooltip hint on first visit
5. Hint dismissible via X or "Got it" button
6. Hint tracked in localStorage (shows once)
7. All messaging reinforces V2 workflow (jobs primary, automation)
8. Build and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/32-post-onboarding-guidance/32-03-SUMMARY.md`
</output>
