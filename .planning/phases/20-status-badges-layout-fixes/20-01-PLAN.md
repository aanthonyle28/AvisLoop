---
phase: 20-status-badges-layout-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/history/status-badge.tsx
  - components/scheduled/scheduled-table.tsx
  - components/history/history-columns.tsx
  - components/history/request-detail-drawer.tsx
autonomous: true

must_haves:
  truths:
    - "Every status badge across the app (history page, send page, contacts page, drawers, recent activity strip, scheduled table) renders with identical Figma-spec colors, icons, and typography"
    - "Pending badge shows #F3F4F6 bg, #101828 text, CircleNotch spinner icon"
    - "Delivered badge shows #EAF3F6 bg, #2C879F text, CheckCircle icon"
    - "Clicked badge shows #FEF9C2 bg, #894B00 text, Cursor icon"
    - "Failed badge shows #FFE2E2 bg, #C10007 text, WarningCircle icon"
    - "Reviewed badge shows #DCFCE7 bg, #008236 text, Star icon"
    - "Scheduled badge shows rgba(#9F2C86,0.1) bg, #9F2C86 text, CheckCircle icon"
  artifacts:
    - path: "components/history/status-badge.tsx"
      provides: "Unified StatusBadge component with Figma-spec colors and Phosphor icons"
      exports: ["StatusBadge", "SendStatus"]
    - path: "components/scheduled/scheduled-table.tsx"
      provides: "Scheduled table using StatusBadge instead of inline getStatusBadge"
  key_links:
    - from: "components/scheduled/scheduled-table.tsx"
      to: "components/history/status-badge.tsx"
      via: "import { StatusBadge } from '@/components/history/status-badge'"
      pattern: "import.*StatusBadge.*status-badge"
    - from: "components/history/history-columns.tsx"
      to: "components/history/status-badge.tsx"
      via: "import { StatusBadge }"
      pattern: "StatusBadge"
---

<objective>
Rebuild the StatusBadge component to match the Figma spec exactly (6 status variants with specific hex colors and Phosphor icons), then migrate the scheduled-table's inline getStatusBadge function to use the unified component.

Purpose: BDGE-01 requires every status indicator across the app to use one consistent badge. The current StatusBadge uses generic Tailwind colors and has no icons. The scheduled-table has its own inline badge function that diverges from StatusBadge entirely.

Output: A single StatusBadge component that renders all 6 Figma-spec variants with correct colors and icons, used by all consumers.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-status-badges-layout-fixes/20-RESEARCH.md

@components/history/status-badge.tsx
@components/scheduled/scheduled-table.tsx
@components/history/history-columns.tsx
@components/history/request-detail-drawer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rebuild StatusBadge with Figma-spec colors and icons</name>
  <files>components/history/status-badge.tsx</files>
  <action>
Replace the entire StatusBadge component implementation:

1. Update the SendStatus type union to include all needed statuses. Keep backwards compatibility by mapping legacy statuses:
   - Primary: 'pending' | 'delivered' | 'clicked' | 'failed' | 'reviewed' | 'scheduled'
   - Legacy (mapped): 'sent' -> delivered, 'bounced' -> failed, 'complained' -> failed, 'opened' -> delivered, 'completed' -> delivered

2. Add Phosphor icon imports:
   ```
   import { CircleNotch, CheckCircle, Cursor, WarningCircle, Star } from '@phosphor-icons/react'
   ```

3. Replace statusConfig with exact Figma hex values and icon references:
   - pending: { label: 'Pending', bg: '#F3F4F6', text: '#101828', Icon: CircleNotch }
   - delivered: { label: 'Delivered', bg: '#EAF3F6', text: '#2C879F', Icon: CheckCircle }
   - clicked: { label: 'Clicked', bg: '#FEF9C2', text: '#894B00', Icon: Cursor }
   - failed: { label: 'Failed', bg: '#FFE2E2', text: '#C10007', Icon: WarningCircle }
   - reviewed: { label: 'Reviewed', bg: '#DCFCE7', text: '#008236', Icon: Star }
   - scheduled: { label: 'Scheduled', bg: 'rgba(159, 44, 134, 0.1)', text: '#9F2C86', Icon: CheckCircle }

4. Add a normalizeStatus helper function that maps legacy status strings to the primary set (e.g., 'sent' -> 'delivered', 'bounced' -> 'failed', 'completed' -> 'delivered'). Unknown statuses fall back to 'pending'.

5. Render the Badge using inline `style` for bg/text colors (not Tailwind classes, since these are absolute Figma hex values). Keep the Badge component from @/components/ui/badge. Add the icon before the label text with `className="h-3.5 w-3.5"` and `weight="bold"` on the icon. For CircleNotch (pending), add `className="h-3.5 w-3.5 animate-spin"` to show spinner animation.

6. Badge className: `inline-flex items-center gap-1.5 px-2.5 py-0.5 text-xs font-semibold border-0 rounded-full`

7. Keep the existing className prop passthrough via cn() utility.

8. Keep the 'use client' directive since Phosphor icons are client components.
  </action>
  <verify>
Run `pnpm typecheck` -- no errors related to StatusBadge or SendStatus types. Verify the file exports both `StatusBadge` and `SendStatus`. Check that all 6 primary statuses plus legacy mappings are handled.
  </verify>
  <done>
StatusBadge component renders all 6 Figma-spec badge variants with correct hex colors and Phosphor icons. Legacy status strings (sent, bounced, complained, opened, completed) map to appropriate primary statuses without TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate scheduled-table to use unified StatusBadge</name>
  <files>components/scheduled/scheduled-table.tsx</files>
  <action>
1. Add import for StatusBadge:
   ```
   import { StatusBadge } from '@/components/history/status-badge'
   ```

2. Remove the inline `getStatusBadge` function (around lines 157-187) entirely.

3. Remove the now-unused Badge import from '@/components/ui/badge' (only if Badge is not used elsewhere in the file -- check first).

4. Remove unused icon imports that were only used by getStatusBadge (CheckCircle, XCircle, Warning) -- but keep Clock, CaretRight, CaretDown, Users since those are used in the table layout.

5. Replace all 5 calls to `{getStatusBadge(send.status)}` with:
   ```tsx
   <StatusBadge status={send.status as string} />
   ```
   Note: The scheduled send status type is 'pending' | 'completed' | 'failed' | 'cancelled'. The StatusBadge normalizeStatus function handles 'completed' -> 'delivered' mapping. 'cancelled' will fall back to 'pending' which is acceptable since cancelled sends appear in the past tab.

6. The Badge import may still be needed if used elsewhere in the file. Check before removing.
  </action>
  <verify>
Run `pnpm typecheck` -- no errors in scheduled-table.tsx. Grep for `getStatusBadge` in the file -- should return no results. Grep for `StatusBadge` import -- should exist.
  </verify>
  <done>
scheduled-table.tsx uses the unified StatusBadge component instead of its custom inline getStatusBadge function. No duplicate badge implementations remain.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with no errors
2. `pnpm lint` passes with no errors
3. Grep for `getStatusBadge` across the codebase returns no results
4. Grep for `StatusBadge` confirms it's imported in: history-columns.tsx, request-detail-drawer.tsx, recent-activity-strip.tsx, scheduled-table.tsx
5. StatusBadge component exports both `StatusBadge` and `SendStatus`
</verification>

<success_criteria>
- StatusBadge renders 6 Figma-spec variants with exact hex colors and Phosphor icons
- All consumers use the same StatusBadge component (no inline badge implementations remain)
- Legacy status strings map gracefully to primary statuses
- TypeScript compilation passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/20-status-badges-layout-fixes/20-01-SUMMARY.md`
</output>
