---
phase: 20-status-badges-layout-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/dashboard/settings/page.tsx
  - components/send/recent-activity-strip.tsx
autonomous: true

must_haves:
  truths:
    - "Scrolling the settings page keeps the page header (title + description) visible and fixed at the top"
    - "Recent activity chips fill all available horizontal space before the View All button"
    - "When space runs out, the last visible chip truncates gracefully with ellipsis rather than overflowing or disappearing"
  artifacts:
    - path: "app/dashboard/settings/page.tsx"
      provides: "Settings page with sticky header"
      contains: "sticky top-0"
    - path: "components/send/recent-activity-strip.tsx"
      provides: "Recent activity strip with proper horizontal fill and truncation"
      contains: "truncate"
  key_links:
    - from: "app/dashboard/settings/page.tsx"
      to: "components/layout/app-shell.tsx"
      via: "Settings page renders inside <main className='flex-1 overflow-auto'> which is the scroll container"
      pattern: "overflow-auto"
---

<objective>
Fix two layout issues: (1) make the settings page header sticky so it stays visible when scrolling through long form sections, and (2) update the recent activity strip so chips fill all available horizontal space and the last chip truncates gracefully.

Purpose: LAYO-01 and LAYO-02 address visual polish issues where the settings page loses context on scroll and activity chips don't use space optimally.

Output: Sticky settings header and improved activity strip layout.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-status-badges-layout-fixes/20-RESEARCH.md

@app/dashboard/settings/page.tsx
@components/send/recent-activity-strip.tsx
@components/layout/app-shell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make settings page header sticky on scroll</name>
  <files>app/dashboard/settings/page.tsx</files>
  <action>
In the SettingsContent component, restructure the layout to make the page header sticky:

1. Change the outer wrapper from:
   ```tsx
   <div className="max-w-4xl mx-auto p-6 space-y-8">
   ```
   to remove the padding from the outer div (padding will be applied separately to header and content):
   ```tsx
   <div className="max-w-4xl mx-auto">
   ```

2. Wrap the existing header `<div>` (containing h1 + p) in a sticky container:
   ```tsx
   <div className="sticky top-0 z-10 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 border-b border-border px-6 py-4">
     <h1 className="text-3xl font-bold">Settings</h1>
     <p className="text-muted-foreground mt-1">
       Configure your business profile and email templates
     </p>
   </div>
   ```

   Key details:
   - `sticky top-0` positions it at the top of the scroll container (the `<main>` in app-shell.tsx)
   - `z-10` ensures it stays above scrolling content
   - `bg-background/95 backdrop-blur` creates a frosted glass effect matching modern UI patterns
   - `border-b border-border` adds a subtle separator when content scrolls behind
   - Changed `mt-2` to `mt-1` on `<p>` for slightly tighter sticky header

3. Wrap the remaining content sections in a separate div with padding:
   ```tsx
   <div className="p-6 space-y-8">
     {/* Section 1: Business Profile */}
     ...
     {/* Section 2: Email Templates */}
     ...
     {/* Section 3: Integrations */}
     ...
     {/* Section 4: Danger Zone */}
     ...
   </div>
   ```

4. Also update the SettingsLoadingSkeleton to match the same structural layout (sticky header area + content area), keeping the animate-pulse skeleton.

5. Do NOT change the Suspense wrapper or any of the section content -- only the header positioning and outer layout structure.
  </action>
  <verify>
Run `pnpm typecheck` -- no errors. Grep for `sticky top-0` in the settings page file -- should find one match. Verify the page still renders properly by checking that all 4 sections (Business Profile, Email Templates, Integrations, Danger Zone) are still present in the JSX.
  </verify>
  <done>
Settings page header stays fixed at the top when scrolling. The frosted glass effect provides visual separation. All content sections scroll beneath the header normally.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix recent activity strip horizontal fill and truncation</name>
  <files>components/send/recent-activity-strip.tsx</files>
  <action>
Update the recent activity strip layout so chips fill available horizontal space and the last chip truncates gracefully:

1. The outer flex container (`<div className="flex items-center gap-2">`) is already correct. Keep it.

2. The chips container (`<div className="flex items-center gap-1 overflow-hidden flex-1 min-w-0">`) already has the right foundation. Keep `flex-1 min-w-0 overflow-hidden`.

3. For each chip's inner `<div>` wrapper (the one with `className="flex items-center gap-1 min-w-0"`), add `shrink-0` to prevent chips from shrinking prematurely -- EXCEPT for the last visible chip which should be allowed to shrink and truncate:
   ```tsx
   <div
     key={item.id}
     className={cn(
       "flex items-center gap-1 min-w-0",
       index < displayItems.length - 1 ? "shrink-0" : ""
     )}
   >
   ```

4. Add import for `cn` utility if not already imported:
   ```tsx
   import { cn } from '@/lib/utils'
   ```

5. On the last chip's button, ensure the `truncate` behavior works on the label span. The current code already has `truncate` on the label span, which is correct. The key fix is step 3 above -- making non-last chips shrink-0 so only the last one absorbs overflow.

6. On each chip button, add `max-w-full` to ensure it doesn't exceed parent bounds:
   ```tsx
   <button
     onClick={() => onItemClick?.(item.id)}
     className="flex items-center gap-2 hover:bg-muted/50 rounded px-1.5 py-0.5 transition-colors min-w-0 max-w-full"
   >
   ```

This ensures:
- First N-1 chips display at their natural width (shrink-0)
- The last chip fills remaining space and truncates its label with ellipsis
- The "View All" link stays anchored at the right (already shrink-0)
  </action>
  <verify>
Run `pnpm typecheck` -- no errors. Check that `cn` is imported. Verify the component still renders both the empty state and populated state correctly by checking both return branches exist.
  </verify>
  <done>
Recent activity chips fill available horizontal space. Non-last chips maintain full width. The last chip truncates its label text with ellipsis when space runs out. The View All button stays fixed at the right edge.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes with no errors
2. `pnpm lint` passes with no errors
3. Settings page has `sticky top-0` on the header container
4. Recent activity strip has `shrink-0` on non-last chips and truncation on last chip
5. No functional changes to data fetching, form submission, or navigation
</verification>

<success_criteria>
- Scrolling settings page keeps header visible with frosted glass effect
- Recent activity chips fill horizontal space optimally
- Last activity chip truncates gracefully when space is limited
- Both changes are pure CSS/layout with no logic changes
</success_criteria>

<output>
After completion, create `.planning/phases/20-status-badges-layout-fixes/20-02-SUMMARY.md`
</output>
