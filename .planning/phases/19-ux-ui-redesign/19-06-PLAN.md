---
phase: 19-ux-ui-redesign
plan: 06
type: execute
wave: 3
depends_on: ["19-03"]
files_modified:
  - components/send/bulk-send-tab.tsx
  - components/send/bulk-send-columns.tsx
  - components/send/bulk-send-action-bar.tsx
  - components/send/bulk-send-confirm-dialog.tsx
  - app/(dashboard)/send/page.tsx
autonomous: true

must_haves:
  truths:
    - "Bulk Send tab shows contacts table with checkboxes"
    - "Filter chips above table: Never sent, Added today, Sent > 30 days, Issues"
    - "Sticky bottom action bar slides up when contacts selected"
    - "Action bar shows X selected + Send request + Clear + More"
    - "Send to selected (X) and Send to all filtered (Y) both work"
    - "Confirmation dialog shows total, eligible, skipped, template/schedule"
    - "Template + schedule inline via shared SendSettingsBar"
  artifacts:
    - path: "components/send/bulk-send-tab.tsx"
      provides: "Bulk Send tab with contact table and filters"
      exports: ["BulkSendTab"]
    - path: "components/send/bulk-send-action-bar.tsx"
      provides: "Gmail-style sticky bottom bar"
      exports: ["BulkSendActionBar"]
    - path: "components/send/bulk-send-confirm-dialog.tsx"
      provides: "Pre-send confirmation dialog"
      exports: ["BulkSendConfirmDialog"]
    - path: "components/send/bulk-send-columns.tsx"
      provides: "Simplified table columns for send context"
      exports: ["createBulkSendColumns"]
  key_links:
    - from: "components/send/bulk-send-tab.tsx"
      to: "components/send/send-settings-bar.tsx"
      via: "Shared template + schedule settings"
      pattern: "SendSettingsBar"
    - from: "components/send/bulk-send-action-bar.tsx"
      to: "components/send/bulk-send-confirm-dialog.tsx"
      via: "Send button opens confirmation"
      pattern: "BulkSendConfirmDialog"
    - from: "components/send/bulk-send-confirm-dialog.tsx"
      to: "lib/actions/send"
      via: "batchSendReviewRequest server action"
      pattern: "batchSendReviewRequest"
---

<objective>
Build the Bulk Send tab with contact table, filter chips, sticky action bar, and confirmation dialog.

Purpose: Bulk Send lets business owners send review requests to multiple contacts at once. This is the power-user tab: filter contacts, select subset or all, confirm and send. It reuses the existing TanStack Table patterns from the contacts page.

Output: BulkSendTab, BulkSendColumns, BulkSendActionBar, BulkSendConfirmDialog, integrated into Send page Bulk Send tab.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/19-ux-ui-redesign/19-CONTEXT.md
@.planning/phases/19-ux-ui-redesign/19-RESEARCH.md
@.planning/phases/19-ux-ui-redesign/19-03-SUMMARY.md
@components/contacts/contact-table.tsx
@components/contacts/contact-columns.tsx
@components/send/send-settings-bar.tsx
@lib/actions/send.ts
@lib/actions/schedule.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Bulk Send Table with Filter Chips and Columns</name>
  <files>
    components/send/bulk-send-tab.tsx
    components/send/bulk-send-columns.tsx
  </files>
  <action>
**BulkSendColumns (components/send/bulk-send-columns.tsx):**
- Simplified column definitions for send context (not full contact management)
- Columns: Checkbox (selection), Name, Email, Last Sent, Status indicator
- Last Sent: show relative time ("3 days ago", "Never") using date-fns formatDistanceToNow
- Status indicator: small icon/badge showing send eligibility
  - Green dot: ready to send
  - Yellow dot: on cooldown (with "Available in X days" tooltip)
  - Red dot: opted out (disabled row)
- Use ColumnDef<Contact> from TanStack Table

**BulkSendTab (components/send/bulk-send-tab.tsx):**
- `'use client'` component
- Props: `contacts: Contact[]`, `templates: EmailTemplate[]`, `monthlyUsage`, `hasReviewLink: boolean`, `resendReadyContactIds: string[]`
- Layout:
  1. **SendSettingsBar** at top (shared component from Plan 03)
  2. **Filter chips row:** Horizontal row of toggleable chips
     - "Never sent" — filters contacts where `last_sent_at` is null
     - "Added today" — filters contacts where `created_at >= start of today`
     - "Sent > 30 days" — filters contacts where `last_sent_at < 30 days ago`
     - "Issues" — filters contacts where `opted_out === true` or status indicates problem
     - Multiple chips can be active (OR logic between them)
     - Each chip shows count: "Never sent (12)"
     - Chip styling: `rounded-full border px-3 py-1.5 text-xs` with active/inactive states
  3. **Contact table** using TanStack Table:
     - Use `useReactTable` with: getCoreRowModel, getSortedRowModel, getFilteredRowModel
     - Row selection enabled (checkbox column)
     - Apply filter chips as column filters
     - Pagination if > 50 contacts
     - Opted-out contacts: row is grayed out, checkbox disabled
     - Cooldown contacts: selectable but will show as "skipped" in confirmation
  4. **BulkSendActionBar** (rendered when selection > 0)
- State management:
  - `rowSelection` state for TanStack Table
  - `activeFilters` Set for filter chips
  - Filter logic: compute filtered contacts from contacts array + active filters
  - Track `filteredCount` for "Send to all filtered" feature
  </action>
  <verify>
- `pnpm typecheck` passes
- `pnpm lint` passes
- Navigate to /send, switch to Bulk Send tab
- Filter chips toggle correctly and filter the table
- Row selection works (checkboxes)
- Opted-out contacts are grayed out
  </verify>
  <done>Bulk Send tab shows contact table with filter chips, row selection, and send-context columns. Filters work correctly. Table follows existing TanStack Table patterns.</done>
</task>

<task type="auto">
  <name>Task 2: Create Sticky Action Bar and Confirmation Dialog</name>
  <files>
    components/send/bulk-send-action-bar.tsx
    components/send/bulk-send-confirm-dialog.tsx
    app/(dashboard)/send/page.tsx
  </files>
  <action>
**BulkSendActionBar (components/send/bulk-send-action-bar.tsx):**
- `'use client'` component
- Gmail-style sticky bottom bar that slides up when contacts are selected
- Props: `selectedCount: number`, `filteredCount: number`, `onSendSelected`, `onSendAllFiltered`, `onClearSelection`, `isPending: boolean`, `hasReviewLink: boolean`
- Layout: `fixed bottom-0 left-0 right-0` (or `sticky bottom-0` within content area)
  - On mobile: positioned above bottom nav (add appropriate bottom offset)
  - On desktop: positioned at bottom of main content area
- Content: Horizontal bar with:
  - Left: "X selected" text
  - Center/Right:
    - "Send request" primary button (sends to selected X)
    - "Send to all filtered (Y)" secondary option (only if filteredCount > selectedCount)
    - "Clear" text button
  - If `hasReviewLink` false: send buttons disabled with tooltip
- Animation: slide up from bottom with `transition-transform duration-200`
- Show/hide: render only when `selectedCount > 0`
- Background: `bg-white border-t shadow-lg` (elevated feel)

**BulkSendConfirmDialog (components/send/bulk-send-confirm-dialog.tsx):**
- `'use client'` component using Radix Dialog
- Props: `open`, `onOpenChange`, `contacts: Contact[]`, `template: EmailTemplate`, `scheduledFor: string | null`, `resendReadyIds: Set<string>`, `onConfirm`, `isPending: boolean`
- Content:
  - Title: "Confirm Send" or "Confirm Schedule"
  - Summary section:
    - Total contacts: X
    - Eligible (not on cooldown, not opted out): Y
    - Skipped (on cooldown): Z (with reason)
    - Opted out (excluded): W
  - Template name + schedule time
  - Calculate eligible/skipped client-side by checking each contact against cooldown rules and opt-out status
  - If all skipped: show warning, disable send
  - Primary button: "Send to {eligible} contacts" or "Schedule for {eligible} contacts"
  - Cancel button
- On confirm: call `batchSendReviewRequest` or `scheduleReviewRequest` server action
- On success: close dialog, show `toastSendSuccess` from lib/utils/toast.ts, clear selection
- On error: show error in dialog

**Wire into Send page (app/(dashboard)/send/page.tsx):**
- Replace the Bulk Send placeholder with actual `<BulkSendTab>` component
- Pass all required props from server-fetched data
- Ensure Bulk Send tab receives: contacts, templates, monthlyUsage, hasReviewLink, resendReadyContactIds
  </action>
  <verify>
- `pnpm typecheck` passes
- `pnpm lint` passes
- Select contacts in Bulk Send tab: sticky bar slides up
- Click "Send request": confirmation dialog opens with correct counts
- Confirm send: action executes, toast shown, selection cleared
- "Send to all filtered" works with filter chips active
  </verify>
  <done>Sticky action bar appears on contact selection. Confirmation dialog shows accurate counts (eligible, skipped, opted out). Send/schedule actions work. Bulk Send tab fully functional.</done>
</task>

</tasks>

<verification>
- Bulk Send tab shows contacts table with filter chips
- Filter chips correctly filter contacts (Never sent, Added today, etc.)
- Row selection with checkboxes works
- Sticky bottom bar appears when contacts selected
- Confirmation dialog shows total, eligible, skipped counts
- Send action succeeds with toast notification
- Schedule action succeeds with correct datetime
- Opted-out contacts excluded from send
- `pnpm typecheck && pnpm lint` pass
</verification>

<success_criteria>
Bulk Send tab fully functional: filter, select, confirm, send. Sticky action bar with Gmail-style UX. Confirmation dialog with accurate eligibility counts. Both send-now and schedule-later work.
</success_criteria>

<output>
After completion, create `.planning/phases/19-ux-ui-redesign/19-06-SUMMARY.md`
</output>
