# Plan 08.1-02: Maintainability, UX, SEO, and Accessibility Fixes

## Goal
Fix maintainability, UX, SEO, and accessibility issues identified in code review.

## Requirements Covered
- MAINT-01: Centralize contact limits
- MAINT-02: Extract shared types
- MAINT-03: Fix step count comment
- UX-01: Fix broken footer links
- UX-02: Auth page layout consistency
- SEO-01: Dynamic copyright year
- A11Y-01: ARIA attributes on progress

## Tasks

### Task 1: Centralize contact limits (MAINT-01)
**File:** `lib/constants/billing.ts`

Add contact limits to existing billing constants:

```typescript
// Add to existing file
export const CONTACT_LIMITS: Record<string, number | undefined> = {
  trial: undefined,  // Unlimited for trial
  basic: 200,        // 200 for basic
  pro: undefined,    // Unlimited for pro
}
```

**File:** `app/(dashboard)/billing/page.tsx`

Import from constants instead of inline definition:

```typescript
import { CONTACT_LIMITS } from '@/lib/constants/billing'

// Remove inline CONTACT_LIMITS definition (lines 36-40)
```

### Task 2: Extract shared onboarding types (MAINT-02)
**File:** `lib/types/onboarding.ts` (new file)

```typescript
export type OnboardingBusiness = {
  name: string
  google_review_link: string | null
} | null

export type OnboardingContact = {
  id: string
  name: string
  email: string
} | null

export type OnboardingTemplate = {
  id: string
  subject: string
  body: string
} | null
```

**Files to update:**
- `components/onboarding/onboarding-wizard.tsx` - Import types
- `components/onboarding/onboarding-steps.tsx` - Import types

### Task 3: Fix step count comment (MAINT-03)
**File:** `app/(dashboard)/onboarding/page.tsx`

Update comment at line 44-45:

```typescript
// Validate step range (1-3), clamp if out of range
// Note: Wizard has 3 steps (Business, Contact, Send). Review Link is part of Business step.
const currentStep = Math.min(Math.max(1, stepParam), 3)
```

### Task 4: Fix broken footer links (UX-01)
**File:** `app/(marketing)/layout.tsx`

Remove links to non-existent pages (will be created in Phase 9 if needed):

```typescript
{/* Company links */}
<div>
  <h3 className="font-semibold mb-3">Company</h3>
  <ul className="space-y-2 text-sm text-muted-foreground">
    {/* Links removed - pages don't exist yet */}
  </ul>
</div>

{/* Legal links */}
<div>
  <h3 className="font-semibold mb-3">Legal</h3>
  <ul className="space-y-2 text-sm text-muted-foreground">
    {/* Links removed - pages don't exist yet */}
  </ul>
</div>
```

Or simplify footer to only include working links.

### Task 5: Auth page layout consistency (UX-02)
**Files:** `app/auth/login/page.tsx`, `app/auth/sign-up/page.tsx`

Add marketing header and simple link back to home:

```typescript
import Link from "next/link"

export default function Page() {
  return (
    <div className="flex min-h-svh flex-col">
      {/* Simple header with logo */}
      <header className="p-4">
        <Link href="/" className="text-xl font-bold">
          AvisLoop
        </Link>
      </header>

      {/* Existing content */}
      <div className="flex flex-1 items-center justify-center p-6 md:p-10">
        <div className="w-full max-w-sm">
          <LoginForm />
        </div>
      </div>
    </div>
  )
}
```

### Task 6: Dynamic copyright year (SEO-01)
**File:** `app/(marketing)/layout.tsx`

Create client component for dynamic year:

```typescript
// components/marketing/footer-copyright.tsx
'use client'

export function FooterCopyright() {
  return (
    <p>&copy; {new Date().getFullYear()} AvisLoop. All rights reserved.</p>
  )
}
```

Or use inline approach (simpler):

```typescript
// In layout.tsx footer section
<p>&copy; {new Date().getFullYear()} AvisLoop. All rights reserved.</p>
```

Note: This works in Server Components as build-time value. For truly dynamic year, use client component.

### Task 7: Add ARIA attributes to progress indicator (A11Y-01)
**File:** `components/onboarding/onboarding-progress.tsx`

Add proper ARIA attributes:

```typescript
export function OnboardingProgress({
  currentStep,
  totalSteps,
  stepTitles,
}: { ... }) {
  return (
    <div
      className="w-full"
      role="group"
      aria-label={`Onboarding progress: Step ${currentStep} of ${totalSteps}`}
    >
      {/* Mobile: Compact step indicator */}
      <div className="md:hidden text-center" aria-hidden="true">
        {/* ... */}
      </div>

      {/* Desktop: Full horizontal stepper */}
      <nav
        className="hidden md:flex items-start justify-between"
        aria-label="Onboarding steps"
      >
        {steps.map((step, index) => (
          <div key={step} className="flex items-center flex-1">
            <div className="flex flex-col items-center">
              <div
                className={cn(/* ... */)}
                aria-current={step === currentStep ? 'step' : undefined}
                aria-label={`Step ${step}: ${stepTitles[index]}${step < currentStep ? ' (completed)' : ''}`}
              >
                {/* ... */}
              </div>
              {/* ... */}
            </div>
            {/* ... */}
          </div>
        ))}
      </nav>
    </div>
  )
}
```

## Verification

After implementation:
1. `pnpm lint` passes
2. `pnpm typecheck` passes
3. Footer displays without 404 links
4. Auth pages show AvisLoop branding
5. Copyright year is current
6. Onboarding progress announces correctly to screen readers
7. No duplicate type definitions

## Files Modified/Created

1. `lib/constants/billing.ts` - Add CONTACT_LIMITS
2. `lib/types/onboarding.ts` - New shared types file
3. `components/onboarding/onboarding-wizard.tsx` - Import shared types
4. `components/onboarding/onboarding-steps.tsx` - Import shared types
5. `app/(dashboard)/onboarding/page.tsx` - Fix comment
6. `app/(marketing)/layout.tsx` - Fix footer links + dynamic year
7. `app/auth/login/page.tsx` - Add branding header
8. `app/auth/sign-up/page.tsx` - Add branding header
9. `components/onboarding/onboarding-progress.tsx` - Add ARIA
