# Phase 8.1: Code Review Fixes

## Overview

Fix 12 issues identified in code review of phases 6, 7, and 8.

## Issues by Category

### Security (4 issues) - HIGH PRIORITY

| ID | Issue | File | Severity |
|----|-------|------|----------|
| SEC-01 | Missing rate limiting for failed Stripe webhook signature attempts | `app/api/webhooks/stripe/route.ts` | HIGH |
| SEC-02 | Service role Supabase client at module level (should be in handler) | `app/api/webhooks/stripe/route.ts:8-11` | MEDIUM |
| SEC-03 | Non-null assertions on env vars without validation | `app/(dashboard)/billing/page.tsx:13-14` | MEDIUM |
| SEC-04 | localStorage data used without schema validation | `components/onboarding/onboarding-wizard.tsx:71-79` | MEDIUM |

### Maintainability (3 issues)

| ID | Issue | File | Severity |
|----|-------|------|----------|
| MAINT-01 | Contact limits defined inline, not centralized | `app/(dashboard)/billing/page.tsx:36-40` | LOW |
| MAINT-02 | Business/Contact/Template types duplicated | `components/onboarding/*.tsx` | LOW |
| MAINT-03 | Comment says 4 steps but wizard has 3 | `app/(dashboard)/onboarding/page.tsx:44-45` | LOW |

### UX (2 issues)

| ID | Issue | File | Severity |
|----|-------|------|----------|
| UX-01 | Footer links to non-existent pages | `app/(marketing)/layout.tsx:79-103` | MEDIUM |
| UX-02 | Auth pages don't share marketing layout | `app/auth/login/page.tsx`, `app/auth/sign-up/page.tsx` | LOW |

### SEO (1 issue)

| ID | Issue | File | Severity |
|----|-------|------|----------|
| SEO-01 | Hardcoded copyright year | `app/(marketing)/layout.tsx:110` | MEDIUM |

### Performance (1 issue)

| ID | Issue | File | Severity |
|----|-------|------|----------|
| PERF-01 | Sequential DB queries (should be parallel) | `lib/data/subscription.ts:48-113` | LOW |

### Accessibility (1 issue)

| ID | Issue | File | Severity |
|----|-------|------|----------|
| A11Y-01 | Missing ARIA attributes on progress indicator | `components/onboarding/onboarding-progress.tsx` | LOW |

## Plan Structure

### Plan 1: Security and Performance Fixes (08.1-01)
- SEC-01: Add rate limiting to Stripe webhook
- SEC-02: Move service role client inside handler
- SEC-03: Add env var validation for price IDs
- SEC-04: Add Zod validation for localStorage data
- PERF-01: Parallelize queries in getBusinessBillingInfo

### Plan 2: Maintainability, UX, SEO, A11Y Fixes (08.1-02)
- MAINT-01: Centralize contact limits in billing constants
- MAINT-02: Extract shared types to lib/types/onboarding.ts
- MAINT-03: Fix step count comment
- UX-01: Remove broken footer links (create pages in Phase 9)
- UX-02: Add marketing header/footer to auth pages
- SEO-01: Dynamic copyright year
- A11Y-01: Add ARIA attributes to progress indicator

## Success Criteria

1. ✅ All security issues resolved
2. ✅ Performance optimization applied
3. ✅ Code organization improved
4. ✅ UX consistency improved
5. ✅ SEO issue fixed
6. ✅ Accessibility improved
7. ✅ Lint and typecheck pass
8. ✅ All existing functionality preserved
