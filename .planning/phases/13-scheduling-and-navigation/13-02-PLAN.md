---
phase: 13-scheduling-and-navigation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/scheduled/page.tsx
  - components/scheduled/scheduled-table.tsx
  - components/scheduled/cancel-button.tsx
autonomous: true

must_haves:
  truths:
    - "User can view a list of scheduled sends showing recipient count, scheduled time, and status"
    - "User sees empty state with link to /send when no scheduled sends exist"
    - "User can cancel a pending scheduled send from the table"
  artifacts:
    - path: "app/(dashboard)/scheduled/page.tsx"
      provides: "Scheduled sends page with auth check and data fetching"
      contains: "getScheduledSends"
    - path: "components/scheduled/scheduled-table.tsx"
      provides: "Client table component displaying scheduled sends"
      contains: "use client"
    - path: "components/scheduled/cancel-button.tsx"
      provides: "Cancel button with loading state and confirmation"
      contains: "cancelScheduledSend"
  key_links:
    - from: "app/(dashboard)/scheduled/page.tsx"
      to: "lib/actions/schedule.ts"
      via: "Server-side data fetch"
      pattern: "getScheduledSends"
    - from: "components/scheduled/cancel-button.tsx"
      to: "lib/actions/schedule.ts"
      via: "Server action call"
      pattern: "cancelScheduledSend"
    - from: "components/scheduled/scheduled-table.tsx"
      to: "components/scheduled/cancel-button.tsx"
      via: "Component composition"
      pattern: "CancelButton"
---

<objective>
Create the /scheduled page where users can view their scheduled sends and cancel pending ones.

Purpose: Users need a destination for the "Scheduled" nav link (NAV-01) and a place to manage their scheduled sends. This page is also linked from the send-form's schedule success confirmation.
Output: Fully functional /scheduled page with table, empty state, and cancel action.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-scheduling-and-navigation/13-RESEARCH.md

Key existing files:
@lib/actions/schedule.ts (getScheduledSends, cancelScheduledSend already exist)
@lib/types/database.ts (ScheduledSend type defined)
@lib/utils/schedule.ts (formatScheduleDate for display)
@app/(dashboard)/history/page.tsx (pattern for similar list page)
@components/send/send-form.tsx (links to /scheduled on success -- line 108)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /scheduled page with server-side data fetching</name>
  <files>
    app/(dashboard)/scheduled/page.tsx
  </files>
  <action>
    Create `app/(dashboard)/scheduled/page.tsx` as a Server Component:

    1. Import createClient from `@/lib/supabase/server`, redirect from `next/navigation`
    2. Import getScheduledSends from `@/lib/actions/schedule`
    3. Import ScheduledTable from `@/components/scheduled/scheduled-table`
    4. Import Calendar, Send from lucide-react, and Link from next/link

    5. Auth check: get user from supabase, redirect to /login if not authenticated

    6. Fetch scheduled sends with `await getScheduledSends()`

    7. Render page layout:
       - Container with standard spacing (`container mx-auto py-6 px-4`)
       - Header: h1 "Scheduled Sends" + subtitle "Manage your scheduled review requests"
       - Empty state when `scheduledSends.length === 0`:
         - Dashed border container with Calendar icon (h-12 w-12, muted)
         - "No scheduled sends" heading
         - "Schedule review requests from the Send page" description
         - Link to /send styled as primary button with Send icon: "Schedule a Send"
       - When sends exist: render `<ScheduledTable sends={scheduledSends} />`

    8. Add metadata export: `export const metadata = { title: 'Scheduled Sends' }`

    Follow the exact pattern from existing pages like history/page.tsx for layout consistency.
  </action>
  <verify>
    - File exists at `app/(dashboard)/scheduled/page.tsx`
    - `pnpm typecheck` passes
  </verify>
  <done>
    - /scheduled route renders with auth check
    - Empty state shows when no scheduled sends
    - Table renders when scheduled sends exist
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ScheduledTable and CancelButton client components</name>
  <files>
    components/scheduled/scheduled-table.tsx
    components/scheduled/cancel-button.tsx
  </files>
  <action>
    1. Create `components/scheduled/cancel-button.tsx`:
       - "use client" directive
       - Import useState from react
       - Import cancelScheduledSend from `@/lib/actions/schedule`
       - Import toast from sonner
       - Import Loader2, X from lucide-react
       - Props: `{ scheduledSendId: string }`
       - On click: show native `confirm('Cancel this scheduled send?')` dialog
       - If confirmed: set isPending true, call `cancelScheduledSend(scheduledSendId)`
       - On success: `toast.success('Scheduled send cancelled')`
       - On error: `toast.error(result.error)`
       - Render as a destructive-styled small button: `text-sm text-destructive hover:underline disabled:opacity-50`
       - Show Loader2 spinner when pending, X icon when idle
       - Only show button (don't render anything) -- the parent decides visibility

    2. Create `components/scheduled/scheduled-table.tsx`:
       - "use client" directive
       - Import ScheduledSend from `@/lib/types/database`
       - Import formatScheduleDate from `@/lib/utils/schedule`
       - Import CancelButton from `./cancel-button`
       - Import Calendar, Clock, Users, CheckCircle2, XCircle, AlertTriangle from lucide-react
       - Import Badge from `@/components/ui/badge`

       - Props: `{ sends: ScheduledSend[] }`

       - Separate sends into two groups:
         - `pending`: sends with status === 'pending', sorted by scheduled_for ascending
         - `past`: sends with status !== 'pending' (completed, failed, cancelled), sorted by scheduled_for descending

       - Render a responsive table (or card list on mobile):
         - For each scheduled send, show:
           - Contact count: `send.contact_ids.length` contacts (Users icon)
           - Scheduled time: `formatScheduleDate(send.scheduled_for)` (Clock icon)
           - Status badge using Badge component:
             - pending: variant="default" (primary color)
             - completed: variant="secondary" with CheckCircle2 icon
             - failed: variant="destructive"
             - cancelled: variant="outline"
           - Cancel button: only show CancelButton for pending sends
         - Use a simple HTML table with `w-full` on desktop
         - On mobile, use card-style layout (each send as a bordered card)
         - Use responsive approach: `<div className="hidden md:block">` for table, `<div className="md:hidden">` for cards

       - If pending section is empty but past exists, show small note: "No pending scheduled sends"
       - Show "Past Scheduled Sends" subheading before past sends section

       - Handle the case where contact_ids might be large: show "X contacts" not individual names (we don't have contact names in ScheduledSend type)
  </action>
  <verify>
    - Both files exist in components/scheduled/
    - `pnpm typecheck` passes
    - `pnpm lint` passes
    - Grep for "cancelScheduledSend" in cancel-button.tsx confirms wiring
    - Grep for "formatScheduleDate" in scheduled-table.tsx confirms date formatting
  </verify>
  <done>
    - ScheduledTable renders pending and past sends with status badges
    - CancelButton shows confirmation dialog before cancelling
    - Cancel action calls existing cancelScheduledSend server action
    - Toast feedback on cancel success/failure
    - Responsive layout (table on desktop, cards on mobile)
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` -- all new files compile without errors
2. `pnpm lint` -- no lint errors
3. /scheduled page exists under (dashboard) route group (inherits AppShell layout)
4. Empty state links to /send
5. Table displays contact count, scheduled time, status badge
6. Cancel button only appears for pending sends
7. Page uses existing getScheduledSends and cancelScheduledSend actions (no new server actions)
</verification>

<success_criteria>
- /scheduled page renders scheduled sends list with status information
- Empty state shows helpful message and link to /send
- Users can cancel pending sends with confirmation dialog
- Responsive design works on mobile and desktop
- All existing schedule actions are properly wired
</success_criteria>

<output>
After completion, create `.planning/phases/13-scheduling-and-navigation/13-02-SUMMARY.md`
</output>
