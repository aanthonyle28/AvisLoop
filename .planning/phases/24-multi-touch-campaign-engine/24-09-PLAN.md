---
phase: 24-multi-touch-campaign-engine
plan: 09
type: execute
wave: 4
depends_on: [24-05, 24-07]
files_modified:
  - components/jobs/job-completion-dialog.tsx
  - components/jobs/job-form.tsx
  - app/(dashboard)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Job completion shows 'Enroll in review campaign' checkbox (checked by default)"
    - "Unchecking the checkbox skips campaign enrollment for that job"
    - "Navigation includes Campaigns link with proper icon"
  artifacts:
    - path: "components/jobs/job-completion-dialog.tsx"
      provides: "Job completion with enrollment checkbox"
      contains: "enrollInCampaign"
    - path: "app/(dashboard)/layout.tsx"
      provides: "Updated navigation with Campaigns link"
      contains: "/campaigns"
  key_links:
    - from: "components/jobs/job-completion-dialog.tsx"
      to: "lib/actions/job.ts"
      via: "form submission with enrollment flag"
      pattern: "enrollInCampaign"
---

<objective>
Add enrollment checkbox to job completion flow and add Campaigns to navigation.

Purpose: Complete the job-to-campaign enrollment flow with user control, and make campaigns accessible from the main navigation.

Output: Updated job completion UI with enrollment checkbox and navigation update.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/24-multi-touch-campaign-engine/24-CONTEXT.md
@components/jobs/job-form.tsx
@app/(dashboard)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add enrollment checkbox to job completion</name>
  <files>components/jobs/job-completion-dialog.tsx, components/jobs/job-form.tsx</files>
  <action>
Check if job-completion-dialog.tsx exists. If not, the enrollment checkbox should be added to the job form when marking as complete.

**Option A: If job-completion-dialog.tsx exists:**

Add to the dialog:
```typescript
import { Checkbox } from '@/components/ui/checkbox'
import { Label } from '@/components/ui/label'

// Inside the dialog form
<div className="flex items-center space-x-2">
  <Checkbox
    id="enrollInCampaign"
    checked={enrollInCampaign}
    onCheckedChange={(checked) => setEnrollInCampaign(!!checked)}
    defaultChecked
  />
  <Label htmlFor="enrollInCampaign" className="text-sm">
    Enroll in review campaign
  </Label>
</div>
<p className="text-xs text-muted-foreground ml-6">
  Automatically send review requests for this job
</p>
```

**Option B: If job form handles status change:**

Modify components/jobs/job-form.tsx to show enrollment checkbox when status changes to 'completed':

```typescript
// Add state
const [enrollInCampaign, setEnrollInCampaign] = useState(true)

// In the form, conditionally show checkbox when status is 'completed'
{watchedStatus === 'completed' && (
  <div className="space-y-2 rounded-lg border bg-muted/50 p-4">
    <div className="flex items-center space-x-2">
      <Checkbox
        id="enrollInCampaign"
        checked={enrollInCampaign}
        onCheckedChange={(checked) => setEnrollInCampaign(!!checked)}
      />
      <Label htmlFor="enrollInCampaign" className="font-normal">
        Enroll in review campaign
      </Label>
    </div>
    <p className="text-xs text-muted-foreground ml-6">
      Automatically send review requests based on your active campaign
    </p>
  </div>
)}

// Pass to form submission
const onSubmit = (data) => {
  startTransition(async () => {
    const result = await updateJob(jobId, {
      ...data,
      enrollInCampaign: data.status === 'completed' ? enrollInCampaign : undefined,
    })
    // ...
  })
}
```

**Key behaviors:**
- Checkbox only shows when status is/becomes 'completed'
- Default is checked (90% enroll, 10% uncheck for bad jobs per CONTEXT.md)
- Unchecking prevents enrollment but still marks job complete
- Small helper text explains what enrollment does
  </action>
  <verify>Job form shows enrollment checkbox when status is completed; checkbox is checked by default</verify>
  <done>Job completion includes 'Enroll in review campaign' checkbox checked by default</done>
</task>

<task type="auto">
  <name>Task 2: Add Campaigns to navigation</name>
  <files>app/(dashboard)/layout.tsx</files>
  <action>
Read existing app/(dashboard)/layout.tsx and add Campaigns link to the navigation.

Find the navigation array/section and add Campaigns:

```typescript
import { Megaphone } from '@phosphor-icons/react/dist/ssr'  // or 'react' for client

// In the nav items array, add after Jobs or before History:
{
  name: 'Campaigns',
  href: '/campaigns',
  icon: Megaphone,  // or use Funnel, Flow, ListChecks depending on what icons are available
}
```

**Navigation order per CONTEXT.md (for reference):**
1. Send/Queue
2. Customers
3. Jobs
4. **Campaigns** (new)
5. Activity/History

If the navigation uses a different structure, adapt accordingly but ensure Campaigns appears in the main navigation with an appropriate icon.

Choose icon that fits the existing icon set:
- Megaphone (announcement/campaign feel)
- Funnel (conversion funnel)
- Flow (sequence/flow)
- Target (targeting)
- ListChecks (checklist/sequence)

Match the icon style used by other nav items (filled vs regular weight).
  </action>
  <verify>Navigation includes Campaigns link that routes to /campaigns</verify>
  <done>Dashboard navigation includes Campaigns link with appropriate icon</done>
</task>

</tasks>

<verification>
Run after all tasks:
1. `pnpm typecheck` - All imports compile
2. `pnpm lint` - No lint errors
3. Job form shows enrollment checkbox when status is 'completed'
4. Checkbox is checked by default
5. Navigation shows Campaigns link
6. Clicking Campaigns navigates to /campaigns
</verification>

<success_criteria>
- [ ] Job completion shows enrollment checkbox
- [ ] Checkbox is checked by default (opt-out model)
- [ ] Unchecking prevents enrollment for that job
- [ ] Checkbox only shows when status is 'completed'
- [ ] Helper text explains enrollment behavior
- [ ] Navigation includes Campaigns link
- [ ] Campaigns link routes to /campaigns page
- [ ] `pnpm typecheck` passes
</success_criteria>

<output>
After completion, create `.planning/phases/24-multi-touch-campaign-engine/24-09-SUMMARY.md`
</output>
