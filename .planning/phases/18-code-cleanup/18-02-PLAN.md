---
phase: 18-code-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/history/history-client.tsx
  - app/(dashboard)/history/page.tsx
autonomous: true

must_haves:
  truths:
    - "History page shows pagination controls when total exceeds page size (50)"
    - "User can navigate to next/previous pages of message history"
    - "Pagination state is preserved in URL search params"
    - "Pagination controls are hidden when total fits in one page"
  artifacts:
    - path: "components/history/history-client.tsx"
      provides: "Pagination UI with prev/next buttons"
      contains: "page"
    - path: "app/(dashboard)/history/page.tsx"
      provides: "Page number passed to client component"
      contains: "page"
  key_links:
    - from: "components/history/history-client.tsx"
      to: "URL search params"
      via: "useSearchParams + router.replace"
      pattern: "page"
---

<objective>
Add pagination controls to the history page so users can navigate through messages when there are more than 50 results.

Purpose: The history page already has server-side pagination (limit=50, offset from page param) but no UI controls to navigate between pages. Users with >50 messages have no way to see older messages.
Output: Previous/Next pagination buttons in the history client component, driven by URL search params.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@app/(dashboard)/history/page.tsx
@components/history/history-client.tsx
@components/history/history-filters.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pass current page to HistoryClient and add pagination UI</name>
  <files>
    app/(dashboard)/history/page.tsx
    components/history/history-client.tsx
  </files>
  <action>
**1. Update `app/(dashboard)/history/page.tsx`:**

Pass `currentPage` and `pageSize` props to HistoryClient:
- In `HistoryContent`, after computing `page` and `limit`, pass them to the component:
  ```tsx
  return <HistoryClient initialLogs={logs} total={total} currentPage={page} pageSize={limit} />
  ```

**2. Update `components/history/history-client.tsx`:**

Add pagination props and controls:

a) Update the interface:
```tsx
interface HistoryClientProps {
  initialLogs: SendLogWithContact[]
  total: number
  currentPage: number
  pageSize: number
}
```

b) Destructure new props:
```tsx
export function HistoryClient({ initialLogs, total, currentPage, pageSize }: HistoryClientProps)
```

c) Add pagination logic:
```tsx
const totalPages = Math.ceil(total / pageSize)
const hasPreviousPage = currentPage > 1
const hasNextPage = currentPage < totalPages
```

d) Add a `goToPage` function that updates the `page` URL search param (similar pattern to HistoryFilters):
```tsx
const pathname = usePathname()
const { replace } = useRouter()
const [isPending, startTransition] = useTransition()

function goToPage(page: number) {
  const params = new URLSearchParams(searchParams.toString())
  if (page <= 1) {
    params.delete('page')
  } else {
    params.set('page', String(page))
  }
  startTransition(() => {
    replace(`${pathname}?${params.toString()}`)
  })
}
```

e) Add imports: `usePathname`, `useRouter`, `useTransition` from `next/navigation`. Import `Button` from `@/components/ui/button`. Import `CaretLeft`, `CaretRight` from `@phosphor-icons/react` (project uses Phosphor icons per design system).

f) Render pagination controls BELOW the HistoryTable, inside the `hasLogs` branch. Only show when `totalPages > 1`:
```tsx
{totalPages > 1 && (
  <div className="flex items-center justify-between pt-4">
    <p className="text-sm text-muted-foreground">
      Page {currentPage} of {totalPages}
    </p>
    <div className="flex items-center gap-2">
      <Button
        variant="outline"
        size="sm"
        onClick={() => goToPage(currentPage - 1)}
        disabled={!hasPreviousPage || isPending}
      >
        <CaretLeft className="h-4 w-4 mr-1" />
        Previous
      </Button>
      <Button
        variant="outline"
        size="sm"
        onClick={() => goToPage(currentPage + 1)}
        disabled={!hasNextPage || isPending}
      >
        Next
        <CaretRight className="h-4 w-4 ml-1" />
      </Button>
    </div>
  </div>
)}
```

g) Update the "Showing X of Y" text to include page context:
```tsx
Showing {((currentPage - 1) * pageSize) + 1}-{Math.min(currentPage * pageSize, total)} of {total} message{total !== 1 ? 's' : ''}
```

Design notes:
- Use `variant="outline"` on buttons (border-only design system, no shadows)
- Use Phosphor icons (CaretLeft, CaretRight) not Lucide
- Keep layout simple: page info left, buttons right
- Disabled state when on first/last page or during transition
  </action>
  <verify>
- `pnpm typecheck` passes
- `pnpm lint` passes
- `grep "totalPages" components/history/history-client.tsx` returns matches
- `grep "currentPage" components/history/history-client.tsx` returns matches
- `grep "CaretLeft\|CaretRight" components/history/history-client.tsx` returns matches (Phosphor icons)
- `grep "currentPage" app/(dashboard)/history/page.tsx` returns match (prop passed)
  </verify>
  <done>
History page has Previous/Next pagination buttons that appear when messages exceed 50. Page state is URL-driven. Controls use Phosphor icons and the project design system (outline buttons, no shadows).
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` → passes
2. `pnpm lint` → passes
3. History client renders pagination when total > pageSize
4. Pagination controls hidden when total <= pageSize
5. Previous disabled on page 1, Next disabled on last page
6. Page state persisted in URL via `?page=N` search param
7. "Showing X-Y of Z" text reflects current page range
</verification>

<success_criteria>
- History page shows prev/next pagination controls when >50 messages exist
- Controls are hidden when <=50 messages
- Page navigation works via URL search params
- Design matches project conventions (Phosphor icons, outline buttons, border-only)
- Lint and typecheck pass
</success_criteria>

<output>
After completion, create `.planning/phases/18-code-cleanup/18-02-SUMMARY.md`
</output>
