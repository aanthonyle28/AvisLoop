---
phase: 41
plan: 41-02
title: "Radix Select for status filter + date preset chips"
wave: 1
depends_on: []
files_modified:
  - components/history/history-filters.tsx
autonomous: true
---

## Objective

Replace the native HTML `<select>` for status filtering with the Radix Select component, and add four date preset chips (Today, Past Week, Past Month, Past 3 Months) alongside the existing custom date range inputs, with mutual exclusion between presets and manual date editing.

## Context

@components/history/history-filters.tsx — Current filter component with native `<select>` and date inputs
@components/ui/select.tsx — Existing Radix Select component (SelectTrigger, SelectContent, SelectItem, SelectValue)
@components/jobs/job-filters.tsx — Chip filter pattern to match (rounded-full pills with bg-primary when active)
@.planning/phases/41-activity-page-overhaul/41-RESEARCH.md — Full research with code examples, layout structure, and date preset constants

## Tasks

<task id="1">
### Replace native select with Radix Select and add date preset chips

Rewrite `components/history/history-filters.tsx` to:

**1. Add imports:**
```tsx
import { useState } from 'react'
import { format, subWeeks, subMonths } from 'date-fns'
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select'
```
Keep existing imports: `useSearchParams`, `usePathname`, `useRouter`, `useTransition`, `useRef`, `useEffect`, `Input`, `Button`, `Label`, `X`, `MagnifyingGlass`, `CircleNotch`.

**2. Define DATE_PRESETS constant** (above the component, below STATUS_OPTIONS):
```tsx
const DATE_PRESETS = [
  {
    label: 'Today',
    getRange: () => {
      const today = format(new Date(), 'yyyy-MM-dd')
      return { from: today, to: today }
    },
  },
  {
    label: 'Past Week',
    getRange: () => ({
      from: format(subWeeks(new Date(), 1), 'yyyy-MM-dd'),
      to: format(new Date(), 'yyyy-MM-dd'),
    }),
  },
  {
    label: 'Past Month',
    getRange: () => ({
      from: format(subMonths(new Date(), 1), 'yyyy-MM-dd'),
      to: format(new Date(), 'yyyy-MM-dd'),
    }),
  },
  {
    label: 'Past 3 Months',
    getRange: () => ({
      from: format(subMonths(new Date(), 3), 'yyyy-MM-dd'),
      to: format(new Date(), 'yyyy-MM-dd'),
    }),
  },
]
```

**3. Add state for active preset:**
```tsx
const [activePreset, setActivePreset] = useState<string | null>(null)
```

**4. Add `updateDateRange` function** that sets both `from` and `to` in a single URL navigation (not two separate `updateFilter` calls):
```tsx
function updateDateRange(from: string, to: string) {
  const params = new URLSearchParams(searchParams)
  params.set('page', '1')
  if (from) {
    params.set('from', from)
  } else {
    params.delete('from')
  }
  if (to) {
    params.set('to', to)
  } else {
    params.delete('to')
  }
  startTransition(() => {
    replace(`${pathname}?${params.toString()}`)
  })
}
```

**5. Add preset handler functions:**
```tsx
function applyPreset(preset: typeof DATE_PRESETS[number]) {
  if (activePreset === preset.label) {
    // Toggle off: clear dates
    setActivePreset(null)
    updateDateRange('', '')
    return
  }
  const { from, to } = preset.getRange()
  setActivePreset(preset.label)
  updateDateRange(from, to)
}

function handleDateInputChange(key: 'from' | 'to', value: string) {
  setActivePreset(null) // Deselect any active preset
  updateFilter(key, value)
}
```

**6. Also clear activePreset when clearFilters is called:**
In the existing `clearFilters` function, add `setActivePreset(null)` before the `startTransition`:
```tsx
function clearFilters() {
  setActivePreset(null)
  startTransition(() => {
    replace(pathname)
  })
}
```

**7. Replace the JSX with two-row layout:**

Row 1: Search input + Radix Select (replaces native `<select>`):
```tsx
<div className="flex flex-col sm:flex-row gap-4">
  {/* Search input — unchanged */}
  <div className="relative flex-1">
    <MagnifyingGlass size={16} weight="regular" className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground" />
    <Input
      placeholder="Search by name or email..."
      defaultValue={query}
      onChange={(e) => handleSearchChange(e.target.value)}
      className="pl-9"
    />
  </div>

  {/* Status filter — Radix Select */}
  <Select value={status} onValueChange={(v) => updateFilter('status', v)}>
    <SelectTrigger className="w-full sm:w-[180px]">
      <SelectValue />
    </SelectTrigger>
    <SelectContent>
      {STATUS_OPTIONS.map((option) => (
        <SelectItem key={option.value} value={option.value}>
          {option.label}
        </SelectItem>
      ))}
    </SelectContent>
  </Select>
</div>
```

Row 2: Date preset chips + custom date inputs + clear/loading:
```tsx
<div className="flex flex-col sm:flex-row items-start sm:items-center gap-3 flex-wrap">
  {/* Preset chips */}
  <div className="flex items-center gap-2">
    {DATE_PRESETS.map((preset) => (
      <button
        key={preset.label}
        type="button"
        onClick={() => applyPreset(preset)}
        className={`inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-colors ${
          activePreset === preset.label
            ? 'bg-primary text-primary-foreground'
            : 'bg-muted text-muted-foreground hover:bg-muted/80'
        }`}
      >
        {preset.label}
      </button>
    ))}
  </div>

  {/* Vertical separator (desktop only) */}
  <div className="hidden sm:block w-px h-6 bg-border" />

  {/* Custom date inputs */}
  <div className="flex flex-col sm:flex-row items-start sm:items-center gap-3">
    <div className="flex items-center gap-2">
      <Label className="text-sm text-muted-foreground whitespace-nowrap">From</Label>
      <Input
        type="date"
        value={dateFrom}
        onChange={(e) => handleDateInputChange('from', e.target.value)}
        className="w-[150px]"
      />
    </div>
    <div className="flex items-center gap-2">
      <Label className="text-sm text-muted-foreground whitespace-nowrap">To</Label>
      <Input
        type="date"
        value={dateTo}
        onChange={(e) => handleDateInputChange('to', e.target.value)}
        className="w-[150px]"
      />
    </div>
  </div>

  {/* Loading + Clear */}
  <div className="flex items-center gap-2">
    {isPending && (
      <CircleNotch size={16} weight="regular" className="animate-spin text-muted-foreground" />
    )}
    {hasActiveFilters && (
      <Button variant="ghost" size="sm" onClick={clearFilters}>
        <X size={12} weight="regular" className="mr-1" />
        Clear
      </Button>
    )}
  </div>
</div>
```

**Key behavior details:**
- Selecting a preset chip calls `applyPreset` which sets both `from` and `to` atomically via `updateDateRange`
- Clicking an already-active preset toggles it off and clears both date fields
- Manually changing either date input calls `handleDateInputChange` which sets `activePreset` to null (mutual exclusion)
- `clearFilters` also resets `activePreset` to null
- Date labels are inline with inputs (not stacked above) to save vertical space — matches the research layout
- The `htmlFor` attributes on Labels are removed since they're now inline (not linked to inputs by id). This is acceptable since the inputs are immediately adjacent.
</task>

## Verification

After implementation, run:
```bash
pnpm lint && pnpm typecheck
```

Then verify in `components/history/history-filters.tsx`:

1. No native `<select>` element in the file — replaced with Radix `<Select>` component
2. `STATUS_OPTIONS` array unchanged (same 8 options: all, pending, sent, delivered, bounced, complained, failed, opened)
3. `DATE_PRESETS` array has 4 entries: Today, Past Week, Past Month, Past 3 Months
4. `activePreset` state exists and is used in chip className logic
5. `updateDateRange` function sets both `from` and `to` URL params in a single `replace()` call
6. `applyPreset` toggles off when clicking the already-active preset
7. `handleDateInputChange` sets `activePreset(null)` before calling `updateFilter`
8. `clearFilters` sets `activePreset(null)`
9. Chip classes match pattern: `rounded-full px-3 py-1 text-sm font-medium` with `bg-primary text-primary-foreground` when active
10. Vertical separator between preset chips and date inputs (hidden on mobile)

## must_haves

- [ ] Native HTML `<select>` replaced with Radix Select component from components/ui/select.tsx
- [ ] Same 8 status options preserved (all, pending, sent, delivered, bounced, complained, failed, opened)
- [ ] 4 date preset chips rendered: Today, Past Week, Past Month, Past 3 Months
- [ ] Preset chips use rounded-full pill style with bg-primary text-primary-foreground when active
- [ ] Selecting a preset auto-fills both From and To date inputs atomically (single URL navigation)
- [ ] Clicking an active preset toggles it off and clears date range
- [ ] Manually editing a date input deselects the active preset chip
- [ ] Clear button resets preset state along with URL params
- [ ] pnpm lint passes
- [ ] pnpm typecheck passes
