---
phase: 16-onboarding-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(dashboard)/onboarding/page.tsx
  - components/onboarding/onboarding-wizard.tsx
  - components/onboarding/onboarding-progress.tsx
  - components/onboarding/onboarding-steps.tsx
autonomous: true

must_haves:
  truths:
    - "Onboarding wizard has exactly 2 steps: business name (required) and Google review link (optional/skippable)"
    - "Progress indicator shows horizontal bar at bottom with step counter (1/2, 2/2)"
    - "Each step has centered heading, subtitle, inline row with Back + input + Continue/Finish button"
    - "After wizard completes, user is redirected to /dashboard"
  artifacts:
    - path: "app/(dashboard)/onboarding/page.tsx"
      provides: "Server component for 2-step onboarding"
      contains: "Math.max(1, stepParam), 2"
    - path: "components/onboarding/onboarding-wizard.tsx"
      provides: "2-step wizard shell"
      contains: "STEPS"
    - path: "components/onboarding/onboarding-progress.tsx"
      provides: "Horizontal progress bar at bottom"
    - path: "components/onboarding/onboarding-steps.tsx"
      provides: "Step router for 2 steps"
  key_links:
    - from: "components/onboarding/onboarding-wizard.tsx"
      to: "lib/actions/onboarding.ts"
      via: "markOnboardingComplete on final step"
      pattern: "markOnboardingComplete"
    - from: "app/(dashboard)/onboarding/page.tsx"
      to: "components/onboarding/onboarding-wizard.tsx"
      via: "renders wizard with business data"
      pattern: "OnboardingWizard"
---

<objective>
Redesign the onboarding wizard from 3 steps (business info, contact, send) to 2 steps (business name, Google review link). Simplify the layout with centered headings, inline form rows, and a horizontal progress bar at the bottom.

Purpose: The new onboarding collects only business information. Contact creation, template creation, and test sending move to dashboard cards (Plan 04). This makes onboarding faster and less intimidating.

Output: Redesigned onboarding page, wizard, progress bar, and step components.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-onboarding-redesign/16-CONTEXT.md
@app/(dashboard)/onboarding/page.tsx
@components/onboarding/onboarding-wizard.tsx
@components/onboarding/onboarding-progress.tsx
@components/onboarding/onboarding-steps.tsx
@lib/actions/onboarding.ts
@lib/data/onboarding.ts
@lib/types/onboarding.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign onboarding wizard to 2 steps</name>
  <files>
    components/onboarding/onboarding-wizard.tsx,
    components/onboarding/onboarding-steps.tsx,
    components/onboarding/onboarding-progress.tsx
  </files>
  <action>
**A. Rewrite `onboarding-wizard.tsx`** to have exactly 2 steps:

Update the STEPS config:
```typescript
const STEPS: StepConfig[] = [
  { id: 1, title: 'Business Name', skippable: false },
  { id: 2, title: 'Google Review Link', skippable: true },
]
```

Key changes from current wizard:
- Remove step 3 (Send Request) entirely
- Step 2 is now Google review link (skippable/optional)
- On completing step 2 (or skipping it): call markOnboardingComplete(), redirect to /dashboard
- Keep localStorage draft persistence and Zod validation for draft data
- The overall page layout should be: large centered heading at top, step content in middle, progress bar at BOTTOM of page (not top)
- Remove the separate "Skip this step" button below the card -- integrate skip into the step form itself as a "Skip" button next to "Continue"

Layout structure for the wizard wrapper:
```
<div className="min-h-screen flex flex-col items-center justify-center px-4">
  <div className="w-full max-w-lg space-y-8">
    {/* Step content renders here */}
    <OnboardingSteps ... />
  </div>
  {/* Progress bar fixed at bottom */}
  <OnboardingProgress currentStep={currentStep} totalSteps={2} />
</div>
```

**B. Rewrite `onboarding-steps.tsx`** for 2 steps:

Step 1 - Business Name:
- Large centered heading: "What's your business called?"
- Subtitle: "This will appear in your review request emails."
- Label "Business name" above the input
- Input with placeholder "e.g. Sunrise Dental"
- Single "Continue" button below the input (full width or right-aligned)
- On submit: call existing updateBusiness action with the name
- Required field -- cannot proceed without entering a name

Step 2 - Google Review Link:
- Large centered heading: "Add your Google review link"
- Subtitle: "This is the link customers click to leave you a review. You can add this later."
- Label "Google review link" above the input
- Input with placeholder "https://g.page/r/..."
- Two buttons in a row: "Back" (ghost/outline, left) and "Finish" (primary, right)
- Also show a "Skip" text button/link below or inline: "Skip for now"
- On submit: call updateBusiness with google_review_link, then markOnboardingComplete, redirect to /dashboard
- On skip: call markOnboardingComplete (without saving link), redirect to /dashboard

Each step form should use react-hook-form or simple useState for the input. Keep it simple -- no complex form library needed for single inputs. Use existing `updateBusiness` server action from `@/lib/actions/business`.

Remove imports for ContactStep, SendStep, and OnboardingContact/OnboardingTemplate types that are no longer used.

**C. Rewrite `onboarding-progress.tsx`**:

Replace the current step-title progress indicator with a horizontal progress bar at the bottom of the page:

```tsx
export function OnboardingProgress({ currentStep, totalSteps }: { currentStep: number; totalSteps: number }) {
  const progress = (currentStep / totalSteps) * 100

  return (
    <div className="fixed bottom-0 left-0 right-0 p-4 bg-background border-t">
      <div className="max-w-lg mx-auto flex items-center gap-3">
        <div className="flex-1 h-2 bg-muted rounded-full overflow-hidden">
          <div
            className="h-full bg-primary rounded-full transition-all duration-300"
            style={{ width: `${progress}%` }}
          />
        </div>
        <span className="text-sm text-muted-foreground font-medium">
          {currentStep}/{totalSteps}
        </span>
      </div>
    </div>
  )
}
```

Add ARIA attributes: `role="progressbar"`, `aria-valuenow={currentStep}`, `aria-valuemin={1}`, `aria-valuemax={totalSteps}`.
  </action>
  <verify>
1. Read all three files and confirm 2-step structure
2. Confirm step 1 collects business name, step 2 collects Google review link
3. Confirm progress bar is at bottom with step counter
4. Run `pnpm typecheck` to verify no type errors
  </verify>
  <done>Wizard has exactly 2 steps (business name, Google review link), progress bar is at bottom with "1/2" counter, skip works on step 2, completion redirects to /dashboard.</done>
</task>

<task type="auto">
  <name>Task 2: Update onboarding server page for 2-step wizard</name>
  <files>app/(dashboard)/onboarding/page.tsx</files>
  <action>
Update the onboarding page server component:

1. Change step clamping from `Math.min(Math.max(1, stepParam), 3)` to `Math.min(Math.max(1, stepParam), 2)` (only 2 steps now).

2. Remove data fetching for ContactStep and SendStep that is no longer needed:
   - Remove `getContacts` import and call
   - Remove `getEmailTemplates` import and call
   - Remove `firstContact` and `defaultTemplate` variables
   - Keep `getBusiness()` call -- needed for step 1 (pre-fill business name) and step 2 (pre-fill review link)

3. Simplify the Promise.all to just `getBusiness()`:
   ```typescript
   const business = await getBusiness()
   ```

4. Update OnboardingWizard props -- remove `firstContact` and `defaultTemplate` props since steps 2 and 3 (old) are gone.

5. Update the page layout to be full-screen centered (remove container/max-w-2xl wrapper since wizard handles its own layout now):
   ```tsx
   return <OnboardingWizard initialStep={currentStep} business={business} />
   ```

6. Keep the auth check and onboarding completion redirect.
  </action>
  <verify>
1. Read the page file and confirm step clamping uses 2 not 3
2. Confirm no imports for getContacts, getEmailTemplates
3. Run `pnpm typecheck` to verify no type errors
  </verify>
  <done>Onboarding page fetches only business data, clamps to 2 steps, passes minimal props to wizard.</done>
</task>

</tasks>

<verification>
1. Onboarding wizard shows exactly 2 steps
2. Step 1: business name with "Continue" button
3. Step 2: Google review link with "Back", "Finish", and "Skip" options
4. Progress bar at bottom with step counter
5. Completion redirects to /dashboard
6. `pnpm typecheck` passes
</verification>

<success_criteria>
- Wizard has 2 steps only (business name, Google review link)
- Step 2 is skippable
- Progress bar at bottom of page with "1/2" counter format
- After completion, redirects to /dashboard with onboarding marked complete
- No unused imports or dead code from old 3-step wizard
</success_criteria>

<output>
After completion, create `.planning/phases/16-onboarding-redesign/16-02-SUMMARY.md`
</output>
