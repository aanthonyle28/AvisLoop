---
phase: 30.1-audit-gaps
plan: 06
type: execute
wave: 2
depends_on: []
files_modified:
  - app/(dashboard)/jobs/page.tsx
  - components/send/quick-send-tab.tsx
  - components/send/bulk-send-tab.tsx
  - components/history/request-detail-drawer.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar Add Job button auto-opens Add Job sheet via URL param"
    - "Send Request buttons changed to Send Message"
    - "Terminology consistent: 'message' not 'request'"
  artifacts:
    - path: "app/(dashboard)/jobs/page.tsx"
      provides: "URL param handling for auto-open"
      contains: "action=add"
    - path: "components/send/quick-send-tab.tsx"
      provides: "Updated button text"
      contains: "Send Message"
  key_links:
    - from: "components/layout/sidebar.tsx"
      to: "app/(dashboard)/jobs/page.tsx"
      via: "href /jobs?action=add"
      pattern: "jobs.*action=add"
---

<objective>
Implement "Add Job" sidebar auto-open behavior and fix "Send Request" -> "Send Message" terminology.

Purpose: Improve UX by auto-opening Add Job form when clicking sidebar button (QA L03-01), and align terminology with V2 philosophy (QA L08-01, L08-02).

Output: Add Job sheet opens via URL param, all "Send Request" buttons say "Send Message".
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/QA-AUDIT.md (L03-01, L08-01, L08-02)

Jobs page: @app/(dashboard)/jobs/page.tsx
Sidebar already links to /jobs?action=add: @components/layout/sidebar.tsx (line 156)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement URL param auto-open for Add Job</name>
  <files>app/(dashboard)/jobs/page.tsx</files>
  <action>
The sidebar already links to `/jobs?action=add`. Update the Jobs page to read this param and auto-open the Add Job sheet.

If Jobs page is a server component that renders a client component:

1. In the server component (page.tsx), read searchParams
2. Pass `defaultOpen` prop to client component
3. Client component uses this to set initial sheet state

```tsx
// In app/(dashboard)/jobs/page.tsx
interface JobsPageProps {
  searchParams: Promise<{ action?: string }>
}

export default async function JobsPage({ searchParams }: JobsPageProps) {
  const { action } = await searchParams
  const shouldOpenAddJob = action === 'add'

  // ... existing data fetching ...

  return (
    <JobsClient
      jobs={jobs}
      customers={customers}
      defaultAddJobOpen={shouldOpenAddJob}
    />
  )
}
```

If the page directly renders AddJobSheet, update to:

```tsx
const [showAddJob, setShowAddJob] = useState(shouldOpenAddJob)
```

The key is that clicking sidebar "Add Job" navigates to /jobs?action=add, and the page reads this to auto-open the form.

IMPORTANT: After opening, the URL should be cleaned (remove ?action=add) to prevent re-opening on refresh:

```tsx
// In client component useEffect:
useEffect(() => {
  if (defaultAddJobOpen) {
    setShowAddJob(true)
    // Clean URL
    window.history.replaceState({}, '', '/jobs')
  }
}, [defaultAddJobOpen])
```
  </action>
  <verify>
- grep "action.*add" app/(dashboard)/jobs/page.tsx
- grep "defaultAddJobOpen" app/(dashboard)/jobs/page.tsx
  </verify>
  <done>Add Job sheet auto-opens when URL has action=add param</done>
</task>

<task type="auto">
  <name>Task 2: Update Send buttons to "Send Message"</name>
  <files>components/send/quick-send-tab.tsx, components/send/bulk-send-tab.tsx, components/history/request-detail-drawer.tsx</files>
  <action>
Search and replace "Send Request" with "Send Message" in all relevant components:

**quick-send-tab.tsx:**
- Find button text "Send Request" or similar
- Change to "Send Message"

**bulk-send-tab.tsx:**
- Find "Send Request" or "Send to X customers" buttons
- Change to "Send Message" or "Send Messages"

**request-detail-drawer.tsx:**
- Find "Send Request" or "Resend Request" buttons
- Change to "Send Message" or "Resend Message"
- Note: The drawer might be named "request-detail-drawer" but that's internal naming

Also check for any toast messages that say "Request sent" - change to "Message sent".

Search pattern: grep -r "Send Request" components/
Replace with: "Send Message"

Also check:
- "Resend Request" -> "Resend Message"
- "request sent" -> "message sent"
  </action>
  <verify>
- grep -r "Send Request" components/ should return nothing
- grep "Send Message" components/send/quick-send-tab.tsx
- grep "Send Message" components/send/bulk-send-tab.tsx
  </verify>
  <done>All "Send Request" buttons changed to "Send Message"</done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Clicking sidebar "Add Job" button navigates to /jobs and opens Add Job sheet
4. URL is cleaned to /jobs after sheet opens (no ?action=add persisting)
5. All Send buttons say "Send Message" not "Send Request"
6. Toast messages say "Message sent" not "Request sent"
</verification>

<success_criteria>
- Add Job sidebar button auto-opens the Add Job sheet
- URL param cleaned after opening to prevent re-trigger
- "Send Request" terminology replaced with "Send Message"
- No TypeScript or lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/30.1-audit-gaps/30.1-06-SUMMARY.md`
</output>
