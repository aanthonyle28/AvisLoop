---
phase: 40-dashboard-command-center
plan: 05
type: execute
wave: 4
depends_on: ["40-04"]
files_modified:
  - components/dashboard/mobile-bottom-sheet.tsx
  - components/dashboard/dashboard-client.tsx
  - components/dashboard/dashboard-shell.tsx
  - components/dashboard/right-panel-default.tsx
autonomous: true

must_haves:
  truths:
    - "On mobile (below lg breakpoint), right panel content renders as a bottom sheet triggered by tapping list items"
    - "Bottom sheet can be dismissed via X button and swipe-down gesture"
    - "Mobile shows compact KPI summary bar at top of dashboard (tappable to open full KPI view in bottom sheet)"
    - "Task lists are immediately visible on mobile without scrolling past KPI cards"
  artifacts:
    - path: "components/dashboard/mobile-bottom-sheet.tsx"
      provides: "Bottom sheet component for mobile right panel content"
      contains: "MobileBottomSheet"
  key_links:
    - from: "components/dashboard/dashboard-client.tsx"
      to: "components/dashboard/mobile-bottom-sheet.tsx"
      via: "renders MobileBottomSheet on mobile when panelView !== default or KPI tapped"
      pattern: "MobileBottomSheet"
---

<objective>
Implement mobile responsive experience with bottom sheet for right panel content and compact KPI summary bar.

Purpose: Mobile users can't see a side panel, so right panel content renders as a bottom sheet. KPIs shown as a compact tappable summary so task lists are immediately visible.
Output: Fully responsive dashboard that works on both desktop (two-column) and mobile (bottom sheet).
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/40-dashboard-command-center/40-CONTEXT.md
@.planning/phases/40-dashboard-command-center/40-02-SUMMARY.md
@.planning/phases/40-dashboard-command-center/40-04-SUMMARY.md

# Source files:
@components/dashboard/dashboard-shell.tsx
@components/dashboard/dashboard-client.tsx
@components/dashboard/right-panel-default.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile bottom sheet component</name>
  <files>components/dashboard/mobile-bottom-sheet.tsx</files>
  <action>
**Create `components/dashboard/mobile-bottom-sheet.tsx`:**

A 'use client' component that renders a bottom sheet overlay on mobile (DL-04):

Implementation approach: Use a fixed-position overlay with slide-up animation. This is a lightweight custom implementation (do NOT add a new dependency — use existing Radix Dialog or custom implementation with Tailwind).

**Option A (Recommended): Use existing Radix Dialog as base**
- Import Dialog from `@radix-ui/react-dialog` (already in dependencies)
- Render as a Dialog with custom styling to appear as bottom sheet
- Position: `fixed bottom-0 left-0 right-0`
- Background overlay: `bg-black/50` with fade animation
- Sheet: `bg-card rounded-t-xl` with slide-up animation
- Max height: `max-h-[85vh]` with `overflow-y-auto`

**Option B: Custom implementation with CSS transitions**
- Fixed position overlay
- CSS transition for slide up/down
- Touch event handler for swipe-down dismiss

Choose whichever approach is simpler and more robust. Claude's discretion.

Features:
1. **Open/close via props:** `open: boolean`, `onOpenChange: (open: boolean) => void`
2. **Close button:** X button in top-right of the sheet header
3. **Swipe-down dismiss:** Add a touch/pointer event handler on the sheet content area:
   - Track touchstart Y position
   - On touchmove, if deltaY > 100px downward, dismiss
   - Use `touch-action: pan-y` CSS for proper scrolling behavior
   - Alternative: just use the X button and overlay click — swipe is nice-to-have
4. **Title prop:** Optional title displayed in the sheet header (e.g., "Job Details", "Alert Details", "Dashboard Stats")
5. **Children:** Renders children in the scrollable content area
6. **Only on mobile:** This component only renders on screens below lg. The parent decides when to render it.

Animations:
- Sheet slides up from bottom: `translate-y-full → translate-y-0` with `transition-transform duration-300 ease-out`
- Overlay fades in: `opacity-0 → opacity-100` with `transition-opacity duration-200`

Export: `MobileBottomSheet`
  </action>
  <verify>Run `pnpm typecheck` — should pass. Run `pnpm lint` — should pass.</verify>
  <done>MobileBottomSheet component created with slide-up animation, X close button, and swipe-down dismiss gesture</done>
</task>

<task type="auto">
  <name>Task 2: Wire mobile bottom sheet and compact KPI summary into dashboard</name>
  <files>components/dashboard/dashboard-client.tsx, components/dashboard/dashboard-shell.tsx, components/dashboard/right-panel-default.tsx</files>
  <action>
**Add compact KPI summary bar to `components/dashboard/right-panel-default.tsx`:**

Export a new component `KPISummaryBar`:
- Renders on mobile only (`lg:hidden`)
- Single horizontal row: "X reviews · X.X avg · X% conv"
- All values from kpiData props
- Styled: `rounded-lg border bg-card px-4 py-3 text-sm`, values in `font-semibold`, dots in `text-muted-foreground`
- The entire bar is a button/clickable — `onClick` prop triggers opening full KPI view in bottom sheet
- Subtle right arrow icon to indicate tappability

**Modify `components/dashboard/dashboard-shell.tsx`:**

Add mobile awareness:
1. The right panel is already `hidden lg:flex` — it doesn't show on mobile. Good.
2. Add a prop or mechanism for the shell to know the current screen size. Use a simple approach:
   - The shell renders `children` (left column content) always
   - Mobile bottom sheet rendering is handled by the dashboard-client.tsx (the parent), not the shell
   - The shell doesn't need to change much — it just provides the layout structure

**Modify `components/dashboard/dashboard-client.tsx`:**

Wire mobile bottom sheet for right panel content:

1. Import MobileBottomSheet and KPISummaryBar
2. Track whether to show bottom sheet: `const [mobileSheetOpen, setMobileSheetOpen] = useState(false)`
3. When `panelView.type !== 'default'` on mobile, auto-open the bottom sheet
4. When bottom sheet closes, call `closePanel()` to reset to default view
5. Render MobileBottomSheet (only on mobile with `lg:hidden` wrapper):
   - When panelView is 'job-detail': render RightPanelJobDetail inside the sheet
   - When panelView is 'attention-detail': render RightPanelAttentionDetail inside the sheet
   - When KPI summary bar is tapped: open sheet with RightPanelDefault content (full KPI + activity view)
6. In the left column, before the task lists, render `<KPISummaryBar>` on mobile:
   - This gives mobile users a quick glance at KPIs without scrolling
   - Tapping it opens the full KPI/activity view in the bottom sheet
7. Use `useEffect` to detect panelView changes and open/close the mobile sheet accordingly
8. On desktop (lg+), the bottom sheet never renders (hidden)

Responsive behavior summary:
- **Desktop (lg+):** Two-column layout, right panel always visible, clicking items swaps panel content
- **Mobile (<lg):** Single column with compact KPI summary bar at top, task lists below. Tapping a job/alert opens bottom sheet with detail. Tapping KPI bar opens bottom sheet with full stats.
  </action>
  <verify>
Run `pnpm typecheck` — should pass.
Run `pnpm lint` — should pass.
Test on mobile viewport: KPI summary bar visible at top, task lists below, tapping a job opens bottom sheet with job detail, X button closes sheet.
Test on desktop: two-column layout unchanged, bottom sheet never appears.
  </verify>
  <done>
Mobile responsive complete (DL-04): bottom sheet renders right panel content on mobile. Compact KPI summary bar at top of mobile dashboard. Task lists immediately visible without scrolling past KPI cards.
  </done>
</task>

</tasks>

<verification>
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Desktop: two-column layout works as before, no bottom sheet visible
4. Mobile: KPI summary bar visible at top, task lists visible immediately below
5. Mobile: tapping a job item opens bottom sheet with job detail
6. Mobile: tapping an alert item opens bottom sheet with alert detail
7. Mobile: tapping KPI summary bar opens full KPI/activity view in bottom sheet
8. Bottom sheet dismissible via X button (and swipe-down if implemented)
</verification>

<success_criteria>
- DL-04: Right panel content renders as bottom sheet on mobile
- Mobile KPI summary bar is tappable to show full stats
- Task lists immediately visible on mobile (not hidden behind KPI scroll)
- All detail views work in bottom sheet (job detail, attention detail)
- Bottom sheet dismissal returns to default state
</success_criteria>

<output>
After completion, create `.planning/phases/40-dashboard-command-center/40-05-SUMMARY.md`
</output>
