---
phase: 46-drawer-consistency-campaign-freeze-fix
plan: 46-04
title: "Apply drawer consistency to Add Job, Edit Job, Add Customer, and Edit Customer sheets"
wave: 2
depends_on: [46-03]
files_modified:
  - components/jobs/add-job-sheet.tsx
  - components/jobs/edit-job-sheet.tsx
  - components/customers/add-customer-sheet.tsx
  - components/customers/edit-customer-sheet.tsx
autonomous: true
---

## Objective

Apply the drawer consistency pattern to the four form-based drawers: Add Job, Edit Job, Add Customer, and Edit Customer. Each drawer gets: (1) width normalized to `sm:max-w-lg`, (2) `SheetBody` for scrollable content, (3) `SheetFooter` for sticky action buttons, (4) `overflow-y-auto` removed from `SheetContent`, and (5) form wraps both body and footer so submit buttons work.

## Context

@components/ui/sheet.tsx (SheetBody, SheetFooter with shrink-0 — created in 46-03)
@components/jobs/add-job-sheet.tsx (full file — 325 lines, default width sm:max-w-sm, form with Cancel+Create buttons)
@components/jobs/edit-job-sheet.tsx (full file — 259 lines, default width sm:max-w-sm, form with Cancel+Save buttons)
@components/customers/add-customer-sheet.tsx (full file — 182 lines, custom width w-[400px] sm:w-[540px], form with Add+SaveAnother buttons)
@components/customers/edit-customer-sheet.tsx (full file — 212 lines, custom width w-[400px] sm:w-[540px], 2 Separators, form with Save button)
@.planning/phases/46-drawer-consistency-campaign-freeze-fix/46-RESEARCH.md (Patterns 1-5, Pitfall 5)

## Tasks

<task id="1">
Update `components/jobs/add-job-sheet.tsx`.

**Import change:** Add `SheetBody` and `SheetFooter` to the import from `@/components/ui/sheet`:
```typescript
import {
  Sheet,
  SheetContent,
  SheetBody,
  SheetFooter,
  SheetDescription,
  SheetHeader,
  SheetTitle,
} from '@/components/ui/sheet'
```

**Width change (line 169):**
Change `<SheetContent className="overflow-y-auto">` to `<SheetContent className="sm:max-w-lg">`.
Remove `overflow-y-auto` — scrolling is now handled by `SheetBody`.

**Structure change:** The `<form>` element must wrap BOTH the scrollable body AND the footer so the submit button stays inside the form. Restructure the content inside `SheetContent` as:

```tsx
<SheetHeader>
  <SheetTitle>Add Job</SheetTitle>
  <SheetDescription>...</SheetDescription>
</SheetHeader>

<form onSubmit={...} className="flex flex-col flex-1 min-h-0">
  <SheetBody>
    <div className="space-y-4">
      {/* ALL form fields go here — customer, service type, campaign, status, notes */}
    </div>
  </SheetBody>

  <SheetFooter>
    <div className="flex justify-end gap-2">
      <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
        Cancel
      </Button>
      <Button type="submit" disabled={isPending || !isCustomerValid || !serviceType}>
        {isPending && <CircleNotch className="mr-2 h-4 w-4 animate-spin" />}
        Create Job
      </Button>
    </div>
  </SheetFooter>
</form>
```

Key structural notes:
- The `<form>` gets `className="flex flex-col flex-1 min-h-0"` so it participates in the flex layout and allows SheetBody to scroll
- Remove the old `<div className="flex justify-end gap-2 pt-4">` wrapper around buttons (lines 308-320) — those buttons move into `<SheetFooter>`
- The form fields that were previously direct children of the `<form>` now go inside `<SheetBody><div className="space-y-4">...</div></SheetBody>`
- Loading skeleton content should also be inside `SheetBody`
</task>

<task id="2">
Update `components/jobs/edit-job-sheet.tsx`.

**Import change:** Add `SheetBody` and `SheetFooter` to the import.

**Width change (line 125):**
Change `<SheetContent className="overflow-y-auto">` to `<SheetContent className="sm:max-w-lg">`.

**Structure change:** Same pattern as Add Job. The `<form>` wraps both body and footer:

```tsx
<SheetHeader>
  <SheetTitle>Edit Job</SheetTitle>
  <SheetDescription>...</SheetDescription>
</SheetHeader>

<form onSubmit={...} className="flex flex-col flex-1 min-h-0">
  <SheetBody>
    <div className="space-y-4">
      {/* ALL form fields: customer selector, service type, campaign, status, notes, read-only info block */}
    </div>
  </SheetBody>

  <SheetFooter>
    <div className="flex justify-end gap-2">
      <Button type="button" variant="outline" onClick={() => onOpenChange(false)}>
        Cancel
      </Button>
      <Button type="submit" disabled={isPending || !customerId || !serviceType}>
        {isPending && <CircleNotch size={16} className="mr-2 animate-spin" />}
        Save Changes
      </Button>
    </div>
  </SheetFooter>
</form>
```

Remove the old `<div className="flex justify-end gap-2 pt-4">` wrapper (lines 242-254).
</task>

<task id="3">
Update `components/customers/add-customer-sheet.tsx`.

**Import change:** Add `SheetBody` and `SheetFooter` to the import.

**Width change (line 78):**
Change `<SheetContent side='right' className='w-[400px] sm:w-[540px] overflow-y-auto'>` to `<SheetContent side='right' className='sm:max-w-lg'>`.

**Structure change:** The `<form>` wraps both body and footer. The success message goes inside `SheetBody` above the form fields, but the form element must wrap both body and footer:

```tsx
<SheetHeader>
  <SheetTitle>Add New Customer</SheetTitle>
  <SheetDescription>...</SheetDescription>
</SheetHeader>

<form ref={formRef} action={formAction} noValidate className="flex flex-col flex-1 min-h-0">
  <SheetBody>
    <div className="space-y-4">
      {/* Success message (if any) */}
      {successMessage && (
        <div className='mb-4 flex items-center gap-2 rounded-md bg-success-bg p-3 text-sm text-success-foreground'>
          <CheckCircle size={16} />
          {successMessage}
        </div>
      )}
      {/* Form fields: name, email, phone, SMS consent, hidden fields, error */}
    </div>
  </SheetBody>

  <SheetFooter>
    <Button type='submit' className='w-full' disabled={isPending}>
      {isPending ? 'Adding...' : 'Add Customer'}
    </Button>
    <Button type='submit' variant='outline' className='w-full' disabled={isPending} onClick={() => setAddAnother(true)}>
      <Plus size={16} className='mr-2' />
      {isPending ? 'Adding...' : 'Save & Add Another'}
    </Button>
  </SheetFooter>
</form>
```

Remove the old `<div className='mt-6'>` wrapper (line 86) and the old `<div className='flex flex-col gap-2 pt-2'>` button wrapper (lines 162-176).
Note: `SheetFooter` already has `flex flex-col gap-2` so the buttons stack naturally.
</task>

<task id="4">
Update `components/customers/edit-customer-sheet.tsx`.

**Import change:** Add `SheetBody` and `SheetFooter` to the import. Remove `Separator` from imports since it will no longer be used.

**Width change (line 63):**
Change `<SheetContent side='right' className='w-[400px] sm:w-[540px] overflow-y-auto'>` to `<SheetContent side='right' className='sm:max-w-lg'>`.

**Structure change:** This drawer has a form section, an SMS consent section, and an activity section separated by `<Separator />` components. Remove the separators and restructure:

The form only wraps the editable fields and submit button. The SMS consent and activity sections are read-only content below the form.

```tsx
<SheetHeader>
  <SheetTitle>Edit Customer</SheetTitle>
  <SheetDescription>...</SheetDescription>
</SheetHeader>

<SheetBody>
  <div className="space-y-6">
    {/* Edit Form */}
    <form ref={formRef} action={formAction} className='space-y-4'>
      <input type='hidden' name='customerId' value={customer.id} />
      {/* Name, email, phone fields */}
      {state?.error && <p>...</p>}
      <Button type='submit' className='w-full' disabled={isPending}>
        {isPending ? 'Saving...' : 'Save Changes'}
      </Button>
    </form>

    {/* SMS Consent Status (no Separator before it) */}
    <div>
      <h3 className='font-medium mb-3'>SMS Consent</h3>
      {/* consent status display - same content as before */}
    </div>

    {/* Activity Summary (no Separator before it) */}
    <div>
      <h3 className='font-medium mb-4'>Activity</h3>
      {/* activity dl - same content as before */}
    </div>
  </div>
</SheetBody>
```

Key changes:
- Remove BOTH `<Separator />` components (line 132 and line 173)
- Remove the outer `<div className='mt-6 space-y-6'>` wrapper (line 71) — `SheetBody` now provides the scrollable container
- The `space-y-6` gap between form, SMS consent, and activity sections provides natural visual separation without Separator dividers
- The Save button stays inside the form (not in SheetFooter) since there are read-only sections below the form in the body. This is the correct pattern because the edit customer drawer's primary action area is within the scrollable content, not at a fixed footer position. The SheetFooter is not needed here — the content naturally fits.

**However**, if we want consistency with the other drawers' sticky footer pattern, an alternative is to use `form` id association:
- Give the form an `id="edit-customer-form"`
- Move the Save button to `<SheetFooter>` with `form="edit-customer-form"` attribute
- This keeps the Save button visible at all times

**Decision: Use the `form` attribute approach** for consistency:

```tsx
<SheetBody>
  <div className="space-y-6">
    <form ref={formRef} action={formAction} id="edit-customer-form" className='space-y-4'>
      <input type='hidden' name='customerId' value={customer.id} />
      {/* Name, email, phone fields + error */}
    </form>

    {/* SMS Consent Status */}
    <div>...</div>

    {/* Activity Summary */}
    <div>...</div>
  </div>
</SheetBody>

<SheetFooter>
  <Button type='submit' form='edit-customer-form' className='w-full' disabled={isPending}>
    {isPending ? 'Saving...' : 'Save Changes'}
  </Button>
</SheetFooter>
```

Remove the Save button from inside the form (line 127-129) and place it in SheetFooter with `form='edit-customer-form'`.
</task>

## Verification

After all tasks:

1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. All four drawers use `sm:max-w-lg` width (grep for `sm:max-w-sm` and `w-\[400px\]` should return 0 in these files)
4. None of these four files contain `overflow-y-auto` on `SheetContent`
5. All four drawers import and use `SheetBody` from sheet.tsx
6. Add Job, Edit Job, and Add Customer use `<SheetFooter>` with submit buttons
7. Edit Customer uses `SheetFooter` with `form` attribute for button association
8. No `<Separator />` imports remain in edit-customer-sheet.tsx
9. Form submit buttons are reachable (inside `<form>` or using `form="id"` attribute)

## must_haves

- [ ] All four drawers (Add Job, Edit Job, Add Customer, Edit Customer) use `sm:max-w-lg` width — no more `sm:max-w-sm` or custom `w-[400px] sm:w-[540px]`
- [ ] All four drawers use `SheetBody` for scrollable content and `SheetFooter` for sticky action buttons
- [ ] Edit Customer drawer has NO `<Separator />` components — sections separated by `space-y-6` gap only
- [ ] Form submissions work correctly — submit buttons are either inside `<form>` or use `form` attribute
- [ ] `pnpm typecheck` and `pnpm lint` pass
