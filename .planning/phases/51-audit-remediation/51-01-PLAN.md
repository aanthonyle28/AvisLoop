---
phase: 51-audit-remediation
plan: "01"
title: "Dashboard Fixes, Page Spacing Standardization, and Settings Dedup"
wave: 1
depends_on: []
files_modified:
  - components/dashboard/attention-alerts.tsx
  - components/dashboard/ready-to-send-queue.tsx
  - app/(dashboard)/settings/page.tsx
  - app/(dashboard)/history/page.tsx
  - app/(dashboard)/analytics/page.tsx
  - app/(dashboard)/jobs/page.tsx
  - app/(dashboard)/billing/page.tsx
  - app/(dashboard)/feedback/page.tsx
autonomous: true
findings: [F-10, F-12, F-13, F-11, F-15, F-CC-01, F-09]
---

# Plan 51-01: Dashboard Fixes, Page Spacing, and Settings Dedup

## Objective

Fix all dashboard skeleton and alert persistence issues (F-10, F-11, F-12, F-13), resolve the settings skeleton duplication (F-15), and standardize all 6 page content wrappers from `space-y-6` to `space-y-8` (F-CC-01/F-09). These are independent, low-risk fixes that eliminate design system violations and a layout-shift bug.

## Context

@docs/CODE-REVIEW-41-44.md — Findings F-10, F-11, F-12, F-13, F-15, F-CC-01, F-09
@components/dashboard/attention-alerts.tsx — Lines 200-202 (handleDismiss), Lines 253-276 (skeleton)
@components/dashboard/ready-to-send-queue.tsx — Lines 483-489 (empty state), Lines 839-873 (skeleton)
@app/(dashboard)/settings/page.tsx — Lines 19-39 (inline skeleton)
@app/(dashboard)/settings/loading.tsx — Route-level skeleton (keep this one)
@components/ui/skeleton.tsx — The `<Skeleton>` component to use

## Tasks

<task id="1">
### Task 1: Replace raw animate-pulse skeletons with Skeleton component (F-10, F-12) and fix empty state border (F-13)

**F-10 — attention-alerts.tsx `AttentionAlertsSkeleton` (lines 253-276):**
1. Add import: `import { Skeleton } from '@/components/ui/skeleton'` at the top of the file (it's not currently imported).
2. In `AttentionAlertsSkeleton()`, replace every `<div className="... bg-muted animate-pulse rounded..." />` with `<Skeleton className="..." />`. Preserve all sizing/layout classes (h-5, w-32, etc.) but drop `bg-muted`, `animate-pulse`, and `rounded` since `<Skeleton>` handles those internally (it applies `bg-muted/60 animate-pulse-soft rounded-md`). Keep structural classes like `shrink-0`, `flex-1`.

Specifically replace these raw divs:
- `<div className="h-5 w-32 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-5 w-32" />`
- `<div className="h-5 w-8 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-5 w-8" />`
- `<div className="size-5 bg-muted animate-pulse rounded-full shrink-0" />` → `<Skeleton className="size-5 rounded-full shrink-0" />`
- `<div className="h-4 w-48 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-4 w-48" />`
- `<div className="h-3 w-64 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-3 w-64" />`
- `<div className="h-8 w-20 bg-muted animate-pulse rounded shrink-0" />` → `<Skeleton className="h-8 w-20 shrink-0" />`

**F-12 — ready-to-send-queue.tsx `ReadyToSendQueueSkeleton` (lines 839-873):**
1. Verify `Skeleton` is already imported. If not, add the import.
2. In `ReadyToSendQueueSkeleton()`, replace every raw animate-pulse div with `<Skeleton>`. Same pattern as above:
- `<div className="h-5 w-32 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-5 w-32" />`
- `<div className="h-5 w-8 bg-muted animate-pulse rounded-full" />` → `<Skeleton className="h-5 w-8 rounded-full" />`
- `<div className="h-8 w-24 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-8 w-24" />`
- `<div className="h-5 w-5 bg-muted animate-pulse rounded-full mt-0.5" />` → `<Skeleton className="h-5 w-5 rounded-full mt-0.5" />`
- `<div className="h-4 w-40 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-4 w-40" />`
- `<div className="h-3 w-52 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-3 w-52" />`
- `<div className="h-8 w-20 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-8 w-20" />`
- `<div className="h-8 w-8 bg-muted animate-pulse rounded" />` → `<Skeleton className="h-8 w-8" />`

**F-13 — ready-to-send-queue.tsx "all caught up" empty state (lines 483-489):**
The "all caught up" empty state (when `jobs.length === 0 && hasJobHistory`) renders without a card border. The adjacent "no jobs yet" empty state uses `rounded-lg border border-border bg-card`. Add the same classes to the "all caught up" container for visual consistency.

Change:
```tsx
<div className="flex flex-col items-center justify-center py-8 text-center">
```
to:
```tsx
<div className="flex flex-col items-center justify-center py-8 text-center rounded-lg border border-border bg-card">
```
</task>

<task id="2">
### Task 2: Fix handleDismiss persistence (F-11), settings skeleton dedup (F-15), and page spacing (F-CC-01)

**F-11 — attention-alerts.tsx handleDismiss (lines 200-202):**
The `handleDismiss` function only updates local `dismissedIds` state but does NOT call `acknowledgeAlert` for persistent alert types. The overflow menu's "Acknowledge" button does call `acknowledgeAlert`. Fix by calling `acknowledgeAlert` in `handleDismiss` for persistent alert types.

1. Find the `handleDismiss` function (around line 200):
```tsx
const handleDismiss = (id: string) => {
  setDismissedIds(prev => new Set([...prev, id]))
}
```

2. Replace with logic that also calls acknowledgeAlert for persistent types. Look at how `acknowledgeAlert` is used in the overflow menu to understand the function signature. The alert's type determines if it should be server-persisted. The persistent types are `bounced_email` and `stop_request` — look at the alert type on the dismissed alert:
```tsx
const handleDismiss = (id: string) => {
  setDismissedIds(prev => new Set([...prev, id]))
  // Persist dismissal for persistent alert types so they don't reappear on navigation
  const alert = alerts.find(a => a.id === id)
  if (alert && (alert.type === 'bounced_email' || alert.type === 'stop_request')) {
    acknowledgeAlert?.(id)
  }
}
```

Check the props interface for `acknowledgeAlert` — it may be named differently. Look at the `AttentionAlertsProps` interface and the overflow menu's Acknowledge handler to find the correct prop name and call convention. If the function is already available as a prop, call it. If not, add it to the props interface and thread it from the parent.

**F-15 — settings/page.tsx skeleton duplication:**
Delete the `SettingsLoadingSkeleton` function definition (lines 18-39) from `app/(dashboard)/settings/page.tsx`. Import the `SettingsLoading` component from `./loading` instead and use it as the Suspense fallback.

1. Remove lines 18-39 (the `SettingsLoadingSkeleton` function) from settings/page.tsx
2. Add import: `import SettingsLoading from './loading'`
3. Change the Suspense fallback from `<SettingsLoadingSkeleton />` to `<SettingsLoading />`
4. Remove the `Skeleton` import from page.tsx if it becomes unused after this change

**F-CC-01/F-09 — Page spacing standardization (5 files — customers/page.tsx handled by Plan 02):**
Change `space-y-6` to `space-y-8` in the container wrapper of 5 page files. The 6th file (customers/page.tsx) is handled by Plan 02 which also modifies it for F-16. This eliminates the layout shift between loading skeleton (`space-y-8`) and rendered content (`space-y-6`).

Files and exact changes:
- `app/(dashboard)/history/page.tsx` line 47: `container py-6 space-y-6` → `container py-6 space-y-8`
- `app/(dashboard)/analytics/page.tsx` line 21: `container py-6 space-y-6` → `container py-6 space-y-8`
- `app/(dashboard)/jobs/page.tsx` line 37: `container py-6 space-y-6` → `container py-6 space-y-8`
- `app/(dashboard)/billing/page.tsx` line 65: `container max-w-4xl py-6 space-y-6` → `container max-w-4xl py-6 space-y-8`
- `app/(dashboard)/feedback/page.tsx` line 41: `container max-w-4xl py-6 space-y-6` → `container max-w-4xl py-6 space-y-8`

Note: `app/(dashboard)/customers/page.tsx` spacing change is in Plan 02 to avoid file conflict.
</task>

## Verification

```bash
pnpm lint && pnpm typecheck
```

Both must pass with zero errors.

**Manual checks:**
- Grep for `animate-pulse` in attention-alerts.tsx — should only appear in non-skeleton code (e.g., button spinners), not in `AttentionAlertsSkeleton`
- Grep for `animate-pulse` in `ReadyToSendQueueSkeleton` — should find zero occurrences
- Grep for `space-y-6` in all 5 page files (history, analytics, jobs, billing, feedback) — should find zero occurrences (all now `space-y-8`). Customers/page.tsx is handled by Plan 02.
- Grep for `SettingsLoadingSkeleton` in settings/page.tsx — should find zero occurrences (function removed)

## must_haves

- [ ] AttentionAlertsSkeleton uses only `<Skeleton>` component, no raw animate-pulse divs (F-10)
- [ ] ReadyToSendQueueSkeleton uses only `<Skeleton>` component, no raw animate-pulse divs (F-12)
- [ ] "All caught up" empty state in ReadyToSendQueue has border matching "no jobs yet" state (F-13)
- [ ] handleDismiss in attention-alerts.tsx calls acknowledgeAlert for bounced_email and stop_request types (F-11)
- [ ] Settings page has ONE skeleton definition (loading.tsx), not two (F-15)
- [ ] All 5 page files in this plan use `space-y-8` instead of `space-y-6`; customers/page.tsx handled by Plan 02 (F-CC-01/F-09)
- [ ] `pnpm lint` passes with zero errors
- [ ] `pnpm typecheck` passes with zero errors
