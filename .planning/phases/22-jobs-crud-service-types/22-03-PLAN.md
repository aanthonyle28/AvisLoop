---
phase: 22-jobs-crud-service-types
plan: 03
type: execute
wave: 3
depends_on: ["22-01", "22-02", "22-04"]
files_modified:
  - app/(dashboard)/jobs/page.tsx
  - app/(dashboard)/jobs/loading.tsx
  - components/jobs/jobs-client.tsx
  - components/jobs/job-columns.tsx
  - components/jobs/job-table.tsx
  - components/jobs/job-filters.tsx
  - components/jobs/empty-state.tsx
autonomous: true

must_haves:
  truths:
    - "User can view /jobs page with list of all jobs"
    - "Job list shows customer name, service type, status, completion date"
    - "User can filter jobs by status and service type"
    - "Empty state shown when no jobs exist"
  artifacts:
    - path: "app/(dashboard)/jobs/page.tsx"
      provides: "Jobs page server component"
      contains: "export default function JobsPage"
    - path: "components/jobs/jobs-client.tsx"
      provides: "Jobs page client wrapper"
      contains: "JobsClient"
    - path: "components/jobs/job-columns.tsx"
      provides: "TanStack Table column definitions"
      exports: ["columns"]
    - path: "components/jobs/job-table.tsx"
      provides: "Data table component"
      contains: "JobTable"
  key_links:
    - from: "app/(dashboard)/jobs/page.tsx"
      to: "lib/data/jobs.ts"
      via: "getJobs import"
      pattern: "import.*getJobs.*from.*data/jobs"
    - from: "app/(dashboard)/jobs/page.tsx"
      to: "lib/actions/customer.ts"
      via: "getCustomers import"
      pattern: "import.*getCustomers.*from.*actions/customer"
      note: "Established codebase pattern: getCustomers lives in lib/actions/customer.ts (not lib/data/). This differs from jobs (lib/data/jobs.ts) - legacy pattern vs new pattern."
    - from: "components/jobs/jobs-client.tsx"
      to: "components/jobs/job-table.tsx"
      via: "JobTable import"
      pattern: "import.*JobTable"
    - from: "components/jobs/jobs-client.tsx"
      to: "components/jobs/add-job-sheet.tsx"
      via: "AddJobSheet import (from Plan 04)"
      pattern: "import.*AddJobSheet"
---

<objective>
Create Jobs UI page with list view, table, and filters following existing customers page patterns.

Purpose: Users need to see all their jobs in one place with the ability to filter by status and service type. This is the main jobs management interface.

Output: Jobs page with data table, column definitions, filters, and empty state.
</objective>

<execution_context>
@C:\Users\aanth\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\aanth\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/22-jobs-crud-service-types/22-RESEARCH.md
@.planning/phases/22-jobs-crud-service-types/22-04-SUMMARY.md
@app/(dashboard)/customers/page.tsx
@components/customers/customers-client.tsx
@components/customers/customer-columns.tsx
@components/customers/customer-table.tsx
@components/customers/customer-filters.tsx
@components/customers/empty-state.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create jobs page and loading state</name>
  <files>app/(dashboard)/jobs/page.tsx, app/(dashboard)/jobs/loading.tsx</files>
  <action>
Create app/(dashboard)/jobs/page.tsx following customers page pattern:

```typescript
import { Suspense } from 'react'
import { getJobs } from '@/lib/data/jobs'
import { getCustomers } from '@/lib/actions/customer'
import { JobsClient } from '@/components/jobs/jobs-client'

export const metadata = {
  title: 'Jobs',
  description: 'Manage your service jobs',
}

async function JobsContent() {
  const [{ jobs, total }, { customers }] = await Promise.all([
    getJobs(),
    getCustomers({ limit: 200 }), // For customer selector in add/edit forms
  ])
  return <JobsClient initialJobs={jobs} totalJobs={total} customers={customers} />
}

export default function JobsPage() {
  return (
    <div className="container py-6">
      <Suspense fallback={
        <div className="flex items-center justify-center py-16">
          <div className="text-center">
            <div className="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]" />
            <p className="mt-4 text-muted-foreground">Loading jobs...</p>
          </div>
        </div>
      }>
        <JobsContent />
      </Suspense>
    </div>
  )
}
```

Note: getCustomers is imported from lib/actions/customer (established codebase pattern) while getJobs is imported from lib/data/jobs (new pattern). This is intentional - we follow existing patterns for existing modules.

Create app/(dashboard)/jobs/loading.tsx:

```typescript
export default function JobsLoading() {
  return (
    <div className="container py-6">
      <div className="flex items-center justify-center py-16">
        <div className="text-center">
          <div className="inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]" />
          <p className="mt-4 text-muted-foreground">Loading jobs...</p>
        </div>
      </div>
    </div>
  )
}
```
  </action>
  <verify>Navigate to /jobs - page loads without errors. Shows loading spinner during suspense.</verify>
  <done>Jobs page exists at /jobs with server component fetching jobs and customers, wrapped in Suspense.</done>
</task>

<task type="auto">
  <name>Task 2: Create jobs client wrapper and table components</name>
  <files>components/jobs/jobs-client.tsx, components/jobs/job-table.tsx, components/jobs/job-columns.tsx</files>
  <action>
Create components/jobs/jobs-client.tsx:

```typescript
'use client'

import { useState } from 'react'
import { Plus } from '@phosphor-icons/react'
import { Button } from '@/components/ui/button'
import { JobTable } from './job-table'
import { JobFilters, type JobFiltersState } from './job-filters'
import { EmptyState } from './empty-state'
import { AddJobSheet } from './add-job-sheet'
import type { JobWithCustomer, Customer } from '@/lib/types/database'

interface JobsClientProps {
  initialJobs: JobWithCustomer[]
  totalJobs: number
  customers: Customer[]
}

export function JobsClient({ initialJobs, totalJobs, customers }: JobsClientProps) {
  const [filters, setFilters] = useState<JobFiltersState>({
    status: null,
    serviceType: null,
    search: '',
  })
  const [showAddSheet, setShowAddSheet] = useState(false)

  // Filter jobs client-side (for initial load, server-side filtering for large datasets)
  const filteredJobs = initialJobs.filter(job => {
    if (filters.status && job.status !== filters.status) return false
    if (filters.serviceType && job.service_type !== filters.serviceType) return false
    if (filters.search) {
      const query = filters.search.toLowerCase()
      const customerName = job.customers?.name?.toLowerCase() || ''
      const customerEmail = job.customers?.email?.toLowerCase() || ''
      if (!customerName.includes(query) && !customerEmail.includes(query)) return false
    }
    return true
  })

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-semibold tracking-tight">Jobs</h1>
          <p className="text-muted-foreground">
            {totalJobs} {totalJobs === 1 ? 'job' : 'jobs'} total
          </p>
        </div>
        <Button onClick={() => setShowAddSheet(true)}>
          <Plus className="mr-2 h-4 w-4" weight="bold" />
          Add Job
        </Button>
      </div>

      {/* Filters */}
      <JobFilters filters={filters} onFiltersChange={setFilters} />

      {/* Table or Empty State */}
      {filteredJobs.length === 0 ? (
        <EmptyState
          hasFilters={!!(filters.status || filters.serviceType || filters.search)}
          onClearFilters={() => setFilters({ status: null, serviceType: null, search: '' })}
          onAddJob={() => setShowAddSheet(true)}
        />
      ) : (
        <JobTable jobs={filteredJobs} customers={customers} />
      )}

      {/* Add Job Sheet */}
      <AddJobSheet
        open={showAddSheet}
        onOpenChange={setShowAddSheet}
        customers={customers}
      />
    </div>
  )
}
```

Create components/jobs/job-table.tsx:

```typescript
'use client'

import { useState } from 'react'
import {
  useReactTable,
  getCoreRowModel,
  getSortedRowModel,
  type SortingState,
} from '@tanstack/react-table'
import { columns } from './job-columns'
import type { JobWithCustomer, Customer } from '@/lib/types/database'
import { EditJobSheet } from './edit-job-sheet'

interface JobTableProps {
  jobs: JobWithCustomer[]
  customers: Customer[]
}

export function JobTable({ jobs, customers }: JobTableProps) {
  const [sorting, setSorting] = useState<SortingState>([])
  const [selectedJob, setSelectedJob] = useState<JobWithCustomer | null>(null)
  const [showEditSheet, setShowEditSheet] = useState(false)

  const table = useReactTable({
    data: jobs,
    columns: columns({ onEdit: (job) => { setSelectedJob(job); setShowEditSheet(true) } }),
    getCoreRowModel: getCoreRowModel(),
    getSortedRowModel: getSortedRowModel(),
    onSortingChange: setSorting,
    state: { sorting },
  })

  return (
    <>
      <div className="rounded-md border border-border">
        <table className="w-full">
          <thead className="bg-muted/50">
            {table.getHeaderGroups().map(headerGroup => (
              <tr key={headerGroup.id}>
                {headerGroup.headers.map(header => (
                  <th
                    key={header.id}
                    className="h-10 px-4 text-left align-middle font-medium text-muted-foreground"
                  >
                    {header.isPlaceholder
                      ? null
                      : typeof header.column.columnDef.header === 'function'
                        ? header.column.columnDef.header(header.getContext())
                        : header.column.columnDef.header}
                  </th>
                ))}
              </tr>
            ))}
          </thead>
          <tbody>
            {table.getRowModel().rows.map(row => (
              <tr
                key={row.id}
                className="border-t border-border transition-colors hover:bg-muted/50"
              >
                {row.getVisibleCells().map(cell => (
                  <td key={cell.id} className="p-4">
                    {typeof cell.column.columnDef.cell === 'function'
                      ? cell.column.columnDef.cell(cell.getContext())
                      : cell.getValue() as string}
                  </td>
                ))}
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* Edit Job Sheet */}
      {selectedJob && (
        <EditJobSheet
          open={showEditSheet}
          onOpenChange={setShowEditSheet}
          job={selectedJob}
          customers={customers}
        />
      )}
    </>
  )
}
```

Create components/jobs/job-columns.tsx:

```typescript
'use client'

import { type ColumnDef } from '@tanstack/react-table'
import { format } from 'date-fns'
import { PencilSimple, Trash } from '@phosphor-icons/react'
import { Button } from '@/components/ui/button'
import { StatusBadge } from '@/components/ui/status-badge'
import { SERVICE_TYPE_LABELS } from '@/lib/validations/job'
import { deleteJob } from '@/lib/actions/job'
import { toast } from 'sonner'
import type { JobWithCustomer } from '@/lib/types/database'

interface ColumnsOptions {
  onEdit: (job: JobWithCustomer) => void
}

export function columns({ onEdit }: ColumnsOptions): ColumnDef<JobWithCustomer>[] {
  return [
    {
      accessorKey: 'customers.name',
      header: 'Customer',
      cell: ({ row }) => {
        const customer = row.original.customers
        return (
          <div>
            <div className="font-medium">{customer?.name || 'Unknown'}</div>
            <div className="text-sm text-muted-foreground">{customer?.email || ''}</div>
          </div>
        )
      },
    },
    {
      accessorKey: 'service_type',
      header: 'Service Type',
      cell: ({ row }) => {
        const serviceType = row.original.service_type
        return (
          <span className="inline-flex items-center rounded-md bg-muted px-2 py-1 text-xs font-medium">
            {SERVICE_TYPE_LABELS[serviceType] || serviceType}
          </span>
        )
      },
    },
    {
      accessorKey: 'status',
      header: 'Status',
      cell: ({ row }) => {
        const status = row.original.status
        return (
          <StatusBadge
            status={status === 'completed' ? 'completed' : 'do_not_send'}
            label={status === 'completed' ? 'Completed' : 'Do Not Send'}
          />
        )
      },
    },
    {
      accessorKey: 'completed_at',
      header: 'Completed',
      cell: ({ row }) => {
        const completedAt = row.original.completed_at
        if (!completedAt) return <span className="text-muted-foreground">-</span>
        return format(new Date(completedAt), 'MMM d, yyyy')
      },
    },
    {
      accessorKey: 'created_at',
      header: 'Created',
      cell: ({ row }) => format(new Date(row.original.created_at), 'MMM d, yyyy'),
    },
    {
      id: 'actions',
      header: '',
      cell: ({ row }) => {
        const job = row.original

        const handleDelete = async () => {
          if (!confirm('Are you sure you want to delete this job?')) return
          const result = await deleteJob(job.id)
          if (result.error) {
            toast.error(result.error)
          } else {
            toast.success('Job deleted')
          }
        }

        return (
          <div className="flex items-center gap-2">
            <Button
              variant="ghost"
              size="icon"
              onClick={() => onEdit(job)}
              className="h-8 w-8"
            >
              <PencilSimple className="h-4 w-4" />
              <span className="sr-only">Edit</span>
            </Button>
            <Button
              variant="ghost"
              size="icon"
              onClick={handleDelete}
              className="h-8 w-8 text-destructive hover:text-destructive"
            >
              <Trash className="h-4 w-4" />
              <span className="sr-only">Delete</span>
            </Button>
          </div>
        )
      },
    },
  ]
}
```
  </action>
  <verify>Navigate to /jobs - table renders with columns. Clicking edit opens sheet. Delete prompts confirmation.</verify>
  <done>Jobs table component exists with customer, service type, status, dates, and actions columns. Edit and delete actions work.</done>
</task>

<task type="auto">
  <name>Task 3: Create job filters and empty state</name>
  <files>components/jobs/job-filters.tsx, components/jobs/empty-state.tsx</files>
  <action>
Create components/jobs/job-filters.tsx:

```typescript
'use client'

import { MagnifyingGlass, X } from '@phosphor-icons/react'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { SERVICE_TYPES, SERVICE_TYPE_LABELS, JOB_STATUSES, JOB_STATUS_LABELS } from '@/lib/validations/job'
import type { ServiceType, JobStatus } from '@/lib/types/database'

export interface JobFiltersState {
  status: JobStatus | null
  serviceType: ServiceType | null
  search: string
}

interface JobFiltersProps {
  filters: JobFiltersState
  onFiltersChange: (filters: JobFiltersState) => void
}

export function JobFilters({ filters, onFiltersChange }: JobFiltersProps) {
  const hasActiveFilters = filters.status || filters.serviceType || filters.search

  return (
    <div className="space-y-4">
      {/* Search */}
      <div className="relative">
        <MagnifyingGlass className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
        <Input
          placeholder="Search by customer name or email..."
          value={filters.search}
          onChange={(e) => onFiltersChange({ ...filters, search: e.target.value })}
          className="pl-9"
        />
      </div>

      {/* Filter chips */}
      <div className="flex flex-wrap gap-2">
        {/* Status filters */}
        {JOB_STATUSES.map(status => (
          <button
            key={status}
            onClick={() => onFiltersChange({
              ...filters,
              status: filters.status === status ? null : status,
            })}
            className={`inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-colors ${
              filters.status === status
                ? 'bg-primary text-primary-foreground'
                : 'bg-muted text-muted-foreground hover:bg-muted/80'
            }`}
          >
            {JOB_STATUS_LABELS[status]}
          </button>
        ))}

        {/* Separator */}
        <div className="w-px bg-border" />

        {/* Service type filters */}
        {SERVICE_TYPES.map(type => (
          <button
            key={type}
            onClick={() => onFiltersChange({
              ...filters,
              serviceType: filters.serviceType === type ? null : type,
            })}
            className={`inline-flex items-center rounded-full px-3 py-1 text-sm font-medium transition-colors ${
              filters.serviceType === type
                ? 'bg-primary text-primary-foreground'
                : 'bg-muted text-muted-foreground hover:bg-muted/80'
            }`}
          >
            {SERVICE_TYPE_LABELS[type]}
          </button>
        ))}

        {/* Clear filters */}
        {hasActiveFilters && (
          <Button
            variant="ghost"
            size="sm"
            onClick={() => onFiltersChange({ status: null, serviceType: null, search: '' })}
            className="h-7 px-2 text-muted-foreground"
          >
            <X className="mr-1 h-3 w-3" />
            Clear
          </Button>
        )}
      </div>
    </div>
  )
}
```

Create components/jobs/empty-state.tsx:

```typescript
'use client'

import { Briefcase, Plus, FunnelSimple } from '@phosphor-icons/react'
import { Button } from '@/components/ui/button'

interface EmptyStateProps {
  hasFilters: boolean
  onClearFilters: () => void
  onAddJob: () => void
}

export function EmptyState({ hasFilters, onClearFilters, onAddJob }: EmptyStateProps) {
  if (hasFilters) {
    return (
      <div className="flex flex-col items-center justify-center rounded-lg border border-dashed border-border py-16">
        <FunnelSimple className="h-12 w-12 text-muted-foreground" />
        <h3 className="mt-4 text-lg font-medium">No jobs match your filters</h3>
        <p className="mt-1 text-sm text-muted-foreground">
          Try adjusting your filters or clear them to see all jobs.
        </p>
        <Button variant="outline" className="mt-4" onClick={onClearFilters}>
          Clear Filters
        </Button>
      </div>
    )
  }

  return (
    <div className="flex flex-col items-center justify-center rounded-lg border border-dashed border-border py-16">
      <Briefcase className="h-12 w-12 text-muted-foreground" />
      <h3 className="mt-4 text-lg font-medium">No jobs yet</h3>
      <p className="mt-1 text-sm text-muted-foreground">
        Create your first job to start tracking completed work.
      </p>
      <Button className="mt-4" onClick={onAddJob}>
        <Plus className="mr-2 h-4 w-4" weight="bold" />
        Add Job
      </Button>
    </div>
  )
}
```
  </action>
  <verify>Filter chips render and toggle correctly. Empty state shows when no jobs or filters active.</verify>
  <done>Job filters component with status and service type chips, search input, and clear button. Empty state with filter-aware messaging.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Navigate to /jobs - page loads with table or empty state
2. Filter chips toggle on/off correctly
3. Search filters by customer name/email
4. Edit button opens sheet (sheet from Plan 04)
5. Delete button prompts and removes job
6. `pnpm lint` and `pnpm typecheck` pass
</verification>

<success_criteria>
- /jobs page exists and loads with Suspense
- Jobs table shows customer name, service type, status, completion date, created date
- Filter chips for status (completed, do_not_send) work
- Filter chips for all 8 service types work
- Search input filters by customer name/email
- Empty state shown when no jobs or filters match
- Delete action removes job with toast feedback
- `pnpm typecheck` passes
</success_criteria>

<output>
After completion, create `.planning/phases/22-jobs-crud-service-types/22-03-SUMMARY.md`
</output>
