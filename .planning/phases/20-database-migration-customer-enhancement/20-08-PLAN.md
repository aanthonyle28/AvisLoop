---
phase: 20-database-migration-customer-enhancement
plan: 08
type: execute
wave: 4
depends_on: ["20-01", "20-02", "20-03", "20-04", "20-05", "20-06", "20-07"]
files_modified: []
autonomous: false
user_setup:
  - service: twilio
    why: "SMS sending requires A2P 10DLC registration for US carriers"
    env_vars:
      - name: TWILIO_ACCOUNT_SID
        source: "Twilio Console -> Account Info"
      - name: TWILIO_AUTH_TOKEN
        source: "Twilio Console -> Account Info"
    dashboard_config:
      - task: "Register A2P 10DLC Brand"
        location: "Twilio Console -> Messaging -> Trust Hub -> Brand Registrations"
      - task: "Register A2P 10DLC Campaign"
        location: "Twilio Console -> Messaging -> Trust Hub -> Campaigns"

must_haves:
  truths:
    - "Twilio A2P 10DLC brand registration approved"
    - "Twilio A2P 10DLC campaign registration approved"
    - "TWILIO_ACCOUNT_SID environment variable configured"
    - "TWILIO_AUTH_TOKEN environment variable configured"
  artifacts: []
  key_links: []
---

<objective>
Verify Twilio A2P 10DLC registration is complete before Phase 21 starts. This is a critical path blocker - SMS features cannot be built until registration is approved by TCR.

Purpose: SMS-02 - A2P 10DLC brand and campaign registration (pre-development blocker)
Output: Confirmation that Twilio registration is approved and ready for SMS development
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-database-migration-customer-enhancement/20-CONTEXT.md
@.planning/phases/20-database-migration-customer-enhancement/20-RESEARCH.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <what>Twilio A2P 10DLC Brand Registration</what>
  <why>
US carriers require A2P 10DLC registration for business-to-person SMS. Without this approval, SMS messages will be blocked or heavily filtered. Registration takes 3-7 days and must be completed before Phase 21 can start.
  </why>
  <action>
1. **If not already done:** Create Twilio account at twilio.com

2. **Register A2P 10DLC Brand:**
   - Go to Twilio Console -> Messaging -> Trust Hub -> Brand Registrations
   - Click "Create Brand Registration"
   - Fill in business details:
     - Legal business name
     - Business type (Sole Proprietor, Private, etc.)
     - EIN/Tax ID (or SSN for sole proprietor)
     - Business address
     - Business industry (Professional Services)
     - Business website
   - Submit and wait for approval (usually 2-5 business days)

3. **Register A2P 10DLC Campaign:**
   - After brand approval, go to Campaigns
   - Click "Create Campaign"
   - Campaign details:
     - Use case: "Marketing" or "Customer Care"
     - Description: "Review request follow-ups for completed home service jobs"
     - Sample messages: Include actual message examples
     - Opt-in workflow: Describe how customers consent to SMS
     - Opt-out keywords: STOP, STOPALL, UNSUBSCRIBE, CANCEL, END, QUIT
   - Submit and wait for approval (usually 1-3 business days)

4. **Verify approval in Twilio Console:**
   - Brand status: "Approved" or "Verified"
   - Campaign status: "Approved"
   - Both must be approved before proceeding

5. **Get Twilio credentials:**
   - Go to Twilio Console -> Account Info
   - Copy Account SID and Auth Token
   - Add to .env.local:
     ```
     TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     ```
  </action>
  <resume-signal>
Type "A2P approved" when both brand and campaign registrations are approved in Twilio Console, and TWILIO_ACCOUNT_SID + TWILIO_AUTH_TOKEN are added to .env.local.

If registration is still pending, type "A2P pending - X days" and Phase 21 will be blocked until approval.
  </resume-signal>
</task>

<task type="auto">
  <name>Task 2: Document A2P registration status</name>
  <files>docs/SMS_COMPLIANCE.md</files>
  <action>
Create docs/SMS_COMPLIANCE.md to document Twilio setup and compliance status:

```markdown
# SMS Compliance Documentation

## A2P 10DLC Registration

**Status:** [PENDING / APPROVED]
**Brand Registration ID:** [from Twilio Console]
**Campaign ID:** [from Twilio Console]
**Approval Date:** [date]

### Registration Details

**Business Information:**
- Legal Name: [business name]
- EIN/Tax ID: [redacted]
- Industry: Professional Services

**Campaign Details:**
- Use Case: Customer Care / Marketing
- Description: Review request follow-ups for completed home service jobs
- Opt-in: Checkbox consent during customer creation or job completion
- Opt-out: STOP keyword handling with automatic database update

### Supported Opt-Out Keywords
- STOP
- STOPALL
- UNSUBSCRIBE
- CANCEL
- END
- QUIT

Per TCPA Jan 2026 rules, informal opt-out messages ("Leave me alone", "Don't text me") must also be honored.

## TCPA Compliance

### Consent Requirements
- Individual consent only (no bulk consent capture)
- Consent captured via checkbox with clear disclosure
- Audit trail stored: status, timestamp, method, IP, captured_by
- 4-year retention for audit trail

### Consent Fields (customers table)
| Field | Purpose |
|-------|---------|
| sms_consent_status | opted_in / opted_out / unknown |
| sms_consent_at | Timestamp of consent |
| sms_consent_source | How consent was captured |
| sms_consent_method | verbal_in_person, phone_call, etc. |
| sms_consent_notes | Additional context |
| sms_consent_ip | Client IP at consent time |
| sms_consent_captured_by | User ID who recorded consent |

### Quiet Hours
- Default: 8am-9pm customer local time
- Uses customer.timezone field (IANA format)
- Messages outside window are queued for next available time

## Twilio Configuration

**Environment Variables:**
- TWILIO_ACCOUNT_SID: Set in .env.local
- TWILIO_AUTH_TOKEN: Set in .env.local (never commit)
- TWILIO_PHONE_NUMBER: [to be configured in Phase 21]

**Webhook Endpoints (Phase 21):**
- /api/webhooks/twilio/inbound - Handles STOP keywords
- /api/webhooks/twilio/status - Delivery status updates
```

Update the status section based on user's response in Task 1.
  </action>
  <verify>docs/SMS_COMPLIANCE.md exists with A2P registration status documented</verify>
  <done>SMS compliance documentation created with registration status and TCPA requirements</done>
</task>

</tasks>

<verification>
1. Twilio A2P 10DLC brand approved (verified by user)
2. Twilio A2P 10DLC campaign approved (verified by user)
3. TWILIO_ACCOUNT_SID in .env.local
4. TWILIO_AUTH_TOKEN in .env.local
5. docs/SMS_COMPLIANCE.md documents registration status
</verification>

<success_criteria>
- [ ] User confirms A2P 10DLC brand registration approved
- [ ] User confirms A2P 10DLC campaign registration approved
- [ ] TWILIO_ACCOUNT_SID added to .env.local
- [ ] TWILIO_AUTH_TOKEN added to .env.local
- [ ] docs/SMS_COMPLIANCE.md created with registration status
- [ ] Phase 21 unblocked for SMS implementation
</success_criteria>

<output>
After completion, create `.planning/phases/20-database-migration-customer-enhancement/20-08-SUMMARY.md`
</output>
