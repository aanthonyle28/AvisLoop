---
phase: 07-onboarding-flow
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - components/onboarding/onboarding-progress.tsx
  - components/onboarding/onboarding-wizard.tsx
  - app/(dashboard)/onboarding/page.tsx
autonomous: true

must_haves:
  truths:
    - "Wizard shows step progress indicator (step X of Y)"
    - "User can navigate between wizard steps via URL"
    - "Wizard redirects to dashboard if onboarding already complete"
    - "Draft data persists in localStorage across page refreshes"
  artifacts:
    - path: "components/onboarding/onboarding-progress.tsx"
      provides: "Visual progress indicator component"
      exports: ["OnboardingProgress"]
    - path: "components/onboarding/onboarding-wizard.tsx"
      provides: "Wizard shell with step navigation"
      exports: ["OnboardingWizard"]
    - path: "app/(dashboard)/onboarding/page.tsx"
      provides: "Onboarding page route"
  key_links:
    - from: "app/(dashboard)/onboarding/page.tsx"
      to: "lib/data/onboarding.ts"
      via: "getOnboardingStatus import"
      pattern: "getOnboardingStatus"
    - from: "components/onboarding/onboarding-wizard.tsx"
      to: "next/navigation"
      via: "router.push for step navigation"
      pattern: "useRouter|router\\.push"
    - from: "components/onboarding/onboarding-wizard.tsx"
      to: "localStorage"
      via: "draft persistence"
      pattern: "localStorage\\."
---

<objective>
Create the onboarding wizard shell with progress indicator and step navigation.

Purpose: Provide the visual framework for the multi-step onboarding experience with URL-based navigation and draft persistence.

Output: Progress indicator component, wizard shell component, and onboarding page route.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-onboarding-flow/07-RESEARCH.md
@.planning/phases/07-onboarding-flow/07-01-SUMMARY.md

Key patterns:
- URL searchParams for step state (see history page pattern)
- lucide-react for icons (CheckCircle, Circle)
- cn() from lib/utils for conditional classes
- Dialog pattern used elsewhere but wizard uses page-based UI
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create progress indicator component</name>
  <files>components/onboarding/onboarding-progress.tsx</files>
  <action>
Create visual step progress indicator:

```typescript
// components/onboarding/onboarding-progress.tsx
import { CheckCircle, Circle } from 'lucide-react'
import { cn } from '@/lib/utils'

export function OnboardingProgress({
  currentStep,
  totalSteps,
  stepTitles
}: {
  currentStep: number
  totalSteps: number
  stepTitles: string[]
})
```

Implementation:
1. Render horizontal stepper with:
   - Step circles (numbered or checkmark if completed)
   - Connecting lines between steps
   - Step titles below circles

2. Visual states:
   - Completed (step < currentStep): CheckCircle icon, primary color, filled line
   - Current (step === currentStep): Circle with number, primary border
   - Pending (step > currentStep): Circle with number, muted color, muted line

3. Responsive: On mobile (< md), show compact "Step X of Y" text instead of full stepper

Pattern: See 07-RESEARCH.md Pattern 1 progress indicator code example.
  </action>
  <verify>
File exists at components/onboarding/onboarding-progress.tsx
Exports OnboardingProgress
`pnpm typecheck` passes
  </verify>
  <done>Progress indicator shows visual step state with completed/current/pending styles</done>
</task>

<task type="auto">
  <name>Task 2: Create wizard shell component</name>
  <files>components/onboarding/onboarding-wizard.tsx</files>
  <action>
Create the wizard shell that manages step navigation and draft persistence:

```typescript
// components/onboarding/onboarding-wizard.tsx
'use client'

import { useState, useEffect, ReactNode } from 'react'
import { useRouter } from 'next/navigation'
import { OnboardingProgress } from './onboarding-progress'
import { markOnboardingComplete } from '@/lib/actions/onboarding'

type StepConfig = {
  id: number
  title: string
  skippable: boolean
}

const STEPS: StepConfig[] = [
  { id: 1, title: 'Business Info', skippable: false },
  { id: 2, title: 'Add Contact', skippable: true },
  { id: 3, title: 'Send Request', skippable: false },
]

export function OnboardingWizard({
  initialStep,
  children,
}: {
  initialStep: number
  children: (props: {
    draftData: Record<string, any>;
    setDraftData: (key: string, value: any) => void;
    goToNext: () => void;
    goToStep: (step: number) => void;
    handleComplete: () => Promise<void>;
  }) => ReactNode
})
```

Implementation:
1. State management:
   - currentStep from URL (initialStep prop)
   - draftData loaded from localStorage('onboarding-draft') on mount
   - isSubmitting to prevent navigation during saves

2. Navigation functions exposed to children via render prop:
   - goToStep(step: number) - updates URL with router.push, respects isSubmitting
   - goToNext() - convenience wrapper: goToStep(currentStep + 1)
   - handleComplete() - clears localStorage, calls markOnboardingComplete

   These functions map directly to step component callbacks:
   - Step's onComplete -> goToNext() for steps 1-2, handleComplete() for step 3
   - Step's onSkip -> goToNext()

3. LocalStorage persistence:
   - Load on mount with useEffect
   - Save on draftData change
   - Clear on completion

4. Render:
   - OnboardingProgress at top
   - Children render function receives draftData and setDraftData
   - Skip button (conditionally shown for skippable steps)
   - Step N of N indicator

Pattern: See 07-RESEARCH.md Pattern 1 OnboardingWizard code.
  </action>
  <verify>
File exists at components/onboarding/onboarding-wizard.tsx
Exports OnboardingWizard
`pnpm typecheck` passes
  </verify>
  <done>Wizard manages step navigation, localStorage persistence, and renders progress indicator</done>
</task>

<task type="auto">
  <name>Task 3: Create onboarding page route</name>
  <files>app/(dashboard)/onboarding/page.tsx</files>
  <action>
Create the onboarding page as a Server Component that wraps the wizard:

```typescript
// app/(dashboard)/onboarding/page.tsx
import { redirect } from 'next/navigation'
import { createClient } from '@/lib/supabase/server'
import { getOnboardingStatus } from '@/lib/data/onboarding'
import { OnboardingWizard } from '@/components/onboarding/onboarding-wizard'
// Step components will be imported in 07-03

export default async function OnboardingPage({
  searchParams,
}: {
  searchParams: Promise<{ step?: string }>
})
```

Implementation:
1. Auth check - redirect to /login if not authenticated
2. Get onboarding status from getOnboardingStatus()
3. If onboarding already complete (status.completed), redirect to /dashboard
4. Parse step from searchParams (default to 1)
5. Validate step is 1-3, clamp if out of range
6. Fetch any data needed for steps (business info)
7. Render OnboardingWizard with initialStep

Note: This task creates the page shell WITHOUT step content. The OnboardingWizard children
will be a minimal div placeholder. Task 07-04 Task 4 will wire up the actual step components
after they're created in 07-03. This avoids duplicate work.

```tsx
<OnboardingWizard initialStep={currentStep}>
  {({ goToNext, handleComplete }) => (
    <div className="p-6">
      {/* Step components wired in 07-04 Task 4 */}
    </div>
  )}
</OnboardingWizard>
```
  </action>
  <verify>
File exists at app/(dashboard)/onboarding/page.tsx
`pnpm typecheck` passes
`pnpm lint` passes
  </verify>
  <done>Onboarding page route exists with wizard shell, redirects if complete</done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Visit /onboarding?step=1 shows progress indicator
4. Visit /onboarding?step=2 shows step 2 active in progress
5. Progress indicator visually distinguishes completed/current/pending states
</verification>

<success_criteria>
- Progress indicator shows "Step X of Y" with visual states (ONBD-02)
- Wizard shell manages navigation and localStorage persistence
- Onboarding page route redirects to dashboard if already complete
- URL-based step navigation works (?step=1, ?step=2, ?step=3)
</success_criteria>

<output>
After completion, create `.planning/phases/07-onboarding-flow/07-02-SUMMARY.md`
</output>
