---
phase: 07-onboarding-flow
plan: 04
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03"]
files_modified:
  - components/dashboard/onboarding-checklist.tsx
  - components/dashboard/next-action-card.tsx
  - app/dashboard/page.tsx
  - app/(dashboard)/onboarding/page.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard shows onboarding checklist until all steps complete"
    - "Dashboard shows next best action recommendation"
    - "Checklist items link to appropriate pages to complete"
    - "Checklist auto-hides when all items are complete"
    - "New users see clear path to get started"
  artifacts:
    - path: "components/dashboard/onboarding-checklist.tsx"
      provides: "Persistent checklist widget"
      exports: ["OnboardingChecklist"]
    - path: "components/dashboard/next-action-card.tsx"
      provides: "Next best action recommendation"
      exports: ["NextActionCard"]
    - path: "app/dashboard/page.tsx"
      provides: "Dashboard page with checklist integration"
  key_links:
    - from: "app/dashboard/page.tsx"
      to: "lib/data/onboarding.ts"
      via: "getOnboardingStatus import"
      pattern: "getOnboardingStatus"
    - from: "app/dashboard/page.tsx"
      to: "lib/actions/business.ts"
      via: "getBusiness import"
      pattern: "getBusiness"
    - from: "components/dashboard/onboarding-checklist.tsx"
      to: "next/link"
      via: "Link to completion pages"
      pattern: "Link.*href"
    - from: "app/(dashboard)/onboarding/page.tsx"
      to: "components/onboarding/steps/*"
      via: "step component imports"
      pattern: "BusinessStep|ContactStep|SendStep"
    - from: "app/(dashboard)/onboarding/page.tsx"
      to: "components/onboarding/onboarding-wizard.tsx"
      via: "wizard callback -> step prop wiring"
      pattern: "onComplete.*goToNext|onComplete.*handleComplete"
---

<objective>
Create dashboard components showing onboarding progress and integrate step components into the wizard.

Purpose: Provide persistent guidance on dashboard until user completes setup, and wire up the complete onboarding wizard flow.

Output: OnboardingChecklist, NextActionCard, updated dashboard page, and complete onboarding page integration.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-onboarding-flow/07-RESEARCH.md
@.planning/phases/07-onboarding-flow/07-01-SUMMARY.md
@.planning/phases/07-onboarding-flow/07-02-SUMMARY.md
@.planning/phases/07-onboarding-flow/07-03-SUMMARY.md

Key patterns:
- Server Component data fetching (see billing/page.tsx)
- Card UI pattern (see billing components)
- Link from next/link for navigation
- lucide-react icons (CheckCircle2, Circle, ChevronRight, Settings, Users, Send)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding checklist component</name>
  <files>components/dashboard/onboarding-checklist.tsx</files>
  <action>
Create persistent checklist widget for dashboard:

```typescript
// components/dashboard/onboarding-checklist.tsx
import { CheckCircle2, Circle, ChevronRight } from 'lucide-react'
import Link from 'next/link'
import { cn } from '@/lib/utils'
import type { OnboardingStatus } from '@/lib/data/onboarding'

type ChecklistItem = {
  id: string
  title: string
  description: string
  href: string
  completed: boolean
}

export function OnboardingChecklist({ status }: { status: OnboardingStatus })
```

Implementation:
1. Build checklist items from status.steps:
   - "Set up business profile" -> /dashboard/settings (hasBusinessProfile)
   - "Add Google review link" -> /dashboard/settings (hasReviewLink)
   - "Add your first contact" -> /contacts (hasContacts)
   - "Send your first review request" -> /send (hasSentMessage)

2. Calculate progress:
   - completedCount = items.filter(i => i.completed).length
   - Progress bar shows percentage complete

3. Don't render if all complete (return null)

4. Visual design:
   - Card with "Get Started" header
   - Progress bar at top
   - Checklist items with icons
   - Completed items: green checkmark, muted text, line-through
   - Pending items: empty circle, clickable link
   - Each item shows ChevronRight on hover

5. "Quick Setup" CTA button below items linking to /onboarding?step=1

Pattern: See 07-RESEARCH.md Pattern 3 OnboardingChecklist code.
  </action>
  <verify>
File exists at components/dashboard/onboarding-checklist.tsx
Exports OnboardingChecklist
`pnpm typecheck` passes
  </verify>
  <done>Checklist shows progress and links to complete each step (ONBD-06)</done>
</task>

<task type="auto">
  <name>Task 2: Create next action card component</name>
  <files>components/dashboard/next-action-card.tsx</files>
  <action>
Create smart recommendation card:

```typescript
// components/dashboard/next-action-card.tsx
import { ArrowRight, Settings, Users, Send, History } from 'lucide-react'
import Link from 'next/link'
import { Button } from '@/components/ui/button'
import type { OnboardingStatus } from '@/lib/data/onboarding'

export function NextActionCard({ status }: { status: OnboardingStatus })
```

Implementation:
1. Determine next action based on status.steps:
   - !hasReviewLink: "Add your review link" -> /dashboard/settings
   - !hasContacts: "Add your first contact" -> /contacts
   - !hasSentMessage: "Send your first request" -> /send
   - All complete: "View your sent messages" -> /history

2. Action card shows:
   - Icon in colored background
   - Title and description
   - CTA button with arrow

3. Variant styling:
   - Incomplete onboarding: Primary button, prominent styling
   - Complete onboarding: Secondary button, subtler styling

Pattern: See 07-RESEARCH.md Pattern 5 NextActionCard code.
  </action>
  <verify>
File exists at components/dashboard/next-action-card.tsx
Exports NextActionCard
`pnpm typecheck` passes
  </verify>
  <done>Next action shows context-aware recommendation (ONBD-04)</done>
</task>

<task type="auto">
  <name>Task 3: Update dashboard page with onboarding integration</name>
  <files>app/dashboard/page.tsx</files>
  <action>
Replace the redirect placeholder with a real dashboard page:

```typescript
// app/dashboard/page.tsx
import { createClient } from '@/lib/supabase/server'
import { redirect } from 'next/navigation'
import { getOnboardingStatus } from '@/lib/data/onboarding'
import { OnboardingChecklist } from '@/components/dashboard/onboarding-checklist'
import { NextActionCard } from '@/components/dashboard/next-action-card'
import { getBusiness } from '@/lib/actions/business'
import { getMonthlyUsage } from '@/lib/data/send-logs'

export default async function DashboardPage()
```

Implementation:
1. Auth check - redirect to /login if not authenticated
2. Fetch data:
   - getOnboardingStatus() for checklist
   - getBusiness() for business info
   - getMonthlyUsage() for usage stats

3. Layout (two-column on desktop):
   - Left column (main):
     - Welcome message ("Welcome, {businessName}" or "Welcome to AvisLoop")
     - NextActionCard with current recommendation
     - Quick stats cards (sends this month, contacts count)
   - Right column (sidebar):
     - OnboardingChecklist (if not complete)
     - Usage summary card

4. Handle case where no business exists:
   - Show "Complete your setup" prompt
   - Link to /onboarding?step=1

5. Handle onboarding=complete searchParam:
   - Show success toast/banner on redirect from completed onboarding

Remove the redirect to /protected - this is now the real dashboard.
  </action>
  <verify>
`pnpm typecheck` passes
`pnpm lint` passes
Dashboard page renders without redirect
  </verify>
  <done>Dashboard shows checklist and next action based on onboarding status</done>
</task>

<task type="auto">
  <name>Task 4: Complete onboarding page integration</name>
  <files>app/(dashboard)/onboarding/page.tsx</files>
  <action>
Update onboarding page to wire up all step components:

```typescript
// app/(dashboard)/onboarding/page.tsx
import { BusinessStep } from '@/components/onboarding/steps/business-step'
import { ContactStep } from '@/components/onboarding/steps/contact-step'
import { SendStep } from '@/components/onboarding/steps/send-step'
// ... other imports from 07-02
```

Implementation:
1. Fetch all data needed for steps:
   - business (for BusinessStep defaults and SendStep)
   - contacts (for SendStep contact selection)
   - templates (for SendStep template)

2. Update OnboardingWizard children to render actual step components.
   This is the CRITICAL navigation wiring - mapping wizard callbacks to step props:

   ```tsx
   <OnboardingWizard initialStep={currentStep}>
     {({ draftData, setDraftData, goToNext, goToStep, handleComplete }) => {
       switch (currentStep) {
         case 1:
           // BusinessStep.onComplete -> goToNext (advances to step 2)
           return <BusinessStep onComplete={goToNext} defaultValues={business} />
         case 2:
           // ContactStep.onComplete -> goToNext (advances to step 3)
           // ContactStep.onSkip -> goToNext (advances to step 3)
           // Note: businessId NOT needed - createContact derives from session
           return <ContactStep onComplete={goToNext} onSkip={goToNext} />
         case 3:
           // SendStep.onComplete -> handleComplete (marks complete, redirects to dashboard)
           return <SendStep contact={firstContact} business={business} template={defaultTemplate} onComplete={handleComplete} />
       }
     }}
   </OnboardingWizard>
   ```

3. Pass appropriate data to each step:
   - BusinessStep: existing business name/google_review_link from database
   - ContactStep: no businessId needed (server action derives from session)
   - SendStep: first contact (if exists), business data, default template
  </action>
  <verify>
`pnpm typecheck` passes
`pnpm lint` passes
Onboarding page imports and renders all step components
  </verify>
  <done>Onboarding wizard fully wired with all step components</done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. Dashboard shows onboarding checklist if incomplete
4. Dashboard shows next action recommendation
5. Onboarding wizard flows through all 3 steps
6. Completing onboarding hides checklist on dashboard
</verification>

<success_criteria>
- Dashboard shows checklist until all steps complete (ONBD-06)
- Dashboard shows "next best action" recommendation (ONBD-04)
- Checklist items link to appropriate completion pages
- Onboarding wizard fully functional with all step components (ONBD-01)
- New user sees guided setup experience after signup
</success_criteria>

<output>
After completion, create `.planning/phases/07-onboarding-flow/07-04-SUMMARY.md`
</output>
