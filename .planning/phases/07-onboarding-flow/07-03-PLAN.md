---
phase: 07-onboarding-flow
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - components/onboarding/steps/business-step.tsx
  - components/onboarding/steps/contact-step.tsx
  - components/onboarding/steps/send-step.tsx
autonomous: true

must_haves:
  truths:
    - "Business step captures business name and optional review link"
    - "Contact step allows adding first contact"
    - "Send step shows send preview and confirms first request"
    - "Each step validates input before allowing continuation"
    - "Steps can be skipped where appropriate (contact step)"
  artifacts:
    - path: "components/onboarding/steps/business-step.tsx"
      provides: "Business info capture form"
      exports: ["BusinessStep"]
    - path: "components/onboarding/steps/contact-step.tsx"
      provides: "First contact capture form"
      exports: ["ContactStep"]
    - path: "components/onboarding/steps/send-step.tsx"
      provides: "First send confirmation"
      exports: ["SendStep"]
  key_links:
    - from: "components/onboarding/steps/business-step.tsx"
      to: "lib/actions/business.ts"
      via: "updateBusiness server action"
      pattern: "updateBusiness"
    - from: "components/onboarding/steps/contact-step.tsx"
      to: "lib/actions/contact.ts"
      via: "createContact server action"
      pattern: "createContact"
    - from: "components/onboarding/steps/send-step.tsx"
      to: "lib/actions/send.ts"
      via: "sendReviewRequest server action"
      pattern: "sendReviewRequest"
---

<objective>
Create the three wizard step form components for the onboarding flow.

Purpose: Guide users through setting up their business profile, adding their first contact, and sending their first review request - the core "aha moment" journey.

Output: BusinessStep, ContactStep, and SendStep components with validation and server action integration.
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-onboarding-flow/07-RESEARCH.md
@.planning/phases/07-onboarding-flow/07-01-SUMMARY.md

Key patterns:
- React Hook Form + Zod for form validation (see contacts/add-contact-sheet.tsx)
- useActionState for server action integration
- Input, Button from components/ui/*
- updateBusiness from lib/actions/business.ts
- createContact from lib/actions/contact.ts
- sendReviewRequest from lib/actions/send.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create business step component</name>
  <files>components/onboarding/steps/business-step.tsx</files>
  <action>
Create the first onboarding step for business info:

```typescript
// components/onboarding/steps/business-step.tsx
'use client'

import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { updateBusiness, BusinessActionState } from '@/lib/actions/business'
import { useActionState } from 'react'

const businessStepSchema = z.object({
  name: z.string().min(1, 'Business name is required').max(100),
  google_review_link: z.string().url('Must be a valid URL').optional().or(z.literal('')),
})

type BusinessStepData = z.infer<typeof businessStepSchema>

export function BusinessStep({
  onComplete,
  onSkip,
  defaultValues,
}: {
  onComplete: () => void
  onSkip?: () => void
  defaultValues?: { name?: string; google_review_link?: string }
})
```

Implementation:
1. React Hook Form with businessStepSchema
2. Pre-fill from defaultValues (existing business data)
3. On submit:
   - Call updateBusiness server action
   - If success, call onComplete()
   - Show field errors from action response
4. Show helpful guidance text:
   - "Your business name will appear in review request emails"
   - "Add your Google review link so customers know where to leave reviews"
5. Google review link is optional with "Add later" hint
6. Continue button at bottom

Field layout:
- Business Name (required) with placeholder "Acme Coffee Shop"
- Google Review Link (optional) with helper text explaining where to find it

Pattern: See 07-RESEARCH.md Pattern 2 for form structure.
  </action>
  <verify>
File exists at components/onboarding/steps/business-step.tsx
Exports BusinessStep
`pnpm typecheck` passes
  </verify>
  <done>Business step validates and saves business name + optional review link</done>
</task>

<task type="auto">
  <name>Task 2: Create contact step component</name>
  <files>components/onboarding/steps/contact-step.tsx</files>
  <action>
Create the second onboarding step for adding first contact:

```typescript
// components/onboarding/steps/contact-step.tsx
'use client'

import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'
import { z } from 'zod'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { createContact, ContactActionState } from '@/lib/actions/contact'
import { useActionState } from 'react'

const contactStepSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100),
  email: z.string().email('Valid email required'),
  phone: z.string().max(20).optional().or(z.literal('')),
})

type ContactStepData = z.infer<typeof contactStepSchema>

export function ContactStep({
  onComplete,
  onSkip,
  businessId,
}: {
  onComplete: () => void
  onSkip: () => void
  businessId: string
})
```

Implementation:
1. React Hook Form with contactStepSchema
2. On submit:
   - Call createContact server action
   - If success, call onComplete()
   - Show field errors from action response
3. Show skip option since contact is optional at onboarding
4. Helpful text: "Add a customer you'd like to request a review from"

Field layout:
- Name (required) with placeholder "John Smith"
- Email (required) with placeholder "john@example.com"
- Phone (optional) with placeholder "(555) 123-4567"

Skip button: "Skip for now - I'll add contacts later"
  </action>
  <verify>
File exists at components/onboarding/steps/contact-step.tsx
Exports ContactStep
`pnpm typecheck` passes
  </verify>
  <done>Contact step creates contact or allows skip (ONBD-03)</done>
</task>

<task type="auto">
  <name>Task 3: Create send step component</name>
  <files>components/onboarding/steps/send-step.tsx</files>
  <action>
Create the third onboarding step for sending first review request:

```typescript
// components/onboarding/steps/send-step.tsx
'use client'

import { useState, useTransition } from 'react'
import { Button } from '@/components/ui/button'
import { sendReviewRequest } from '@/lib/actions/send'
import { markOnboardingComplete } from '@/lib/actions/onboarding'
import { useRouter } from 'next/navigation'
import { CheckCircle, Mail } from 'lucide-react'

export function SendStep({
  contact,
  business,
  template,
  onComplete,
}: {
  contact?: { id: string; name: string; email: string } | null
  business: { name: string; google_review_link: string | null }
  template?: { id: string; subject: string; body: string } | null
  onComplete: () => void
})
```

Implementation:
1. Show different states:
   - No contact: Show "Add a contact first" with link back to step 2
   - No review link: Show "Add review link first" with link back to step 1
   - Ready: Show send preview and confirmation

2. When ready to send:
   - Show preview card with:
     - Contact name and email
     - Template subject (or default)
     - "This is what your customer will receive" preview
   - "Send First Review Request" button

3. On send:
   - Call sendReviewRequest with contact.id and template.id
   - If success, show success state with confetti/check icon
   - Call markOnboardingComplete()
   - After 2 seconds, redirect to /dashboard with onComplete()

4. Success state:
   - CheckCircle icon in green
   - "Your first review request has been sent!"
   - "Taking you to your dashboard..."

5. Skip option: "Skip - I'll send my first request later"
   - Calls markOnboardingComplete() then redirects to dashboard
  </action>
  <verify>
File exists at components/onboarding/steps/send-step.tsx
Exports SendStep
`pnpm typecheck` passes
`pnpm lint` passes
  </verify>
  <done>Send step shows preview, sends request, and completes onboarding</done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm typecheck` passes
2. `pnpm lint` passes
3. BusinessStep form validates and calls updateBusiness
4. ContactStep form validates and calls createContact (or skips)
5. SendStep shows appropriate state based on data availability
</verification>

<success_criteria>
- Business step captures name (required) and review link (optional) (ONBD-05 defaults)
- Contact step creates contact or allows skip (ONBD-03)
- Send step shows preview and sends first request
- Each step validates before proceeding
- Skipping works where appropriate
</success_criteria>

<output>
After completion, create `.planning/phases/07-onboarding-flow/07-03-SUMMARY.md`
</output>
