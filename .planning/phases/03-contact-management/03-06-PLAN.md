---
phase: 03-contact-management
plan: 06
type: execute
wave: 3
depends_on: ["03-03", "03-04", "03-05"]
files_modified:
  - app/(dashboard)/contacts/page.tsx
  - components/contacts/contacts-client.tsx
  - components/contacts/empty-state.tsx
autonomous: false

must_haves:
  truths:
    - "Contacts page displays at /dashboard/contacts"
    - "Empty state shows when no contacts exist"
    - "All components are wired together correctly"
    - "Actions (add, edit, archive, delete) work end-to-end"
  artifacts:
    - path: "app/(dashboard)/contacts/page.tsx"
      provides: "Server Component for contacts page"
      contains: "getContacts"
    - path: "components/contacts/contacts-client.tsx"
      provides: "Client wrapper for all contact components"
      contains: "ContactTable"
    - path: "components/contacts/empty-state.tsx"
      provides: "Empty state component"
      contains: "empty"
  key_links:
    - from: "page.tsx"
      to: "getContacts"
      via: "Server Component data fetch"
      pattern: "getContacts\\(\\)"
    - from: "contacts-client.tsx"
      to: "contact-table.tsx"
      via: "import ContactTable"
      pattern: "ContactTable"
    - from: "contacts-client.tsx"
      to: "archiveContact Server Action"
      via: "action callback"
      pattern: "archiveContact"
---

<objective>
Create contacts page with Server Component data loading, wire all components together, and add empty state.

Purpose: Complete working contacts page with full CRUD functionality
Output: Functional /dashboard/contacts page with all features integrated
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-contact-management/03-CONTEXT.md
@app/(dashboard)/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create empty state component</name>
  <files>components/contacts/empty-state.tsx</files>
  <action>
Create empty state component for when no contacts exist.

```typescript
import { Button } from '@/components/ui/button'
import { Users, Upload } from 'lucide-react'

interface ContactsEmptyStateProps {
  onAddContact: () => void
  onImportCSV: () => void
}
```

**Design (Claude's discretion per CONTEXT.md):**
- Centered layout
- Users icon (large, muted color)
- "No contacts yet" heading
- Helpful description: "Add your first contact to start sending review requests"
- Two action buttons:
  - Primary: "Add Contact" (triggers onAddContact)
  - Secondary/outline: "Import from CSV" (triggers onImportCSV)
- Clean, minimal design matching shadcn/ui aesthetic
  </action>
  <verify>`npx tsc --noEmit` passes, component exports ContactsEmptyState</verify>
  <done>Empty state shows helpful message with add/import actions</done>
</task>

<task type="auto">
  <name>Task 2: Create client wrapper component</name>
  <files>components/contacts/contacts-client.tsx</files>
  <action>
Create client component that wires all contact components together.

```typescript
'use client'

import { useState, useTransition } from 'react'
import { ContactTable } from './contact-table'
import { AddContactDialog } from './add-contact-dialog'
import { EditContactSheet } from './edit-contact-sheet'
import { CSVImportDialog } from './csv-import-dialog'
import { ContactsEmptyState } from './empty-state'
import { Button } from '@/components/ui/button'
import { Plus, Upload } from 'lucide-react'
import {
  archiveContact,
  restoreContact,
  deleteContact,
  bulkArchiveContacts,
  bulkDeleteContacts,
} from '@/lib/actions/contact'
import type { Contact } from '@/lib/types/database'
```

**Props:**
```typescript
interface ContactsClientProps {
  initialContacts: Contact[]
}
```

**State:**
- editingContact: Contact | null (for edit sheet)
- editSheetOpen: boolean
- addDialogOpen: boolean
- importDialogOpen: boolean
- isPending from useTransition (for action feedback)

**Layout:**
```
Header Row:
  - "Contacts" heading (h1)
  - Button group: [Import CSV] [Add Contact]

Content:
  - If no contacts: ContactsEmptyState
  - If has contacts: ContactTable

EditContactSheet (controlled by editingContact state)
```

**Action handlers:**
- handleEdit: Set editingContact and open sheet
- handleArchive: Call archiveContact action (wrap in startTransition)
- handleRestore: Call restoreContact action
- handleDelete: Call deleteContact action (maybe show confirmation?)
- handleBulkArchive: Call bulkArchiveContacts
- handleBulkDelete: Call bulkDeleteContacts

**Pass handlers to ContactTable:**
```typescript
<ContactTable
  data={initialContacts}
  onEdit={handleEdit}
  onArchive={handleArchive}
  onRestore={handleRestore}
  onDelete={handleDelete}
  onBulkArchive={handleBulkArchive}
  onBulkDelete={handleBulkDelete}
/>
```

**Dialog/Sheet triggers:**
- AddContactDialog has its own trigger
- CSVImportDialog has its own trigger
- EditContactSheet controlled externally
  </action>
  <verify>`npx tsc --noEmit` passes, component exports ContactsClient</verify>
  <done>Client component wires all components with proper state and actions</done>
</task>

<task type="auto">
  <name>Task 3: Create contacts page</name>
  <files>app/(dashboard)/contacts/page.tsx</files>
  <action>
Create Server Component page for /dashboard/contacts.

```typescript
import { getContacts } from '@/lib/actions/contact'
import { ContactsClient } from '@/components/contacts/contacts-client'

export default async function ContactsPage() {
  const contacts = await getContacts()

  return (
    <div className="container py-6">
      <ContactsClient initialContacts={contacts} />
    </div>
  )
}
```

**Metadata:**
```typescript
export const metadata = {
  title: 'Contacts | AvisLoop',
  description: 'Manage your customer contacts',
}
```

**Layout considerations:**
- Use container class for max-width and horizontal padding
- py-6 for vertical spacing
- Consistent with other dashboard pages
  </action>
  <verify>`pnpm build` succeeds, page accessible at /dashboard/contacts</verify>
  <done>Contacts page loads data and renders all components</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Contact Management system:
- Database schema with RLS (migration ready to apply)
- Server Actions for all CRUD operations
- DataTable with sorting, filtering, selection
- Add Contact dialog
- Edit Contact sheet with activity summary
- CSV import with preview and duplicate detection
- Empty state for new users
- Full page at /dashboard/contacts
  </what-built>
  <how-to-verify>
1. Start dev server: `pnpm dev`
2. Navigate to http://localhost:3000/dashboard/contacts
3. Verify empty state shows (if no contacts)
4. Click "Add Contact" - verify dialog opens
5. Add a contact (name + email required, phone optional)
6. Verify contact appears in table
7. Click row actions dropdown - verify Edit/Archive/Delete options
8. Click Edit - verify sheet slides from right with form + activity summary
9. Edit and save - verify changes persist
10. Test Archive/Restore functionality
11. Select multiple rows - verify bulk action bar appears
12. Test CSV import:
    - Create test.csv with: name,email,phone columns and 3-5 rows
    - Click "Import from CSV"
    - Drop or select the CSV file
    - Verify preview shows with validation status
    - Import and verify contacts appear in table
13. Test search - type in search bar, verify filtering works
14. Test status filter chips (All/Active/Archived)
15. Check for TypeScript errors: `pnpm typecheck`
16. Check for lint errors: `pnpm lint`

**Note:** Migration 00003 must be applied to Supabase SQL Editor first!
  </how-to-verify>
  <resume-signal>Type "approved" if all features work, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm build` - Full build succeeds
2. `pnpm typecheck` - No TypeScript errors
3. `pnpm lint` - No lint errors
4. Page accessible at /dashboard/contacts
5. All CRUD operations work end-to-end
</verification>

<success_criteria>
- [ ] Page loads at /dashboard/contacts
- [ ] Empty state shows when no contacts
- [ ] Add Contact dialog creates contacts
- [ ] Edit Contact sheet updates contacts
- [ ] Archive/Restore toggles contact status
- [ ] Delete removes contacts
- [ ] Bulk actions work on selected rows
- [ ] CSV import flow works end-to-end
- [ ] Search filters contacts
- [ ] Status filter chips work
- [ ] TypeScript compiles
- [ ] Lint passes
</success_criteria>

<output>
After completion, create `.planning/phases/03-contact-management/03-06-SUMMARY.md`
</output>
