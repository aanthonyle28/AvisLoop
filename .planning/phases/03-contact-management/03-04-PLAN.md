---
phase: 03-contact-management
plan: 04
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - components/contacts/add-contact-dialog.tsx
  - components/contacts/edit-contact-sheet.tsx
autonomous: true

must_haves:
  truths:
    - "Modal dialog opens for adding new contacts"
    - "Slide-out sheet opens for editing contacts"
    - "Forms validate required fields before submit"
    - "Dialog closes automatically on success"
  artifacts:
    - path: "components/contacts/add-contact-dialog.tsx"
      provides: "Modal dialog for adding contacts"
      contains: "Dialog"
    - path: "components/contacts/edit-contact-sheet.tsx"
      provides: "Slide-out panel for editing"
      contains: "Sheet"
  key_links:
    - from: "add-contact-dialog.tsx"
      to: "createContact Server Action"
      via: "useActionState"
      pattern: "useActionState"
    - from: "edit-contact-sheet.tsx"
      to: "updateContact Server Action"
      via: "useActionState"
      pattern: "useActionState"
---

<objective>
Create Add Contact dialog and Edit Contact sheet components with forms wired to Server Actions.

Purpose: UI for creating and editing individual contacts
Output: Dialog for add, Sheet for edit with activity summary
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-contact-management/03-RESEARCH.md
@.planning/phases/03-contact-management/03-CONTEXT.md
@lib/actions/business.ts
@app/(dashboard)/settings/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Add Contact dialog</name>
  <files>components/contacts/add-contact-dialog.tsx</files>
  <action>
Create modal dialog for adding new contacts.

**First, add shadcn/ui Dialog if not present:**
```bash
npx shadcn@latest add dialog
```

**Component structure:**
```typescript
'use client'

import { useState, useActionState } from 'react'
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
  DialogDescription,
} from '@/components/ui/dialog'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Plus } from 'lucide-react'
import { createContact, type ContactActionState } from '@/lib/actions/contact'
```

**Props:**
- trigger?: React.ReactNode (optional custom trigger button)

**State:**
- open: boolean (dialog open state)
- useActionState for form submission

**Form fields:**
- Name (required) - Input with label, error display
- Email (required) - Input type="email" with label, error display
- Phone (optional) - Input type="tel" with label

**Behavior:**
- Close dialog on successful submit (check result.success)
- Reset form on close
- Show per-field errors from fieldErrors
- Show general error from error
- Disable submit button while pending (isPending)
- Submit button text: "Add Contact" / "Adding..."

**Pattern from RESEARCH.md:**
```typescript
const [state, formAction, isPending] = useActionState<ContactActionState | null, FormData>(
  async (prevState, formData) => {
    const result = await createContact(prevState, formData)
    if (result.success) {
      setOpen(false)
    }
    return result
  },
  null
)
```
  </action>
  <verify>`npx tsc --noEmit` passes, component exports AddContactDialog</verify>
  <done>Dialog opens, validates, creates contact, closes on success</done>
</task>

<task type="auto">
  <name>Task 2: Create Edit Contact sheet</name>
  <files>components/contacts/edit-contact-sheet.tsx</files>
  <action>
Create slide-out sheet for editing contacts with activity summary.

**First, add shadcn/ui Sheet if not present:**
```bash
npx shadcn@latest add sheet
```

**Component structure:**
```typescript
'use client'

import { useActionState, useEffect } from 'react'
import {
  Sheet,
  SheetContent,
  SheetHeader,
  SheetTitle,
  SheetDescription,
} from '@/components/ui/sheet'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Separator } from '@/components/ui/separator'
import { format } from 'date-fns'
import { updateContact, type ContactActionState } from '@/lib/actions/contact'
import type { Contact } from '@/lib/types/database'
```

**Add Separator component if needed:**
```bash
npx shadcn@latest add separator
```

**Props:**
- contact: Contact | null (the contact being edited)
- open: boolean
- onOpenChange: (open: boolean) => void

**Content (when contact provided):**

1. **Edit form:**
   - Hidden input for contactId
   - Name input (pre-filled)
   - Email input (pre-filled)
   - Phone input (pre-filled or empty)
   - Save button with pending state

2. **Activity summary (below separator):**
   - "Activity" heading
   - Last sent: formatted date or "Never"
   - Total sent: send_count number
   - Status: Active/Archived badge
   - Added: created_at date

**Behavior:**
- Pre-fill form with contact data when contact changes (useEffect)
- Close sheet on successful update
- Show field errors and general errors
- Right-side sheet (side="right")
- Width: w-[400px] sm:w-[540px]

**Form pattern:**
```typescript
const [state, formAction, isPending] = useActionState<ContactActionState | null, FormData>(
  async (prevState, formData) => {
    const result = await updateContact(prevState, formData)
    if (result.success) {
      onOpenChange(false)
    }
    return result
  },
  null
)
```
  </action>
  <verify>`npx tsc --noEmit` passes, component exports EditContactSheet</verify>
  <done>Sheet slides in, shows editable fields + activity, updates on save</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` - TypeScript compiles
2. Both components export correctly
3. shadcn/ui Dialog and Sheet components exist
4. Form patterns match existing auth forms
</verification>

<success_criteria>
- [ ] AddContactDialog opens with trigger button
- [ ] Add form has Name (required), Email (required), Phone (optional)
- [ ] Add dialog closes on successful submit
- [ ] EditContactSheet slides from right
- [ ] Edit form pre-fills with contact data
- [ ] Edit sheet shows activity summary (last sent, total, status)
- [ ] Both forms show per-field validation errors
- [ ] Both forms disable submit while pending
</success_criteria>

<output>
After completion, create `.planning/phases/03-contact-management/03-04-SUMMARY.md`
</output>
