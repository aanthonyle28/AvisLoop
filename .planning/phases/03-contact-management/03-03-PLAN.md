---
phase: 03-contact-management
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - package.json
  - components/contacts/contact-columns.tsx
  - components/contacts/contact-table.tsx
  - components/contacts/contact-filters.tsx
autonomous: true

must_haves:
  truths:
    - "Contact list displays with sortable columns"
    - "Row selection works with checkboxes"
    - "Search filters contacts by name or email"
    - "Status filter shows active/archived contacts"
  artifacts:
    - path: "components/contacts/contact-table.tsx"
      provides: "DataTable component for contacts"
      contains: "useReactTable"
    - path: "components/contacts/contact-columns.tsx"
      provides: "Column definitions with actions"
      exports: ["columns"]
    - path: "components/contacts/contact-filters.tsx"
      provides: "Search bar and filter chips"
      contains: "filter"
  key_links:
    - from: "contact-table.tsx"
      to: "@tanstack/react-table"
      via: "import useReactTable"
      pattern: "useReactTable"
    - from: "contact-columns.tsx"
      to: "Contact type"
      via: "ColumnDef<Contact>"
      pattern: "ColumnDef<Contact>"
---

<objective>
Install TanStack Table and date-fns, create DataTable component with columns, row selection, and filter UI.

Purpose: Core contact list display with sorting, filtering, and selection
Output: Working DataTable with columns, search, and filter chips
</objective>

<execution_context>
@C:\Users\aanth\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\aanth\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-contact-management/03-RESEARCH.md
@.planning/phases/03-contact-management/03-CONTEXT.md
@components/ui/checkbox.tsx
@components/ui/badge.tsx
@components/ui/input.tsx
@components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies</name>
  <files>package.json</files>
  <action>
Install required packages:

```bash
pnpm add @tanstack/react-table papaparse react-dropzone date-fns
pnpm add -D @types/papaparse
```

These are the core libraries for:
- TanStack Table: Headless table with sorting, filtering, row selection
- PapaParse: CSV parsing for import
- react-dropzone: Drag-and-drop file upload
- date-fns: Date formatting for columns

Verify packages are added to package.json dependencies.
  </action>
  <verify>`pnpm list @tanstack/react-table papaparse react-dropzone date-fns` shows all installed</verify>
  <done>All 4 packages installed and visible in package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create column definitions</name>
  <files>components/contacts/contact-columns.tsx</files>
  <action>
Create column definitions for TanStack Table:

```typescript
'use client'

import { ColumnDef } from '@tanstack/react-table'
import { Checkbox } from '@/components/ui/checkbox'
import { Badge } from '@/components/ui/badge'
import { Button } from '@/components/ui/button'
import { MoreHorizontal, Archive, RotateCcw, Trash2, Pencil } from 'lucide-react'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { format } from 'date-fns'
import type { Contact } from '@/lib/types/database'
```

**Columns:**

1. **select** - Checkbox column
   - header: Checkbox to select all rows
   - cell: Checkbox for row selection
   - enableSorting: false, enableHiding: false

2. **name** - Contact name
   - accessorKey: 'name'
   - header: 'Name'
   - Sortable

3. **email** - Contact email
   - accessorKey: 'email'
   - header: 'Email'
   - Sortable

4. **status** - Active/Archived badge
   - accessorKey: 'status'
   - header: 'Status'
   - cell: Badge with variant based on status

5. **created_at** - Date added
   - accessorKey: 'created_at'
   - header: 'Added'
   - cell: format(date, 'MMM d, yyyy')
   - Sortable

6. **last_sent_at** - Last sent date
   - accessorKey: 'last_sent_at'
   - header: 'Last Sent'
   - cell: Format date or show 'Never'
   - Sortable

7. **actions** - Row actions dropdown
   - id: 'actions'
   - cell: DropdownMenu with Edit, Archive/Restore, Delete
   - Pass callbacks via column meta or props

Export columns function that takes action handlers:
```typescript
export const createColumns = (handlers: {
  onEdit: (contact: Contact) => void
  onArchive: (id: string) => void
  onRestore: (id: string) => void
  onDelete: (id: string) => void
}): ColumnDef<Contact>[]
```
  </action>
  <verify>`npx tsc --noEmit` passes, columns export exists</verify>
  <done>Column definitions include selection, data columns, and actions dropdown</done>
</task>

<task type="auto">
  <name>Task 3: Create DataTable and filters components</name>
  <files>
    components/contacts/contact-table.tsx
    components/contacts/contact-filters.tsx
  </files>
  <action>
**contact-filters.tsx:**
```typescript
'use client'

import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { X, Search } from 'lucide-react'
```

Props:
- searchQuery: string
- onSearchChange: (query: string) => void
- statusFilter: 'all' | 'active' | 'archived'
- onStatusFilterChange: (status) => void

Render:
- Full-width search input with Search icon
- Filter chips below: All, Active, Archived
- Active filter shown as filled Badge, others as outline
- Clear button when filters are active

**contact-table.tsx:**
```typescript
'use client'

import {
  useReactTable,
  getCoreRowModel,
  getSortedRowModel,
  getFilteredRowModel,
  getPaginationRowModel,
  SortingState,
  ColumnFiltersState,
  RowSelectionState,
  flexRender,
} from '@tanstack/react-table'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
```

Create shadcn/ui Table component if it doesn't exist (use shadcn CLI or manual).

Props:
- data: Contact[]
- onEdit: (contact: Contact) => void
- onArchive: (id: string) => void
- onRestore: (id: string) => void
- onDelete: (id: string) => void
- onBulkArchive: (ids: string[]) => void
- onBulkDelete: (ids: string[]) => void

State:
- sorting: SortingState
- columnFilters: ColumnFiltersState
- rowSelection: RowSelectionState
- searchQuery: string (for filters component)
- statusFilter: 'all' | 'active' | 'archived'

Features:
- Use useReactTable with getCoreRowModel, getSortedRowModel, getFilteredRowModel
- Bulk action bar appears when rows selected (Archive Selected, Delete Selected)
- Debounced search (use setTimeout/clearTimeout, 300ms)
- Status filter via table.getColumn('status')?.setFilterValue()

Default sort: last_sent_at DESC (most recent first).

**Note:** If shadcn/ui Table component doesn't exist, create it first using:
```bash
npx shadcn@latest add table
```
  </action>
  <verify>`npx tsc --noEmit` passes, components render without errors</verify>
  <done>DataTable displays contacts with sorting, filtering, selection, and bulk actions</done>
</task>

</tasks>

<verification>
1. `pnpm list @tanstack/react-table` - Package installed
2. `npx tsc --noEmit` - TypeScript compiles
3. Components export properly
4. Table component exists in components/ui/table.tsx
</verification>

<success_criteria>
- [ ] TanStack Table and dependencies installed
- [ ] Column definitions include checkbox, name, email, status, dates, actions
- [ ] DataTable uses TanStack Table hooks correctly
- [ ] Search input filters by name/email
- [ ] Status filter chips work (All/Active/Archived)
- [ ] Row selection works with checkbox column
- [ ] Bulk action bar shows when rows selected
- [ ] Actions dropdown has Edit, Archive/Restore, Delete options
</success_criteria>

<output>
After completion, create `.planning/phases/03-contact-management/03-03-SUMMARY.md`
</output>
